<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Message Routing
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Reactive Messaging Patterns with F# and Akka.NET"/>
    <meta name="author" content="Jorge Fioranelli"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/fsharpreactivepatterns/content/style.css" />
    <script type="text/javascript" src="/fsharpreactivepatterns/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/jorgef/fsharpreactivepatterns">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/fsharpreactivepatterns/index.html">Reactive Messaging Patterns with F# and Akka.NET</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Message-Routing" class="anchor" href="#Message-Routing">Message Routing</a></h1>

<p>For more details and full analysis of each pattern described in this section, please refer to <strong>Chapter 7</strong> of <a href="http://www.informit.com/store/reactive-messaging-patterns-with-the-actor-model-applications-9780133846836" target="_blank">Reactive Messaging Patterns with the Actor Model</a> by <a href="https://twitter.com/vaughnvernon" target="_blank">Vaughn Vernon</a>.</p>

<h2><a name="Sections" class="anchor" href="#Sections">Sections</a></h2>

<ol>
<li><a href="index.html">Introduction</a></li>
<li><a href="messaging-with-actors.html">Messaging with Actors</a></li>
<li><a href="messaging-channels.html">Messaging Channels</a></li>
<li><a href="message-construction.html">Message Construction</a></li>
<li><strong>Message Routing</strong>
<ul>
<li><a href="#Content-Based-Router">Content-Based Router</a></li>
<li><a href="#Message-Filter">Message Filter</a></li>
<li><a href="#Dynamic-Router">Dynamic Router</a></li>
<li><a href="#Recipient-List">Recipient List</a></li>
<li><a href="#Splitter">Splitter</a></li>
<li><a href="#Aggregator">Aggregator</a></li>
<li><a href="#Resequencer">Resequencer</a></li>
<li><a href="#Composed-Message-Processor">Composed Message Processor</a></li>
<li><a href="#Scatter-Gather">Scatter-Gather</a></li>
<li><a href="#Routing-Slip">Routing Slip</a></li>
<li><a href="#Process-Manager">Process Manager</a></li>
<li><a href="#Message-Broker">Message Broker</a></li>
</ul></li>
<li><a href="message-transformation.html">Message Transformation</a></li>
<li><a href="message-endpoints.html">Message Endpoints</a></li>
<li><a href="system-management-and-infrastructure.html">System Management and Infrastructure</a></li>
</ol>

<h2><a name="Content-Based-Router" class="anchor" href="#Content-Based-Router">Content-Based Router</a></h2>

<p>This pattern redirects a message to the right actor based on content inspection.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="f">inventorySystemA</span> (<span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 4)" onmouseover="showTip(event, 'fs2', 4)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">printfn</span> <span class="s">&quot;InventorySystemA: handling %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 8)" onmouseover="showTip(event, 'fs5', 8)" class="f">inventorySystemX</span> (<span onmouseout="hideTip(event, 'fs2', 9)" onmouseover="showTip(event, 'fs2', 9)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 10)" onmouseover="showTip(event, 'fs3', 10)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 11)" onmouseover="showTip(event, 'fs2', 11)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 12)" onmouseover="showTip(event, 'fs4', 12)" class="i">printfn</span> <span class="s">&quot;InventorySystemX: handling %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 13)" onmouseover="showTip(event, 'fs3', 13)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 14)" onmouseover="showTip(event, 'fs3', 14)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 15)" onmouseover="showTip(event, 'fs6', 15)" class="f">orderRouter</span> (<span onmouseout="hideTip(event, 'fs2', 16)" onmouseover="showTip(event, 'fs2', 16)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 17)" onmouseover="showTip(event, 'fs7', 17)" class="i">inventorySystemA</span> <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs2', 18)" onmouseover="showTip(event, 'fs2', 18)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span> <span class="s">&quot;inventorySystemA&quot;</span> <span onmouseout="hideTip(event, 'fs7', 19)" onmouseover="showTip(event, 'fs7', 19)" class="i">inventorySystemA</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 20)" onmouseover="showTip(event, 'fs8', 20)" class="i">inventorySystemX</span> <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs2', 21)" onmouseover="showTip(event, 'fs2', 21)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span> <span class="s">&quot;inventorySystemX&quot;</span> <span onmouseout="hideTip(event, 'fs8', 22)" onmouseover="showTip(event, 'fs8', 22)" class="i">inventorySystemX</span>

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 23)" onmouseover="showTip(event, 'fs3', 23)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">orderPlaced</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 24)" onmouseover="showTip(event, 'fs2', 24)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">OrderPlaced</span> <span class="i">order</span>) <span class="o">=</span> <span class="i">orderPlaced</span>
        <span class="k">match</span> <span class="i">order</span><span class="o">.</span><span class="i">OrderType</span> <span class="k">with</span>
        | <span class="s">&quot;TypeABC&quot;</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs4', 25)" onmouseover="showTip(event, 'fs4', 25)" class="i">printfn</span> <span class="s">&quot;OrderRouter: routing %A&quot;</span> <span class="i">orderPlaced</span>
            <span onmouseout="hideTip(event, 'fs7', 26)" onmouseover="showTip(event, 'fs7', 26)" class="i">inventorySystemA</span> <span class="o">&lt;!</span> <span class="i">orderPlaced</span>
        | <span class="s">&quot;TypeXYZ&quot;</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs4', 27)" onmouseover="showTip(event, 'fs4', 27)" class="i">printfn</span> <span class="s">&quot;OrderRouter: routing %A&quot;</span> <span class="i">orderPlaced</span>
            <span onmouseout="hideTip(event, 'fs8', 28)" onmouseover="showTip(event, 'fs8', 28)" class="i">inventorySystemX</span> <span class="o">&lt;!</span> <span class="i">orderPlaced</span>
        | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 29)" onmouseover="showTip(event, 'fs4', 29)" class="i">printfn</span> <span class="s">&quot;OrderRouter: received unexpected message&quot;</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 30)" onmouseover="showTip(event, 'fs3', 30)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 31)" onmouseover="showTip(event, 'fs3', 31)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 32)" onmouseover="showTip(event, 'fs9', 32)" class="i">orderRouterRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;orderRouter&quot;</span> <span onmouseout="hideTip(event, 'fs6', 33)" onmouseover="showTip(event, 'fs6', 33)" class="i">orderRouter</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 34)" onmouseover="showTip(event, 'fs10', 34)" class="i">orderItem1</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeABC.4&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type ABC.4.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">29.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 35)" onmouseover="showTip(event, 'fs11', 35)" class="i">orderItem2</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;2&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeABC.1&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type ABC.1.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">99.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 36)" onmouseover="showTip(event, 'fs12', 36)" class="i">orderItem3</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;3&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeABC.9&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type ABC.9.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">14.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 37)" onmouseover="showTip(event, 'fs13', 37)" class="i">orderItemsOfTypeA</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 38)" onmouseover="showTip(event, 'fs14', 38)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 39)" onmouseover="showTip(event, 'fs15', 39)" class="f">ofList</span> [(<span onmouseout="hideTip(event, 'fs10', 40)" onmouseover="showTip(event, 'fs10', 40)" class="i">orderItem1</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs10', 41)" onmouseover="showTip(event, 'fs10', 41)" class="i">orderItem1</span>); (<span onmouseout="hideTip(event, 'fs11', 42)" onmouseover="showTip(event, 'fs11', 42)" class="i">orderItem2</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs11', 43)" onmouseover="showTip(event, 'fs11', 43)" class="i">orderItem2</span>); (<span onmouseout="hideTip(event, 'fs12', 44)" onmouseover="showTip(event, 'fs12', 44)" class="i">orderItem3</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs12', 45)" onmouseover="showTip(event, 'fs12', 45)" class="i">orderItem3</span>)]
<span onmouseout="hideTip(event, 'fs9', 46)" onmouseover="showTip(event, 'fs9', 46)" class="i">orderRouterRef</span> <span class="o">&lt;!</span> <span class="i">OrderPlaced</span>({ <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;123&quot;</span>; <span class="i">OrderType</span> <span class="o">=</span> <span class="s">&quot;TypeABC&quot;</span>; <span class="i">OrderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 47)" onmouseover="showTip(event, 'fs13', 47)" class="i">orderItemsOfTypeA</span> })

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 48)" onmouseover="showTip(event, 'fs16', 48)" class="i">orderItem4</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;4&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.2&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.2.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">74.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 49)" onmouseover="showTip(event, 'fs17', 49)" class="i">orderItem5</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;5&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.1&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.1.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">59.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 50)" onmouseover="showTip(event, 'fs18', 50)" class="i">orderItem6</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;6&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.7&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.7.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">29.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 51)" onmouseover="showTip(event, 'fs19', 51)" class="i">orderItem7</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;7&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.5&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.5.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">9.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 52)" onmouseover="showTip(event, 'fs20', 52)" class="i">orderItemsOfTypeX</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 53)" onmouseover="showTip(event, 'fs14', 53)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 54)" onmouseover="showTip(event, 'fs15', 54)" class="f">ofList</span> [(<span onmouseout="hideTip(event, 'fs16', 55)" onmouseover="showTip(event, 'fs16', 55)" class="i">orderItem4</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs16', 56)" onmouseover="showTip(event, 'fs16', 56)" class="i">orderItem4</span>); (<span onmouseout="hideTip(event, 'fs17', 57)" onmouseover="showTip(event, 'fs17', 57)" class="i">orderItem5</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs17', 58)" onmouseover="showTip(event, 'fs17', 58)" class="i">orderItem5</span>); (<span onmouseout="hideTip(event, 'fs18', 59)" onmouseover="showTip(event, 'fs18', 59)" class="i">orderItem6</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs18', 60)" onmouseover="showTip(event, 'fs18', 60)" class="i">orderItem6</span>); (<span onmouseout="hideTip(event, 'fs19', 61)" onmouseover="showTip(event, 'fs19', 61)" class="i">orderItem7</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs19', 62)" onmouseover="showTip(event, 'fs19', 62)" class="i">orderItem7</span>)]
<span onmouseout="hideTip(event, 'fs9', 63)" onmouseover="showTip(event, 'fs9', 63)" class="i">orderRouterRef</span> <span class="o">&lt;!</span> <span class="i">OrderPlaced</span>({ <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;124&quot;</span>; <span class="i">OrderType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ&quot;</span>; <span class="i">OrderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 64)" onmouseover="showTip(event, 'fs20', 64)" class="i">orderItemsOfTypeX</span> })
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/ContentBasedRouter.fsx" target="_blank">Complete Code</a> 

<p><a href="#Sections">Sections</a></p>

<h2><a name="Message-Filter" class="anchor" href="#Message-Filter">Message Filter</a></h2>

<p>The Message Filter pattern discards messages that should not be processed by a given actor.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 65)" onmouseover="showTip(event, 'fs1', 65)" class="f">inventorySystemA</span> (<span onmouseout="hideTip(event, 'fs2', 66)" onmouseover="showTip(event, 'fs2', 66)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 67)" onmouseover="showTip(event, 'fs3', 67)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 68)" onmouseover="showTip(event, 'fs2', 68)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 69)" onmouseover="showTip(event, 'fs4', 69)" class="i">printfn</span> <span class="s">&quot;InventorySystemA: handling %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 70)" onmouseover="showTip(event, 'fs3', 70)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 71)" onmouseover="showTip(event, 'fs3', 71)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 72)" onmouseover="showTip(event, 'fs5', 72)" class="f">inventorySystemX</span> (<span onmouseout="hideTip(event, 'fs2', 73)" onmouseover="showTip(event, 'fs2', 73)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 74)" onmouseover="showTip(event, 'fs3', 74)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 75)" onmouseover="showTip(event, 'fs2', 75)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 76)" onmouseover="showTip(event, 'fs4', 76)" class="i">printfn</span> <span class="s">&quot;InventorySystemX: handling %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 77)" onmouseover="showTip(event, 'fs3', 77)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 78)" onmouseover="showTip(event, 'fs3', 78)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 79)" onmouseover="showTip(event, 'fs21', 79)" class="f">inventorySystemXMessageFilter</span> (<span onmouseout="hideTip(event, 'fs22', 80)" onmouseover="showTip(event, 'fs22', 80)" class="i">actualInventorySystemX</span><span class="o">:</span> <span class="i">IActorRef</span>) (<span onmouseout="hideTip(event, 'fs2', 81)" onmouseover="showTip(event, 'fs2', 81)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 82)" onmouseover="showTip(event, 'fs3', 82)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">orderPlaced</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 83)" onmouseover="showTip(event, 'fs2', 83)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">OrderPlaced</span> <span class="i">order</span>) <span class="o">=</span> <span class="i">orderPlaced</span>
        <span class="k">match</span> <span class="i">order</span><span class="o">.</span><span class="i">OrderType</span> <span class="k">with</span>
        | <span class="s">&quot;TypeABC&quot;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs22', 84)" onmouseover="showTip(event, 'fs22', 84)" class="i">actualInventorySystemX</span><span class="o">.</span><span class="i">Forward</span> <span class="i">orderPlaced</span>
        | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 85)" onmouseover="showTip(event, 'fs4', 85)" class="i">printfn</span> <span class="s">&quot;InventorySystemXMessageFilter: filtering: %A&quot;</span> <span class="i">orderPlaced</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 86)" onmouseover="showTip(event, 'fs3', 86)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 87)" onmouseover="showTip(event, 'fs3', 87)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 88)" onmouseover="showTip(event, 'fs23', 88)" class="i">inventorySystemARef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;inventorySystemA&quot;</span> <span onmouseout="hideTip(event, 'fs1', 89)" onmouseover="showTip(event, 'fs1', 89)" class="i">inventorySystemA</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 90)" onmouseover="showTip(event, 'fs24', 90)" class="i">actualInventorySystemXRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;inventorySystemX&quot;</span> <span onmouseout="hideTip(event, 'fs5', 91)" onmouseover="showTip(event, 'fs5', 91)" class="i">inventorySystemX</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 92)" onmouseover="showTip(event, 'fs25', 92)" class="i">inventorySystemXRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;inventorySystemXMessageFilter&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs21', 93)" onmouseover="showTip(event, 'fs21', 93)" class="f">inventorySystemXMessageFilter</span> <span onmouseout="hideTip(event, 'fs24', 94)" onmouseover="showTip(event, 'fs24', 94)" class="i">actualInventorySystemXRef</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 95)" onmouseover="showTip(event, 'fs10', 95)" class="i">orderItem1</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeABC.4&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type ABC.4.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">29.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 96)" onmouseover="showTip(event, 'fs11', 96)" class="i">orderItem2</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;2&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeABC.1&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type ABC.1.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">99.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 97)" onmouseover="showTip(event, 'fs12', 97)" class="i">orderItem3</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;3&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeABC.9&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type ABC.9.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">14.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 98)" onmouseover="showTip(event, 'fs13', 98)" class="i">orderItemsOfTypeA</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 99)" onmouseover="showTip(event, 'fs14', 99)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 100)" onmouseover="showTip(event, 'fs15', 100)" class="f">ofList</span> [(<span onmouseout="hideTip(event, 'fs10', 101)" onmouseover="showTip(event, 'fs10', 101)" class="i">orderItem1</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs10', 102)" onmouseover="showTip(event, 'fs10', 102)" class="i">orderItem1</span>); (<span onmouseout="hideTip(event, 'fs11', 103)" onmouseover="showTip(event, 'fs11', 103)" class="i">orderItem2</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs11', 104)" onmouseover="showTip(event, 'fs11', 104)" class="i">orderItem2</span>); (<span onmouseout="hideTip(event, 'fs12', 105)" onmouseover="showTip(event, 'fs12', 105)" class="i">orderItem3</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs12', 106)" onmouseover="showTip(event, 'fs12', 106)" class="i">orderItem3</span>)]
<span onmouseout="hideTip(event, 'fs23', 107)" onmouseover="showTip(event, 'fs23', 107)" class="i">inventorySystemARef</span> <span class="o">&lt;!</span> <span class="i">OrderPlaced</span>({ <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;123&quot;</span>; <span class="i">OrderType</span> <span class="o">=</span> <span class="s">&quot;TypeABC&quot;</span>; <span class="i">OrderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 108)" onmouseover="showTip(event, 'fs13', 108)" class="i">orderItemsOfTypeA</span> })
<span onmouseout="hideTip(event, 'fs25', 109)" onmouseover="showTip(event, 'fs25', 109)" class="i">inventorySystemXRef</span> <span class="o">&lt;!</span> <span class="i">OrderPlaced</span>({ <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;123&quot;</span>; <span class="i">OrderType</span> <span class="o">=</span> <span class="s">&quot;TypeABC&quot;</span>; <span class="i">OrderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 110)" onmouseover="showTip(event, 'fs13', 110)" class="i">orderItemsOfTypeA</span> })

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 111)" onmouseover="showTip(event, 'fs16', 111)" class="i">orderItem4</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;4&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.2&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.2.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">74.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 112)" onmouseover="showTip(event, 'fs17', 112)" class="i">orderItem5</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;5&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.1&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.1.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">59.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 113)" onmouseover="showTip(event, 'fs18', 113)" class="i">orderItem6</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;6&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.7&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.7.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">29.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 114)" onmouseover="showTip(event, 'fs19', 114)" class="i">orderItem7</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;7&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ.5&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type XYZ.5.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="n">9.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 115)" onmouseover="showTip(event, 'fs20', 115)" class="i">orderItemsOfTypeX</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 116)" onmouseover="showTip(event, 'fs14', 116)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 117)" onmouseover="showTip(event, 'fs15', 117)" class="f">ofList</span> [(<span onmouseout="hideTip(event, 'fs16', 118)" onmouseover="showTip(event, 'fs16', 118)" class="i">orderItem4</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs16', 119)" onmouseover="showTip(event, 'fs16', 119)" class="i">orderItem4</span>); (<span onmouseout="hideTip(event, 'fs17', 120)" onmouseover="showTip(event, 'fs17', 120)" class="i">orderItem5</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs17', 121)" onmouseover="showTip(event, 'fs17', 121)" class="i">orderItem5</span>); (<span onmouseout="hideTip(event, 'fs18', 122)" onmouseover="showTip(event, 'fs18', 122)" class="i">orderItem6</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs18', 123)" onmouseover="showTip(event, 'fs18', 123)" class="i">orderItem6</span>); (<span onmouseout="hideTip(event, 'fs19', 124)" onmouseover="showTip(event, 'fs19', 124)" class="i">orderItem7</span><span class="o">.</span><span class="i">ItemType</span>, <span onmouseout="hideTip(event, 'fs19', 125)" onmouseover="showTip(event, 'fs19', 125)" class="i">orderItem7</span>)]
<span onmouseout="hideTip(event, 'fs23', 126)" onmouseover="showTip(event, 'fs23', 126)" class="i">inventorySystemARef</span> <span class="o">&lt;!</span> <span class="i">OrderPlaced</span>({ <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;124&quot;</span>; <span class="i">OrderType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ&quot;</span>; <span class="i">OrderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 127)" onmouseover="showTip(event, 'fs20', 127)" class="i">orderItemsOfTypeX</span> })
<span onmouseout="hideTip(event, 'fs25', 128)" onmouseover="showTip(event, 'fs25', 128)" class="i">inventorySystemXRef</span> <span class="o">&lt;!</span> <span class="i">OrderPlaced</span>({ <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;124&quot;</span>; <span class="i">OrderType</span> <span class="o">=</span> <span class="s">&quot;TypeXYZ&quot;</span>; <span class="i">OrderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 129)" onmouseover="showTip(event, 'fs20', 129)" class="i">orderItemsOfTypeX</span> })
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/MessageFilter.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Dynamic-Router" class="anchor" href="#Dynamic-Router">Dynamic Router</a></h2>

<p>This pattern uses specific rules to determine how to route messages to different actors.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
<span class="l">63: </span>
<span class="l">64: </span>
<span class="l">65: </span>
<span class="l">66: </span>
<span class="l">67: </span>
<span class="l">68: </span>
<span class="l">69: </span>
<span class="l">70: </span>
<span class="l">71: </span>
<span class="l">72: </span>
<span class="l">73: </span>
<span class="l">74: </span>
<span class="l">75: </span>
<span class="l">76: </span>
<span class="l">77: </span>
<span class="l">78: </span>
<span class="l">79: </span>
<span class="l">80: </span>
<span class="l">81: </span>
<span class="l">82: </span>
<span class="l">83: </span>
<span class="l">84: </span>
<span class="l">85: </span>
<span class="l">86: </span>
<span class="l">87: </span>
<span class="l">88: </span>
<span class="l">89: </span>
<span class="l">90: </span>
<span class="l">91: </span>
<span class="l">92: </span>
<span class="l">93: </span>
<span class="l">94: </span>
<span class="l">95: </span>
<span class="l">96: </span>
<span class="l">97: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 130)" onmouseover="showTip(event, 'fs26', 130)" class="f">typeAInterested</span> <span onmouseout="hideTip(event, 'fs27', 131)" onmouseover="showTip(event, 'fs27', 131)" class="i">interestRouter</span> (<span onmouseout="hideTip(event, 'fs2', 132)" onmouseover="showTip(event, 'fs2', 132)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">TypeAMessage</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs27', 133)" onmouseover="showTip(event, 'fs27', 133)" class="i">interestRouter</span> <span class="o">&lt;!</span> <span class="i">InterestedIn</span>(<span onmouseout="hideTip(event, 'fs28', 134)" onmouseover="showTip(event, 'fs28', 134)" class="i">typeof</span><span class="o">&lt;</span><span class="i">TypeAMessage</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Name</span>)

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 135)" onmouseover="showTip(event, 'fs3', 135)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 136)" onmouseover="showTip(event, 'fs2', 136)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 137)" onmouseover="showTip(event, 'fs4', 137)" class="i">printfn</span> <span class="s">&quot;TypeAInterested: received: %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 138)" onmouseover="showTip(event, 'fs3', 138)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 139)" onmouseover="showTip(event, 'fs3', 139)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 140)" onmouseover="showTip(event, 'fs29', 140)" class="f">typeBInterested</span> <span onmouseout="hideTip(event, 'fs27', 141)" onmouseover="showTip(event, 'fs27', 141)" class="i">interestRouter</span> (<span onmouseout="hideTip(event, 'fs2', 142)" onmouseover="showTip(event, 'fs2', 142)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">TypeBMessage</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs27', 143)" onmouseover="showTip(event, 'fs27', 143)" class="i">interestRouter</span> <span class="o">&lt;!</span> <span class="i">InterestedIn</span>(<span onmouseout="hideTip(event, 'fs28', 144)" onmouseover="showTip(event, 'fs28', 144)" class="i">typeof</span><span class="o">&lt;</span><span class="i">TypeBMessage</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Name</span>)

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 145)" onmouseover="showTip(event, 'fs3', 145)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 146)" onmouseover="showTip(event, 'fs2', 146)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 147)" onmouseover="showTip(event, 'fs4', 147)" class="i">printfn</span> <span class="s">&quot;TypeBInterested: received: %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 148)" onmouseover="showTip(event, 'fs3', 148)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 149)" onmouseover="showTip(event, 'fs3', 149)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 150)" onmouseover="showTip(event, 'fs30', 150)" class="f">typeCInterested</span> <span onmouseout="hideTip(event, 'fs27', 151)" onmouseover="showTip(event, 'fs27', 151)" class="i">interestRouter</span> (<span onmouseout="hideTip(event, 'fs2', 152)" onmouseover="showTip(event, 'fs2', 152)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">TypeCMessage</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs27', 153)" onmouseover="showTip(event, 'fs27', 153)" class="i">interestRouter</span> <span class="o">&lt;!</span> <span class="i">InterestedIn</span>(<span onmouseout="hideTip(event, 'fs28', 154)" onmouseover="showTip(event, 'fs28', 154)" class="i">typeof</span><span class="o">&lt;</span><span class="i">TypeCMessage</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Name</span>)

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 155)" onmouseover="showTip(event, 'fs3', 155)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 156)" onmouseover="showTip(event, 'fs2', 156)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 157)" onmouseover="showTip(event, 'fs4', 157)" class="i">printfn</span> <span class="s">&quot;TypeCInterested: received: %A&quot;</span> <span class="i">message</span>
        <span onmouseout="hideTip(event, 'fs27', 158)" onmouseover="showTip(event, 'fs27', 158)" class="i">interestRouter</span> <span class="o">&lt;!</span> <span class="i">NoLongerInterestedIn</span>(<span onmouseout="hideTip(event, 'fs28', 159)" onmouseover="showTip(event, 'fs28', 159)" class="i">typeof</span><span class="o">&lt;</span><span class="i">TypeCMessage</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Name</span>)
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 160)" onmouseover="showTip(event, 'fs3', 160)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 161)" onmouseover="showTip(event, 'fs3', 161)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 162)" onmouseover="showTip(event, 'fs31', 162)" class="f">typeCAlsoInterested</span> <span onmouseout="hideTip(event, 'fs27', 163)" onmouseover="showTip(event, 'fs27', 163)" class="i">interestRouter</span> (<span onmouseout="hideTip(event, 'fs2', 164)" onmouseover="showTip(event, 'fs2', 164)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">TypeCMessage</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs27', 165)" onmouseover="showTip(event, 'fs27', 165)" class="i">interestRouter</span> <span class="o">&lt;!</span> <span class="i">InterestedIn</span>(<span onmouseout="hideTip(event, 'fs28', 166)" onmouseover="showTip(event, 'fs28', 166)" class="i">typeof</span><span class="o">&lt;</span><span class="i">TypeCMessage</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Name</span>)

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 167)" onmouseover="showTip(event, 'fs3', 167)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 168)" onmouseover="showTip(event, 'fs2', 168)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 169)" onmouseover="showTip(event, 'fs4', 169)" class="i">printfn</span> <span class="s">&quot;TypeCAlsoInterested: received: %A&quot;</span> <span class="i">message</span>
        <span onmouseout="hideTip(event, 'fs27', 170)" onmouseover="showTip(event, 'fs27', 170)" class="i">interestRouter</span> <span class="o">&lt;!</span> <span class="i">NoLongerInterestedIn</span>(<span onmouseout="hideTip(event, 'fs28', 171)" onmouseover="showTip(event, 'fs28', 171)" class="i">typeof</span><span class="o">&lt;</span><span class="i">TypeCMessage</span><span class="o">&gt;</span><span class="o">.</span><span class="i">Name</span>)
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 172)" onmouseover="showTip(event, 'fs3', 172)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 173)" onmouseover="showTip(event, 'fs3', 173)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 174)" onmouseover="showTip(event, 'fs32', 174)" class="f">dunnoInterested</span> (<span onmouseout="hideTip(event, 'fs2', 175)" onmouseover="showTip(event, 'fs2', 175)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 176)" onmouseover="showTip(event, 'fs3', 176)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 177)" onmouseover="showTip(event, 'fs2', 177)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 178)" onmouseover="showTip(event, 'fs4', 178)" class="i">printfn</span> <span class="s">&quot;DunnoInterest: received undeliverable message: %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 179)" onmouseover="showTip(event, 'fs3', 179)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 180)" onmouseover="showTip(event, 'fs3', 180)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 181)" onmouseover="showTip(event, 'fs33', 181)" class="f">typedMessageInterestRouter</span> <span onmouseout="hideTip(event, 'fs34', 182)" onmouseover="showTip(event, 'fs34', 182)" class="i">dunnoInterested</span> (<span onmouseout="hideTip(event, 'fs2', 183)" onmouseover="showTip(event, 'fs2', 183)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs35', 184)" onmouseover="showTip(event, 'fs35', 184)" class="f">loop</span> (<span onmouseout="hideTip(event, 'fs36', 185)" onmouseover="showTip(event, 'fs36', 185)" class="i">interestRegistry</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs14', 186)" onmouseover="showTip(event, 'fs14', 186)" class="t">Map</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs37', 187)" onmouseover="showTip(event, 'fs37', 187)" class="t">string</span>, <span class="i">IActorRef</span><span class="o">&gt;</span>) (<span onmouseout="hideTip(event, 'fs38', 188)" onmouseover="showTip(event, 'fs38', 188)" class="i">secondaryInterestRegistry</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs14', 189)" onmouseover="showTip(event, 'fs14', 189)" class="t">Map</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs37', 190)" onmouseover="showTip(event, 'fs37', 190)" class="t">string</span>, <span class="i">IActorRef</span><span class="o">&gt;</span>) <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let</span> <span class="i">registerInterest</span> <span class="i">messageType</span> <span class="i">interested</span> <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs36', 191)" onmouseover="showTip(event, 'fs36', 191)" class="i">interestRegistry</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 192)" onmouseover="showTip(event, 'fs14', 192)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 193)" onmouseover="showTip(event, 'fs39', 193)" class="i">tryFind</span> <span class="i">messageType</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 194)" onmouseover="showTip(event, 'fs40', 194)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 195)" onmouseover="showTip(event, 'fs41', 195)" class="i">fold</span> 
                (<span class="k">fun</span> _ _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 196)" onmouseover="showTip(event, 'fs36', 196)" class="i">interestRegistry</span>, <span onmouseout="hideTip(event, 'fs14', 197)" onmouseover="showTip(event, 'fs14', 197)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 198)" onmouseover="showTip(event, 'fs42', 198)" class="i">add</span> <span class="i">messageType</span> <span class="i">interested</span> <span onmouseout="hideTip(event, 'fs38', 199)" onmouseover="showTip(event, 'fs38', 199)" class="i">secondaryInterestRegistry</span>) 
                (<span onmouseout="hideTip(event, 'fs14', 200)" onmouseover="showTip(event, 'fs14', 200)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 201)" onmouseover="showTip(event, 'fs42', 201)" class="i">add</span> <span class="i">messageType</span> <span class="i">interested</span> <span onmouseout="hideTip(event, 'fs36', 202)" onmouseover="showTip(event, 'fs36', 202)" class="i">interestRegistry</span>, <span onmouseout="hideTip(event, 'fs38', 203)" onmouseover="showTip(event, 'fs38', 203)" class="i">secondaryInterestRegistry</span>)

        <span class="k">let</span> <span class="i">unregisterInterest</span> <span class="i">messageType</span> <span class="i">wasInterested</span> <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs36', 204)" onmouseover="showTip(event, 'fs36', 204)" class="i">interestRegistry</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 205)" onmouseover="showTip(event, 'fs14', 205)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 206)" onmouseover="showTip(event, 'fs39', 206)" class="i">tryFind</span> <span class="i">messageType</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 207)" onmouseover="showTip(event, 'fs40', 207)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 208)" onmouseover="showTip(event, 'fs43', 208)" class="i">bind</span> (<span class="k">fun</span> <span class="i">i</span> <span class="k">-&gt;</span> <span class="k">if</span> <span class="i">i</span> <span class="o">=</span> <span class="i">wasInterested</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs44', 209)" onmouseover="showTip(event, 'fs44', 209)" class="i">Some</span> (<span onmouseout="hideTip(event, 'fs14', 210)" onmouseover="showTip(event, 'fs14', 210)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 211)" onmouseover="showTip(event, 'fs45', 211)" class="i">remove</span> <span class="i">messageType</span> <span onmouseout="hideTip(event, 'fs36', 212)" onmouseover="showTip(event, 'fs36', 212)" class="i">interestRegistry</span>, <span onmouseout="hideTip(event, 'fs38', 213)" onmouseover="showTip(event, 'fs38', 213)" class="i">secondaryInterestRegistry</span>) <span class="k">else</span> <span onmouseout="hideTip(event, 'fs46', 214)" onmouseover="showTip(event, 'fs46', 214)" class="i">None</span>)
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 215)" onmouseover="showTip(event, 'fs40', 215)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 216)" onmouseover="showTip(event, 'fs43', 216)" class="i">bind</span> (<span class="k">fun</span> (<span class="i">p</span>,<span class="i">s</span>) <span class="k">-&gt;</span> <span class="i">s</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 217)" onmouseover="showTip(event, 'fs14', 217)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 218)" onmouseover="showTip(event, 'fs39', 218)" class="i">tryFind</span> <span class="i">messageType</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 219)" onmouseover="showTip(event, 'fs40', 219)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 220)" onmouseover="showTip(event, 'fs47', 220)" class="i">map</span>(<span class="k">fun</span> <span class="i">i</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 221)" onmouseover="showTip(event, 'fs14', 221)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 222)" onmouseover="showTip(event, 'fs42', 222)" class="i">add</span> <span class="i">messageType</span> <span class="i">i</span> <span class="i">p</span>,  <span onmouseout="hideTip(event, 'fs14', 223)" onmouseover="showTip(event, 'fs14', 223)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 224)" onmouseover="showTip(event, 'fs45', 224)" class="i">remove</span> <span class="i">messageType</span> <span onmouseout="hideTip(event, 'fs38', 225)" onmouseover="showTip(event, 'fs38', 225)" class="i">secondaryInterestRegistry</span>))
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 226)" onmouseover="showTip(event, 'fs40', 226)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 227)" onmouseover="showTip(event, 'fs41', 227)" class="i">fold</span> (<span class="k">fun</span> _ <span class="i">i</span> <span class="k">-&gt;</span> <span class="i">i</span>) (<span onmouseout="hideTip(event, 'fs36', 228)" onmouseover="showTip(event, 'fs36', 228)" class="i">interestRegistry</span>, <span onmouseout="hideTip(event, 'fs38', 229)" onmouseover="showTip(event, 'fs38', 229)" class="i">secondaryInterestRegistry</span>)

        <span class="k">let</span> <span class="i">sendFor</span> <span class="i">message</span> <span class="o">=</span>
            <span class="k">let</span> <span class="i">messageType</span> <span class="o">=</span> (<span class="i">message</span><span class="o">.</span><span class="i">GetType</span> ())<span class="o">.</span><span class="i">Name</span>
            <span onmouseout="hideTip(event, 'fs36', 230)" onmouseover="showTip(event, 'fs36', 230)" class="i">interestRegistry</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 231)" onmouseover="showTip(event, 'fs14', 231)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 232)" onmouseover="showTip(event, 'fs39', 232)" class="i">tryFind</span> <span class="i">messageType</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 233)" onmouseover="showTip(event, 'fs40', 233)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 234)" onmouseover="showTip(event, 'fs41', 234)" class="i">fold</span> (<span class="k">fun</span> _ <span class="i">i</span> <span class="k">-&gt;</span> <span class="i">i</span>) <span onmouseout="hideTip(event, 'fs34', 235)" onmouseover="showTip(event, 'fs34', 235)" class="i">dunnoInterested</span>
            <span class="o">|&gt;</span> <span class="k">fun</span> <span class="i">i</span> <span class="k">-&gt;</span> <span class="i">i</span> <span class="o">&lt;!</span> <span class="i">message</span> 

        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 236)" onmouseover="showTip(event, 'fs2', 236)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs48', 237)" onmouseover="showTip(event, 'fs48', 237)" class="i">box</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="o">:?</span> <span class="i">Registration</span> <span class="k">as</span> <span class="i">r</span> <span class="k">-&gt;</span>
            <span class="k">match</span> <span class="i">r</span> <span class="k">with</span>
            | <span class="i">InterestedIn</span> <span class="i">messageType</span> <span class="k">-&gt;</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs35', 238)" onmouseover="showTip(event, 'fs35', 238)" class="i">loop</span> <span class="o">&lt;||</span> <span class="i">registerInterest</span> <span class="i">messageType</span> (<span onmouseout="hideTip(event, 'fs2', 239)" onmouseover="showTip(event, 'fs2', 239)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> ())
            | <span class="i">NoLongerInterestedIn</span> <span class="i">messageType</span> <span class="k">-&gt;</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs35', 240)" onmouseover="showTip(event, 'fs35', 240)" class="i">loop</span> <span class="o">&lt;||</span> <span class="i">unregisterInterest</span> <span class="i">messageType</span> (<span onmouseout="hideTip(event, 'fs2', 241)" onmouseover="showTip(event, 'fs2', 241)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> ())
        | <span class="i">message</span> <span class="k">-&gt;</span> 
            <span class="i">sendFor</span> <span class="i">message</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs35', 242)" onmouseover="showTip(event, 'fs35', 242)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs36', 243)" onmouseover="showTip(event, 'fs36', 243)" class="i">interestRegistry</span> <span onmouseout="hideTip(event, 'fs38', 244)" onmouseover="showTip(event, 'fs38', 244)" class="i">secondaryInterestRegistry</span>
    }
    <span onmouseout="hideTip(event, 'fs35', 245)" onmouseover="showTip(event, 'fs35', 245)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 246)" onmouseover="showTip(event, 'fs14', 246)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 247)" onmouseover="showTip(event, 'fs49', 247)" class="i">empty</span> <span onmouseout="hideTip(event, 'fs14', 248)" onmouseover="showTip(event, 'fs14', 248)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 249)" onmouseover="showTip(event, 'fs49', 249)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs50', 250)" onmouseover="showTip(event, 'fs50', 250)" class="i">dunnoInterestedRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;dunnoInterested&quot;</span> <span onmouseout="hideTip(event, 'fs32', 251)" onmouseover="showTip(event, 'fs32', 251)" class="i">dunnoInterested</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs51', 252)" onmouseover="showTip(event, 'fs51', 252)" class="i">typedMessageInterestRouterRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;typedMessageInterestRouter&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs33', 253)" onmouseover="showTip(event, 'fs33', 253)" class="f">typedMessageInterestRouter</span> <span onmouseout="hideTip(event, 'fs50', 254)" onmouseover="showTip(event, 'fs50', 254)" class="i">dunnoInterestedRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs52', 255)" onmouseover="showTip(event, 'fs52', 255)" class="i">typeAInterestedRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;typeAInterest&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs26', 256)" onmouseover="showTip(event, 'fs26', 256)" class="f">typeAInterested</span> <span onmouseout="hideTip(event, 'fs51', 257)" onmouseover="showTip(event, 'fs51', 257)" class="i">typedMessageInterestRouterRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 258)" onmouseover="showTip(event, 'fs53', 258)" class="i">typeBInterestedRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;typeBInterest&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs29', 259)" onmouseover="showTip(event, 'fs29', 259)" class="f">typeBInterested</span> <span onmouseout="hideTip(event, 'fs51', 260)" onmouseover="showTip(event, 'fs51', 260)" class="i">typedMessageInterestRouterRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs54', 261)" onmouseover="showTip(event, 'fs54', 261)" class="i">typeCInterestedRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;typeCInterest&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs30', 262)" onmouseover="showTip(event, 'fs30', 262)" class="f">typeCInterested</span> <span onmouseout="hideTip(event, 'fs51', 263)" onmouseover="showTip(event, 'fs51', 263)" class="i">typedMessageInterestRouterRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs55', 264)" onmouseover="showTip(event, 'fs55', 264)" class="i">typeCAlsoInterestedRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;typeCAlsoInterested&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs31', 265)" onmouseover="showTip(event, 'fs31', 265)" class="f">typeCAlsoInterested</span> <span onmouseout="hideTip(event, 'fs51', 266)" onmouseover="showTip(event, 'fs51', 266)" class="i">typedMessageInterestRouterRef</span>

<span onmouseout="hideTip(event, 'fs51', 267)" onmouseover="showTip(event, 'fs51', 267)" class="i">typedMessageInterestRouterRef</span> <span class="o">&lt;!</span> <span class="i">TypeAMessage</span>(<span class="s">&quot;Message of TypeA.&quot;</span>)
<span onmouseout="hideTip(event, 'fs51', 268)" onmouseover="showTip(event, 'fs51', 268)" class="i">typedMessageInterestRouterRef</span> <span class="o">&lt;!</span> <span class="i">TypeBMessage</span>(<span class="s">&quot;Message of TypeB.&quot;</span>)
<span onmouseout="hideTip(event, 'fs51', 269)" onmouseover="showTip(event, 'fs51', 269)" class="i">typedMessageInterestRouterRef</span> <span class="o">&lt;!</span> <span class="i">TypeCMessage</span>(<span class="s">&quot;Message of TypeC.&quot;</span>)
<span onmouseout="hideTip(event, 'fs51', 270)" onmouseover="showTip(event, 'fs51', 270)" class="i">typedMessageInterestRouterRef</span> <span class="o">&lt;!</span> <span class="i">TypeCMessage</span>(<span class="s">&quot;Another message of TypeC.&quot;</span>)
<span onmouseout="hideTip(event, 'fs51', 271)" onmouseover="showTip(event, 'fs51', 271)" class="i">typedMessageInterestRouterRef</span> <span class="o">&lt;!</span> <span class="i">TypeDMessage</span>(<span class="s">&quot;Message of TypeD.&quot;</span>)
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/DynamicRouter.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Recipient-List" class="anchor" href="#Recipient-List">Recipient List</a></h2>

<p>This pattern routes messages to a list of recipient actors based on their content.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">  1: </span>
<span class="l">  2: </span>
<span class="l">  3: </span>
<span class="l">  4: </span>
<span class="l">  5: </span>
<span class="l">  6: </span>
<span class="l">  7: </span>
<span class="l">  8: </span>
<span class="l">  9: </span>
<span class="l"> 10: </span>
<span class="l"> 11: </span>
<span class="l"> 12: </span>
<span class="l"> 13: </span>
<span class="l"> 14: </span>
<span class="l"> 15: </span>
<span class="l"> 16: </span>
<span class="l"> 17: </span>
<span class="l"> 18: </span>
<span class="l"> 19: </span>
<span class="l"> 20: </span>
<span class="l"> 21: </span>
<span class="l"> 22: </span>
<span class="l"> 23: </span>
<span class="l"> 24: </span>
<span class="l"> 25: </span>
<span class="l"> 26: </span>
<span class="l"> 27: </span>
<span class="l"> 28: </span>
<span class="l"> 29: </span>
<span class="l"> 30: </span>
<span class="l"> 31: </span>
<span class="l"> 32: </span>
<span class="l"> 33: </span>
<span class="l"> 34: </span>
<span class="l"> 35: </span>
<span class="l"> 36: </span>
<span class="l"> 37: </span>
<span class="l"> 38: </span>
<span class="l"> 39: </span>
<span class="l"> 40: </span>
<span class="l"> 41: </span>
<span class="l"> 42: </span>
<span class="l"> 43: </span>
<span class="l"> 44: </span>
<span class="l"> 45: </span>
<span class="l"> 46: </span>
<span class="l"> 47: </span>
<span class="l"> 48: </span>
<span class="l"> 49: </span>
<span class="l"> 50: </span>
<span class="l"> 51: </span>
<span class="l"> 52: </span>
<span class="l"> 53: </span>
<span class="l"> 54: </span>
<span class="l"> 55: </span>
<span class="l"> 56: </span>
<span class="l"> 57: </span>
<span class="l"> 58: </span>
<span class="l"> 59: </span>
<span class="l"> 60: </span>
<span class="l"> 61: </span>
<span class="l"> 62: </span>
<span class="l"> 63: </span>
<span class="l"> 64: </span>
<span class="l"> 65: </span>
<span class="l"> 66: </span>
<span class="l"> 67: </span>
<span class="l"> 68: </span>
<span class="l"> 69: </span>
<span class="l"> 70: </span>
<span class="l"> 71: </span>
<span class="l"> 72: </span>
<span class="l"> 73: </span>
<span class="l"> 74: </span>
<span class="l"> 75: </span>
<span class="l"> 76: </span>
<span class="l"> 77: </span>
<span class="l"> 78: </span>
<span class="l"> 79: </span>
<span class="l"> 80: </span>
<span class="l"> 81: </span>
<span class="l"> 82: </span>
<span class="l"> 83: </span>
<span class="l"> 84: </span>
<span class="l"> 85: </span>
<span class="l"> 86: </span>
<span class="l"> 87: </span>
<span class="l"> 88: </span>
<span class="l"> 89: </span>
<span class="l"> 90: </span>
<span class="l"> 91: </span>
<span class="l"> 92: </span>
<span class="l"> 93: </span>
<span class="l"> 94: </span>
<span class="l"> 95: </span>
<span class="l"> 96: </span>
<span class="l"> 97: </span>
<span class="l"> 98: </span>
<span class="l"> 99: </span>
<span class="l">100: </span>
<span class="l">101: </span>
<span class="l">102: </span>
<span class="l">103: </span>
<span class="l">104: </span>
<span class="l">105: </span>
<span class="l">106: </span>
<span class="l">107: </span>
<span class="l">108: </span>
<span class="l">109: </span>
<span class="l">110: </span>
<span class="l">111: </span>
<span class="l">112: </span>
<span class="l">113: </span>
<span class="l">114: </span>
<span class="l">115: </span>
<span class="l">116: </span>
<span class="l">117: </span>
<span class="l">118: </span>
<span class="l">119: </span>
<span class="l">120: </span>
<span class="l">121: </span>
<span class="l">122: </span>
<span class="l">123: </span>
<span class="l">124: </span>
<span class="l">125: </span>
<span class="l">126: </span>
<span class="l">127: </span>
<span class="l">128: </span>
<span class="l">129: </span>
<span class="l">130: </span>
<span class="l">131: </span>
<span class="l">132: </span>
<span class="l">133: </span>
<span class="l">134: </span>
<span class="l">135: </span>
<span class="l">136: </span>
<span class="l">137: </span>
<span class="l">138: </span>
<span class="l">139: </span>
<span class="l">140: </span>
<span class="l">141: </span>
<span class="l">142: </span>
<span class="l">143: </span>
<span class="l">144: </span>
<span class="l">145: </span>
<span class="l">146: </span>
<span class="l">147: </span>
<span class="l">148: </span>
<span class="l">149: </span>
<span class="l">150: </span>
<span class="l">151: </span>
<span class="l">152: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs56', 272)" onmouseover="showTip(event, 'fs56', 272)" class="f">mountaineeringSuppliesOrderProcessor</span> (<span onmouseout="hideTip(event, 'fs2', 273)" onmouseover="showTip(event, 'fs2', 273)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs57', 274)" onmouseover="showTip(event, 'fs57', 274)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs36', 275)" onmouseover="showTip(event, 'fs36', 275)" class="i">interestRegistry</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let</span> <span class="i">calculateRecipientList</span> (<span class="i">rfq</span><span class="o">:</span> <span class="i">RequestForQuotation</span>) <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs36', 276)" onmouseover="showTip(event, 'fs36', 276)" class="i">interestRegistry</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 277)" onmouseover="showTip(event, 'fs14', 277)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs58', 278)" onmouseover="showTip(event, 'fs58', 278)" class="i">toList</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 279)" onmouseover="showTip(event, 'fs59', 279)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 280)" onmouseover="showTip(event, 'fs60', 280)" class="i">filter</span> (<span class="k">fun</span> (_, <span class="i">v</span>) <span class="k">-&gt;</span> 
                <span class="k">let</span> (<span class="i">Money</span> <span class="i">lowTotalRetail</span>) <span class="o">=</span> <span class="i">v</span><span class="o">.</span><span class="i">LowTotalRetail</span>
                <span class="k">let</span> (<span class="i">Money</span> <span class="i">highTotalRetail</span>) <span class="o">=</span> <span class="i">v</span><span class="o">.</span><span class="i">HighTotalRetail</span>
                <span class="i">rfq</span><span class="o">.</span><span class="i">TotalRetailPrice</span> <span class="o">&gt;</span><span class="o">=</span> <span class="i">lowTotalRetail</span> <span class="o">&amp;&amp;</span> <span class="i">rfq</span><span class="o">.</span><span class="i">TotalRetailPrice</span> <span class="o">&lt;=</span> <span class="i">highTotalRetail</span>)
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 281)" onmouseover="showTip(event, 'fs59', 281)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 282)" onmouseover="showTip(event, 'fs61', 282)" class="i">map</span> (<span class="k">fun</span> (_, <span class="i">v</span>) <span class="k">-&gt;</span> <span class="i">v</span><span class="o">.</span><span class="i">QuoteProcessor</span>)

        <span class="k">let</span> <span class="i">dispatchTo</span> <span class="i">rfq</span> (<span class="i">recipientList</span><span class="o">:</span> <span class="i">IActorRef</span> <span onmouseout="hideTip(event, 'fs62', 283)" onmouseover="showTip(event, 'fs62', 283)" class="i">list</span>) <span class="o">=</span>
            <span class="i">recipientList</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 284)" onmouseover="showTip(event, 'fs59', 284)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 285)" onmouseover="showTip(event, 'fs63', 285)" class="i">iter</span> (<span class="k">fun</span> <span class="i">recipient</span> <span class="k">-&gt;</span>
                <span class="i">rfq</span><span class="o">.</span><span class="i">RetailItems</span>
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 286)" onmouseover="showTip(event, 'fs59', 286)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 287)" onmouseover="showTip(event, 'fs63', 287)" class="i">iter</span> (<span class="k">fun</span> <span class="i">retailItem</span> <span class="k">-&gt;</span> 
                    <span onmouseout="hideTip(event, 'fs4', 288)" onmouseover="showTip(event, 'fs4', 288)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: %s item: %s to: %s&quot;</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">ItemId</span> <span class="o">&lt;|</span> <span class="i">recipient</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> ()
                    <span class="i">recipient</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">Money</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">OrderTotalRetailPrice</span> <span class="o">=</span> <span class="i">Money</span> <span class="i">rfq</span><span class="o">.</span><span class="i">TotalRetailPrice</span> }))

        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 289)" onmouseover="showTip(event, 'fs2', 289)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs48', 290)" onmouseover="showTip(event, 'fs48', 290)" class="i">box</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="o">:?</span> <span class="i">PriceQuoteInterest</span> <span class="k">as</span> <span class="i">interest</span> <span class="k">-&gt;</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 291)" onmouseover="showTip(event, 'fs57', 291)" class="i">loop</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs14', 292)" onmouseover="showTip(event, 'fs14', 292)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 293)" onmouseover="showTip(event, 'fs42', 293)" class="i">add</span> <span class="i">interest</span><span class="o">.</span><span class="i">Path</span> <span class="i">interest</span> <span onmouseout="hideTip(event, 'fs36', 294)" onmouseover="showTip(event, 'fs36', 294)" class="i">interestRegistry</span> 
        | <span class="o">:?</span> <span class="i">PriceQuote</span> <span class="k">as</span> <span class="i">priceQuote</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 295)" onmouseover="showTip(event, 'fs4', 295)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: received: %A&quot;</span> <span class="i">priceQuote</span>
        | <span class="o">:?</span> <span class="i">RequestForQuotation</span> <span class="k">as</span> <span class="i">rfq</span> <span class="k">-&gt;</span> 
            <span class="k">let</span> <span class="i">recipientList</span> <span class="o">=</span> <span class="i">calculateRecipientList</span> <span class="i">rfq</span>
            <span class="i">dispatchTo</span> <span class="i">rfq</span> <span class="i">recipientList</span>
        | <span class="i">message</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 296)" onmouseover="showTip(event, 'fs4', 296)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: unexpected: %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 297)" onmouseover="showTip(event, 'fs57', 297)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs36', 298)" onmouseover="showTip(event, 'fs36', 298)" class="i">interestRegistry</span> 
    }
    <span onmouseout="hideTip(event, 'fs57', 299)" onmouseover="showTip(event, 'fs57', 299)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 300)" onmouseover="showTip(event, 'fs14', 300)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 301)" onmouseover="showTip(event, 'fs49', 301)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 302)" onmouseover="showTip(event, 'fs64', 302)" class="f">budgetHikersPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 303)" onmouseover="showTip(event, 'fs65', 303)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 304)" onmouseover="showTip(event, 'fs2', 304)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 305)" onmouseover="showTip(event, 'fs65', 305)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 306)" onmouseover="showTip(event, 'fs2', 306)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 307)" onmouseover="showTip(event, 'fs2', 307)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">1.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">1000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 308)" onmouseover="showTip(event, 'fs66', 308)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 309)" onmouseover="showTip(event, 'fs67', 309)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 310)" onmouseover="showTip(event, 'fs67', 310)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">100.00m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 311)" onmouseover="showTip(event, 'fs67', 311)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 312)" onmouseover="showTip(event, 'fs67', 312)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 313)" onmouseover="showTip(event, 'fs67', 313)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.07m</span>
        <span class="k">else</span> <span class="n">0.075m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 314)" onmouseover="showTip(event, 'fs3', 314)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 315)" onmouseover="showTip(event, 'fs2', 315)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 316)" onmouseover="showTip(event, 'fs66', 316)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 317)" onmouseover="showTip(event, 'fs2', 317)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 318)" onmouseover="showTip(event, 'fs3', 318)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 319)" onmouseover="showTip(event, 'fs3', 319)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 320)" onmouseover="showTip(event, 'fs68', 320)" class="f">highSierraPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 321)" onmouseover="showTip(event, 'fs65', 321)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 322)" onmouseover="showTip(event, 'fs2', 322)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 323)" onmouseover="showTip(event, 'fs65', 323)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 324)" onmouseover="showTip(event, 'fs2', 324)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 325)" onmouseover="showTip(event, 'fs2', 325)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">100.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">10000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 326)" onmouseover="showTip(event, 'fs66', 326)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 327)" onmouseover="showTip(event, 'fs67', 327)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 328)" onmouseover="showTip(event, 'fs67', 328)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">150.00m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 329)" onmouseover="showTip(event, 'fs67', 329)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 330)" onmouseover="showTip(event, 'fs67', 330)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 331)" onmouseover="showTip(event, 'fs67', 331)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">else</span> <span class="n">0.05m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 332)" onmouseover="showTip(event, 'fs3', 332)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 333)" onmouseover="showTip(event, 'fs2', 333)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 334)" onmouseover="showTip(event, 'fs66', 334)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 335)" onmouseover="showTip(event, 'fs2', 335)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 336)" onmouseover="showTip(event, 'fs3', 336)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 337)" onmouseover="showTip(event, 'fs3', 337)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 338)" onmouseover="showTip(event, 'fs69', 338)" class="f">mountainAscentPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 339)" onmouseover="showTip(event, 'fs65', 339)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 340)" onmouseover="showTip(event, 'fs2', 340)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 341)" onmouseover="showTip(event, 'fs65', 341)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 342)" onmouseover="showTip(event, 'fs2', 342)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 343)" onmouseover="showTip(event, 'fs2', 343)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">70.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">5000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 344)" onmouseover="showTip(event, 'fs66', 344)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 345)" onmouseover="showTip(event, 'fs67', 345)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 346)" onmouseover="showTip(event, 'fs67', 346)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">99.99m</span>) <span class="k">then</span> <span class="n">0.01m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 347)" onmouseover="showTip(event, 'fs67', 347)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">199.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 348)" onmouseover="showTip(event, 'fs67', 348)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 349)" onmouseover="showTip(event, 'fs67', 349)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 350)" onmouseover="showTip(event, 'fs67', 350)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 351)" onmouseover="showTip(event, 'fs67', 351)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">2999.99m</span>) <span class="k">then</span> <span class="n">0.0475m</span>
        <span class="k">else</span> <span class="n">0.05m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 352)" onmouseover="showTip(event, 'fs3', 352)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 353)" onmouseover="showTip(event, 'fs2', 353)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 354)" onmouseover="showTip(event, 'fs66', 354)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 355)" onmouseover="showTip(event, 'fs2', 355)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 356)" onmouseover="showTip(event, 'fs3', 356)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 357)" onmouseover="showTip(event, 'fs3', 357)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 358)" onmouseover="showTip(event, 'fs70', 358)" class="f">pinnacleGearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 359)" onmouseover="showTip(event, 'fs65', 359)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 360)" onmouseover="showTip(event, 'fs2', 360)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 361)" onmouseover="showTip(event, 'fs65', 361)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 362)" onmouseover="showTip(event, 'fs2', 362)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 363)" onmouseover="showTip(event, 'fs2', 363)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">250.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">500000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 364)" onmouseover="showTip(event, 'fs66', 364)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 365)" onmouseover="showTip(event, 'fs67', 365)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 366)" onmouseover="showTip(event, 'fs67', 366)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">299.99m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 367)" onmouseover="showTip(event, 'fs67', 367)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.0175m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 368)" onmouseover="showTip(event, 'fs67', 368)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 369)" onmouseover="showTip(event, 'fs67', 369)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 370)" onmouseover="showTip(event, 'fs67', 370)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">1199.99m</span>) <span class="k">then</span> <span class="n">0.035m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 371)" onmouseover="showTip(event, 'fs67', 371)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 372)" onmouseover="showTip(event, 'fs67', 372)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">7999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">else</span> <span class="n">0.06m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 373)" onmouseover="showTip(event, 'fs3', 373)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 374)" onmouseover="showTip(event, 'fs2', 374)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 375)" onmouseover="showTip(event, 'fs66', 375)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 376)" onmouseover="showTip(event, 'fs2', 376)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 377)" onmouseover="showTip(event, 'fs3', 377)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 378)" onmouseover="showTip(event, 'fs3', 378)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs71', 379)" onmouseover="showTip(event, 'fs71', 379)" class="f">rockBottomOuterwearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 380)" onmouseover="showTip(event, 'fs65', 380)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 381)" onmouseover="showTip(event, 'fs2', 381)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 382)" onmouseover="showTip(event, 'fs65', 382)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 383)" onmouseover="showTip(event, 'fs2', 383)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 384)" onmouseover="showTip(event, 'fs2', 384)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">0.50m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">7500.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 385)" onmouseover="showTip(event, 'fs66', 385)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 386)" onmouseover="showTip(event, 'fs67', 386)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 387)" onmouseover="showTip(event, 'fs67', 387)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">100.00m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 388)" onmouseover="showTip(event, 'fs67', 388)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 389)" onmouseover="showTip(event, 'fs67', 389)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 390)" onmouseover="showTip(event, 'fs67', 390)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 391)" onmouseover="showTip(event, 'fs67', 391)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 392)" onmouseover="showTip(event, 'fs67', 392)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">2999.99m</span>) <span class="k">then</span> <span class="n">0.06m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 393)" onmouseover="showTip(event, 'fs67', 393)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.07m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 394)" onmouseover="showTip(event, 'fs67', 394)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">5999.99m</span>) <span class="k">then</span> <span class="n">0.075m</span>
        <span class="k">else</span> <span class="n">0.08m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 395)" onmouseover="showTip(event, 'fs3', 395)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 396)" onmouseover="showTip(event, 'fs2', 396)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 397)" onmouseover="showTip(event, 'fs66', 397)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 398)" onmouseover="showTip(event, 'fs2', 398)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 399)" onmouseover="showTip(event, 'fs3', 399)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 400)" onmouseover="showTip(event, 'fs3', 400)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 401)" onmouseover="showTip(event, 'fs72', 401)" class="i">orderProcessorRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;orderProcessor&quot;</span> <span onmouseout="hideTip(event, 'fs56', 402)" onmouseover="showTip(event, 'fs56', 402)" class="i">mountaineeringSuppliesOrderProcessor</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs73', 403)" onmouseover="showTip(event, 'fs73', 403)" class="i">budgetHikersRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;budgetHikersPriceQuotes&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs64', 404)" onmouseover="showTip(event, 'fs64', 404)" class="f">budgetHikersPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 405)" onmouseover="showTip(event, 'fs72', 405)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs74', 406)" onmouseover="showTip(event, 'fs74', 406)" class="i">highSierraRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;highSierra&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs68', 407)" onmouseover="showTip(event, 'fs68', 407)" class="f">highSierraPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 408)" onmouseover="showTip(event, 'fs72', 408)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs75', 409)" onmouseover="showTip(event, 'fs75', 409)" class="i">mountainAscentRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;mountainAscent&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs69', 410)" onmouseover="showTip(event, 'fs69', 410)" class="f">mountainAscentPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 411)" onmouseover="showTip(event, 'fs72', 411)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs76', 412)" onmouseover="showTip(event, 'fs76', 412)" class="i">pinnacleGearRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;pinnacleGear&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs70', 413)" onmouseover="showTip(event, 'fs70', 413)" class="f">pinnacleGearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 414)" onmouseover="showTip(event, 'fs72', 414)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs77', 415)" onmouseover="showTip(event, 'fs77', 415)" class="i">rockBottomOuterwearRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;rockBottomOuterwear&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs71', 416)" onmouseover="showTip(event, 'fs71', 416)" class="f">rockBottomOuterwearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 417)" onmouseover="showTip(event, 'fs72', 417)" class="i">orderProcessorRef</span>

<span onmouseout="hideTip(event, 'fs72', 418)" onmouseover="showTip(event, 'fs72', 418)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;123&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">29.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;2&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">99.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;3&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">14.95m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 419)" onmouseover="showTip(event, 'fs72', 419)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;125&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;4&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">39.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;5&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">199.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;6&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">149.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;7&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">724.99m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 420)" onmouseover="showTip(event, 'fs72', 420)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;129&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;8&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">119.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;9&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">499.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;10&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">519.00m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;11&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">209.50m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 421)" onmouseover="showTip(event, 'fs72', 421)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;135&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;12&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">0.97m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;13&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">9.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;14&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">1.99m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 422)" onmouseover="showTip(event, 'fs72', 422)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;140&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;15&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">107.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;16&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">9.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;17&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">599.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;18&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">249.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;19&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">789.99m</span> } ] }
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/RecipientList.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Splitter" class="anchor" href="#Splitter">Splitter</a></h2>

<p>The Splitter pattern decomposes a message into smaller ones.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs78', 423)" onmouseover="showTip(event, 'fs78', 423)" class="f">orderItemTypeAProcessor</span> (<span onmouseout="hideTip(event, 'fs2', 424)" onmouseover="showTip(event, 'fs2', 424)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 425)" onmouseover="showTip(event, 'fs3', 425)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">TypeAItemOrdered</span> <span class="i">orderItem</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 426)" onmouseover="showTip(event, 'fs2', 426)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 427)" onmouseover="showTip(event, 'fs4', 427)" class="i">printfn</span> <span class="s">&quot;OrderItemTypeAProcessor: handling %A&quot;</span> <span class="i">orderItem</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 428)" onmouseover="showTip(event, 'fs3', 428)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 429)" onmouseover="showTip(event, 'fs3', 429)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs79', 430)" onmouseover="showTip(event, 'fs79', 430)" class="f">orderItemTypeBProcessor</span> (<span onmouseout="hideTip(event, 'fs2', 431)" onmouseover="showTip(event, 'fs2', 431)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 432)" onmouseover="showTip(event, 'fs3', 432)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">TypeBItemOrdered</span> <span class="i">orderItem</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 433)" onmouseover="showTip(event, 'fs2', 433)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 434)" onmouseover="showTip(event, 'fs4', 434)" class="i">printfn</span> <span class="s">&quot;OrderItemTypeBProcessor: handling %A&quot;</span> <span class="i">orderItem</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 435)" onmouseover="showTip(event, 'fs3', 435)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 436)" onmouseover="showTip(event, 'fs3', 436)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs80', 437)" onmouseover="showTip(event, 'fs80', 437)" class="f">orderItemTypeCProcessor</span> (<span onmouseout="hideTip(event, 'fs2', 438)" onmouseover="showTip(event, 'fs2', 438)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 439)" onmouseover="showTip(event, 'fs3', 439)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">TypeCItemOrdered</span> <span class="i">orderItem</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 440)" onmouseover="showTip(event, 'fs2', 440)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 441)" onmouseover="showTip(event, 'fs4', 441)" class="i">printfn</span> <span class="s">&quot;OrderItemTypeCProcessor: handling %A&quot;</span> <span class="i">orderItem</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 442)" onmouseover="showTip(event, 'fs3', 442)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 443)" onmouseover="showTip(event, 'fs3', 443)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 444)" onmouseover="showTip(event, 'fs6', 444)" class="f">orderRouter</span> (<span onmouseout="hideTip(event, 'fs2', 445)" onmouseover="showTip(event, 'fs2', 445)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs81', 446)" onmouseover="showTip(event, 'fs81', 446)" class="i">orderItemTypeAProcessor</span> <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs2', 447)" onmouseover="showTip(event, 'fs2', 447)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span> <span class="s">&quot;orderItemTypeAProcessor&quot;</span> <span onmouseout="hideTip(event, 'fs81', 448)" onmouseover="showTip(event, 'fs81', 448)" class="i">orderItemTypeAProcessor</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs82', 449)" onmouseover="showTip(event, 'fs82', 449)" class="i">orderItemTypeBProcessor</span> <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs2', 450)" onmouseover="showTip(event, 'fs2', 450)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span> <span class="s">&quot;orderItemTypeBProcessor&quot;</span> <span onmouseout="hideTip(event, 'fs82', 451)" onmouseover="showTip(event, 'fs82', 451)" class="i">orderItemTypeBProcessor</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs83', 452)" onmouseover="showTip(event, 'fs83', 452)" class="i">orderItemTypeCProcessor</span> <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs2', 453)" onmouseover="showTip(event, 'fs2', 453)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span> <span class="s">&quot;orderItemTypeCProcessor&quot;</span> <span onmouseout="hideTip(event, 'fs83', 454)" onmouseover="showTip(event, 'fs83', 454)" class="i">orderItemTypeCProcessor</span>

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 455)" onmouseover="showTip(event, 'fs3', 455)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">OrderPlaced</span> <span class="i">order</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 456)" onmouseover="showTip(event, 'fs2', 456)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="i">order</span><span class="o">.</span><span class="i">OrderItems</span> 
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 457)" onmouseover="showTip(event, 'fs14', 457)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 458)" onmouseover="showTip(event, 'fs84', 458)" class="i">iter</span> (<span class="k">fun</span> <span class="i">k</span> <span class="i">orderItem</span> <span class="k">-&gt;</span> 
            <span class="k">match</span> <span class="i">orderItem</span><span class="o">.</span><span class="i">ItemType</span> <span class="k">with</span>
            | <span class="s">&quot;TypeA&quot;</span> <span class="k">-&gt;</span> 
                <span onmouseout="hideTip(event, 'fs4', 459)" onmouseover="showTip(event, 'fs4', 459)" class="i">printfn</span> <span class="s">&quot;OrderRouter: routing %A&quot;</span> <span class="i">orderItem</span>
                <span onmouseout="hideTip(event, 'fs81', 460)" onmouseover="showTip(event, 'fs81', 460)" class="i">orderItemTypeAProcessor</span> <span class="o">&lt;!</span> <span class="i">TypeAItemOrdered</span>(<span class="i">orderItem</span>)
            | <span class="s">&quot;TypeB&quot;</span> <span class="k">-&gt;</span> 
                <span onmouseout="hideTip(event, 'fs4', 461)" onmouseover="showTip(event, 'fs4', 461)" class="i">printfn</span> <span class="s">&quot;OrderRouter: routing %A&quot;</span> <span class="i">orderItem</span>
                <span onmouseout="hideTip(event, 'fs82', 462)" onmouseover="showTip(event, 'fs82', 462)" class="i">orderItemTypeBProcessor</span> <span class="o">&lt;!</span> <span class="i">TypeBItemOrdered</span>(<span class="i">orderItem</span>)
            | <span class="s">&quot;TypeC&quot;</span> <span class="k">-&gt;</span> 
                <span onmouseout="hideTip(event, 'fs4', 463)" onmouseover="showTip(event, 'fs4', 463)" class="i">printfn</span> <span class="s">&quot;OrderRouter: routing %A&quot;</span> <span class="i">orderItem</span>
                <span onmouseout="hideTip(event, 'fs83', 464)" onmouseover="showTip(event, 'fs83', 464)" class="i">orderItemTypeCProcessor</span> <span class="o">&lt;!</span> <span class="i">TypeCItemOrdered</span>(<span class="i">orderItem</span>)
            | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 465)" onmouseover="showTip(event, 'fs4', 465)" class="i">printfn</span> <span class="s">&quot;OrderRouter: received unexpected message&quot;</span>)
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 466)" onmouseover="showTip(event, 'fs3', 466)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 467)" onmouseover="showTip(event, 'fs3', 467)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 468)" onmouseover="showTip(event, 'fs85', 468)" class="f">splitter</span> (<span onmouseout="hideTip(event, 'fs2', 469)" onmouseover="showTip(event, 'fs2', 469)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 470)" onmouseover="showTip(event, 'fs3', 470)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 471)" onmouseover="showTip(event, 'fs2', 471)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 472)" onmouseover="showTip(event, 'fs3', 472)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 473)" onmouseover="showTip(event, 'fs3', 473)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 474)" onmouseover="showTip(event, 'fs9', 474)" class="i">orderRouterRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;orderRouter&quot;</span> <span onmouseout="hideTip(event, 'fs6', 475)" onmouseover="showTip(event, 'fs6', 475)" class="i">orderRouter</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 476)" onmouseover="showTip(event, 'fs10', 476)" class="i">orderItem1</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeA&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type A.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">23.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 477)" onmouseover="showTip(event, 'fs11', 477)" class="i">orderItem2</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;2&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeB&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type B.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">99.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 478)" onmouseover="showTip(event, 'fs12', 478)" class="i">orderItem3</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;3&quot;</span>; <span class="i">ItemType</span> <span class="o">=</span> <span class="s">&quot;TypeC&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;An item of type C.&quot;</span>; <span class="i">Price</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">14.95m</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 479)" onmouseover="showTip(event, 'fs86', 479)" class="i">orderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 480)" onmouseover="showTip(event, 'fs14', 480)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 481)" onmouseover="showTip(event, 'fs15', 481)" class="f">ofList</span> [ (<span onmouseout="hideTip(event, 'fs10', 482)" onmouseover="showTip(event, 'fs10', 482)" class="i">orderItem1</span><span class="o">.</span><span class="i">Id</span>, <span onmouseout="hideTip(event, 'fs10', 483)" onmouseover="showTip(event, 'fs10', 483)" class="i">orderItem1</span>); (<span onmouseout="hideTip(event, 'fs11', 484)" onmouseover="showTip(event, 'fs11', 484)" class="i">orderItem2</span><span class="o">.</span><span class="i">Id</span>, <span onmouseout="hideTip(event, 'fs11', 485)" onmouseover="showTip(event, 'fs11', 485)" class="i">orderItem2</span>); (<span onmouseout="hideTip(event, 'fs12', 486)" onmouseover="showTip(event, 'fs12', 486)" class="i">orderItem3</span><span class="o">.</span><span class="i">Id</span>, <span onmouseout="hideTip(event, 'fs12', 487)" onmouseover="showTip(event, 'fs12', 487)" class="i">orderItem3</span>) ]
    
<span onmouseout="hideTip(event, 'fs9', 488)" onmouseover="showTip(event, 'fs9', 488)" class="i">orderRouterRef</span> <span class="o">&lt;!</span> <span class="i">OrderPlaced</span>({ <span class="i">OrderItems</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs86', 489)" onmouseover="showTip(event, 'fs86', 489)" class="i">orderItems</span> })
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/Splitter.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Aggregator" class="anchor" href="#Aggregator">Aggregator</a></h2>

<p>The Aggregator pattern creates a single message from multiple ones.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">  1: </span>
<span class="l">  2: </span>
<span class="l">  3: </span>
<span class="l">  4: </span>
<span class="l">  5: </span>
<span class="l">  6: </span>
<span class="l">  7: </span>
<span class="l">  8: </span>
<span class="l">  9: </span>
<span class="l"> 10: </span>
<span class="l"> 11: </span>
<span class="l"> 12: </span>
<span class="l"> 13: </span>
<span class="l"> 14: </span>
<span class="l"> 15: </span>
<span class="l"> 16: </span>
<span class="l"> 17: </span>
<span class="l"> 18: </span>
<span class="l"> 19: </span>
<span class="l"> 20: </span>
<span class="l"> 21: </span>
<span class="l"> 22: </span>
<span class="l"> 23: </span>
<span class="l"> 24: </span>
<span class="l"> 25: </span>
<span class="l"> 26: </span>
<span class="l"> 27: </span>
<span class="l"> 28: </span>
<span class="l"> 29: </span>
<span class="l"> 30: </span>
<span class="l"> 31: </span>
<span class="l"> 32: </span>
<span class="l"> 33: </span>
<span class="l"> 34: </span>
<span class="l"> 35: </span>
<span class="l"> 36: </span>
<span class="l"> 37: </span>
<span class="l"> 38: </span>
<span class="l"> 39: </span>
<span class="l"> 40: </span>
<span class="l"> 41: </span>
<span class="l"> 42: </span>
<span class="l"> 43: </span>
<span class="l"> 44: </span>
<span class="l"> 45: </span>
<span class="l"> 46: </span>
<span class="l"> 47: </span>
<span class="l"> 48: </span>
<span class="l"> 49: </span>
<span class="l"> 50: </span>
<span class="l"> 51: </span>
<span class="l"> 52: </span>
<span class="l"> 53: </span>
<span class="l"> 54: </span>
<span class="l"> 55: </span>
<span class="l"> 56: </span>
<span class="l"> 57: </span>
<span class="l"> 58: </span>
<span class="l"> 59: </span>
<span class="l"> 60: </span>
<span class="l"> 61: </span>
<span class="l"> 62: </span>
<span class="l"> 63: </span>
<span class="l"> 64: </span>
<span class="l"> 65: </span>
<span class="l"> 66: </span>
<span class="l"> 67: </span>
<span class="l"> 68: </span>
<span class="l"> 69: </span>
<span class="l"> 70: </span>
<span class="l"> 71: </span>
<span class="l"> 72: </span>
<span class="l"> 73: </span>
<span class="l"> 74: </span>
<span class="l"> 75: </span>
<span class="l"> 76: </span>
<span class="l"> 77: </span>
<span class="l"> 78: </span>
<span class="l"> 79: </span>
<span class="l"> 80: </span>
<span class="l"> 81: </span>
<span class="l"> 82: </span>
<span class="l"> 83: </span>
<span class="l"> 84: </span>
<span class="l"> 85: </span>
<span class="l"> 86: </span>
<span class="l"> 87: </span>
<span class="l"> 88: </span>
<span class="l"> 89: </span>
<span class="l"> 90: </span>
<span class="l"> 91: </span>
<span class="l"> 92: </span>
<span class="l"> 93: </span>
<span class="l"> 94: </span>
<span class="l"> 95: </span>
<span class="l"> 96: </span>
<span class="l"> 97: </span>
<span class="l"> 98: </span>
<span class="l"> 99: </span>
<span class="l">100: </span>
<span class="l">101: </span>
<span class="l">102: </span>
<span class="l">103: </span>
<span class="l">104: </span>
<span class="l">105: </span>
<span class="l">106: </span>
<span class="l">107: </span>
<span class="l">108: </span>
<span class="l">109: </span>
<span class="l">110: </span>
<span class="l">111: </span>
<span class="l">112: </span>
<span class="l">113: </span>
<span class="l">114: </span>
<span class="l">115: </span>
<span class="l">116: </span>
<span class="l">117: </span>
<span class="l">118: </span>
<span class="l">119: </span>
<span class="l">120: </span>
<span class="l">121: </span>
<span class="l">122: </span>
<span class="l">123: </span>
<span class="l">124: </span>
<span class="l">125: </span>
<span class="l">126: </span>
<span class="l">127: </span>
<span class="l">128: </span>
<span class="l">129: </span>
<span class="l">130: </span>
<span class="l">131: </span>
<span class="l">132: </span>
<span class="l">133: </span>
<span class="l">134: </span>
<span class="l">135: </span>
<span class="l">136: </span>
<span class="l">137: </span>
<span class="l">138: </span>
<span class="l">139: </span>
<span class="l">140: </span>
<span class="l">141: </span>
<span class="l">142: </span>
<span class="l">143: </span>
<span class="l">144: </span>
<span class="l">145: </span>
<span class="l">146: </span>
<span class="l">147: </span>
<span class="l">148: </span>
<span class="l">149: </span>
<span class="l">150: </span>
<span class="l">151: </span>
<span class="l">152: </span>
<span class="l">153: </span>
<span class="l">154: </span>
<span class="l">155: </span>
<span class="l">156: </span>
<span class="l">157: </span>
<span class="l">158: </span>
<span class="l">159: </span>
<span class="l">160: </span>
<span class="l">161: </span>
<span class="l">162: </span>
<span class="l">163: </span>
<span class="l">164: </span>
<span class="l">165: </span>
<span class="l">166: </span>
<span class="l">167: </span>
<span class="l">168: </span>
<span class="l">169: </span>
<span class="l">170: </span>
<span class="l">171: </span>
<span class="l">172: </span>
<span class="l">173: </span>
<span class="l">174: </span>
<span class="l">175: </span>
<span class="l">176: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs87', 490)" onmouseover="showTip(event, 'fs87', 490)" class="f">priceQuoteAggregator</span> (<span onmouseout="hideTip(event, 'fs2', 491)" onmouseover="showTip(event, 'fs2', 491)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs57', 492)" onmouseover="showTip(event, 'fs57', 492)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs88', 493)" onmouseover="showTip(event, 'fs88', 493)" class="i">fulfilledPriceQuotes</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 494)" onmouseover="showTip(event, 'fs2', 494)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">match</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="i">RequiredPriceQuotesForFulfillment</span>(<span class="i">rfqId</span>, <span class="i">quotesRequested</span>) <span class="k">as</span> <span class="i">message</span> <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 495)" onmouseover="showTip(event, 'fs4', 495)" class="i">printfn</span> <span class="s">&quot;PriceQuoteAggregator: required fulfilled: %A&quot;</span> <span class="i">message</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 496)" onmouseover="showTip(event, 'fs57', 496)" class="i">loop</span> (<span onmouseout="hideTip(event, 'fs88', 497)" onmouseover="showTip(event, 'fs88', 497)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 498)" onmouseover="showTip(event, 'fs14', 498)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 499)" onmouseover="showTip(event, 'fs42', 499)" class="i">add</span> <span class="i">rfqId</span> ({<span class="i">RfqId</span> <span class="o">=</span> <span class="i">rfqId</span>; <span class="i">QuotesRequested</span> <span class="o">=</span> <span class="i">quotesRequested</span>; <span class="i">PriceQuotes</span> <span class="o">=</span> []; <span class="i">Requester</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 500)" onmouseover="showTip(event, 'fs2', 500)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () }))
        | <span class="i">PriceQuoteFulfilled</span> <span class="i">priceQuoteFulfilled</span> <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 501)" onmouseover="showTip(event, 'fs4', 501)" class="i">printfn</span> <span class="s">&quot;PriceQuoteAggregator: fulfilled price quote: %A&quot;</span> <span class="i">priceQuoteFulfilled</span>
            <span class="k">let</span> <span class="i">previousFulfillment</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs88', 502)" onmouseover="showTip(event, 'fs88', 502)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 503)" onmouseover="showTip(event, 'fs14', 503)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 504)" onmouseover="showTip(event, 'fs89', 504)" class="i">find</span> <span class="i">priceQuoteFulfilled</span><span class="o">.</span><span class="i">RfqId</span>
            <span class="k">let</span> <span class="i">currentPriceQuotes</span> <span class="o">=</span> <span class="i">previousFulfillment</span><span class="o">.</span><span class="i">PriceQuotes</span> <span class="o">@</span> [<span class="i">priceQuoteFulfilled</span>]
            <span class="k">let</span> <span class="i">currentFulfillment</span> <span class="o">=</span> { <span class="i">previousFulfillment</span> <span class="k">with</span> <span class="i">PriceQuotes</span> <span class="o">=</span> <span class="i">currentPriceQuotes</span> }
            <span class="k">if</span> (<span class="i">currentPriceQuotes</span><span class="o">.</span><span class="i">Length</span> <span class="o">&gt;</span><span class="o">=</span> <span class="i">currentFulfillment</span><span class="o">.</span><span class="i">QuotesRequested</span>) <span class="k">then</span>
                <span class="i">currentFulfillment</span><span class="o">.</span><span class="i">Requester</span> <span class="o">&lt;!</span> <span class="i">currentFulfillment</span>
                <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 505)" onmouseover="showTip(event, 'fs57', 505)" class="i">loop</span> (<span onmouseout="hideTip(event, 'fs88', 506)" onmouseover="showTip(event, 'fs88', 506)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 507)" onmouseover="showTip(event, 'fs14', 507)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 508)" onmouseover="showTip(event, 'fs45', 508)" class="i">remove</span> <span class="i">priceQuoteFulfilled</span><span class="o">.</span><span class="i">RfqId</span>)
            <span class="k">else</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 509)" onmouseover="showTip(event, 'fs57', 509)" class="i">loop</span> (<span onmouseout="hideTip(event, 'fs88', 510)" onmouseover="showTip(event, 'fs88', 510)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 511)" onmouseover="showTip(event, 'fs14', 511)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 512)" onmouseover="showTip(event, 'fs42', 512)" class="i">add</span> <span class="i">priceQuoteFulfilled</span><span class="o">.</span><span class="i">RfqId</span> <span class="i">currentFulfillment</span>)
    }
    <span onmouseout="hideTip(event, 'fs57', 513)" onmouseover="showTip(event, 'fs57', 513)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 514)" onmouseover="showTip(event, 'fs14', 514)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 515)" onmouseover="showTip(event, 'fs49', 515)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs90', 516)" onmouseover="showTip(event, 'fs90', 516)" class="f">mountaineeringSuppliesOrderProcessor</span> <span onmouseout="hideTip(event, 'fs91', 517)" onmouseover="showTip(event, 'fs91', 517)" class="i">priceQuoteAggregator</span> (<span onmouseout="hideTip(event, 'fs2', 518)" onmouseover="showTip(event, 'fs2', 518)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs57', 519)" onmouseover="showTip(event, 'fs57', 519)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs36', 520)" onmouseover="showTip(event, 'fs36', 520)" class="i">interestRegistry</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let</span> <span class="i">calculateRecipientList</span> (<span class="i">rfq</span><span class="o">:</span> <span class="i">RequestForQuotation</span>) <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs36', 521)" onmouseover="showTip(event, 'fs36', 521)" class="i">interestRegistry</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 522)" onmouseover="showTip(event, 'fs14', 522)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs58', 523)" onmouseover="showTip(event, 'fs58', 523)" class="i">toList</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 524)" onmouseover="showTip(event, 'fs59', 524)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 525)" onmouseover="showTip(event, 'fs60', 525)" class="i">filter</span> (<span class="k">fun</span> (_, <span class="i">v</span>) <span class="k">-&gt;</span> 
                <span class="k">let</span> (<span class="i">Money</span> <span class="i">lowTotalRetail</span>) <span class="o">=</span> <span class="i">v</span><span class="o">.</span><span class="i">LowTotalRetail</span>
                <span class="k">let</span> (<span class="i">Money</span> <span class="i">highTotalRetail</span>) <span class="o">=</span> <span class="i">v</span><span class="o">.</span><span class="i">HighTotalRetail</span>
                <span class="i">rfq</span><span class="o">.</span><span class="i">TotalRetailPrice</span> <span class="o">&gt;</span><span class="o">=</span> <span class="i">lowTotalRetail</span> <span class="o">&amp;&amp;</span> <span class="i">rfq</span><span class="o">.</span><span class="i">TotalRetailPrice</span> <span class="o">&lt;=</span> <span class="i">highTotalRetail</span>)
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 526)" onmouseover="showTip(event, 'fs59', 526)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 527)" onmouseover="showTip(event, 'fs61', 527)" class="i">map</span> (<span class="k">fun</span> (_, <span class="i">v</span>) <span class="k">-&gt;</span> <span class="i">v</span><span class="o">.</span><span class="i">QuoteProcessor</span>)

        <span class="k">let</span> <span class="i">dispatchTo</span> <span class="i">rfq</span> (<span class="i">recipientList</span><span class="o">:</span> <span class="i">IActorRef</span> <span onmouseout="hideTip(event, 'fs62', 528)" onmouseover="showTip(event, 'fs62', 528)" class="i">list</span>) <span class="o">=</span>
            <span class="i">recipientList</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 529)" onmouseover="showTip(event, 'fs59', 529)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 530)" onmouseover="showTip(event, 'fs63', 530)" class="i">iter</span> (<span class="k">fun</span> <span class="i">recipient</span> <span class="k">-&gt;</span>
                <span class="i">rfq</span><span class="o">.</span><span class="i">RetailItems</span>
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 531)" onmouseover="showTip(event, 'fs59', 531)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 532)" onmouseover="showTip(event, 'fs63', 532)" class="i">iter</span> (<span class="k">fun</span> <span class="i">retailItem</span> <span class="k">-&gt;</span> 
                    <span onmouseout="hideTip(event, 'fs4', 533)" onmouseover="showTip(event, 'fs4', 533)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: %s item: %s to: %s&quot;</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">ItemId</span> <span class="o">&lt;|</span> <span class="i">recipient</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> ()
                    <span class="i">recipient</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">Money</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">OrderTotalRetailPrice</span> <span class="o">=</span> <span class="i">Money</span> <span class="i">rfq</span><span class="o">.</span><span class="i">TotalRetailPrice</span> }))

        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 534)" onmouseover="showTip(event, 'fs2', 534)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs48', 535)" onmouseover="showTip(event, 'fs48', 535)" class="i">box</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="o">:?</span> <span class="i">PriceQuoteInterest</span> <span class="k">as</span> <span class="i">interest</span> <span class="k">-&gt;</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 536)" onmouseover="showTip(event, 'fs57', 536)" class="i">loop</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs14', 537)" onmouseover="showTip(event, 'fs14', 537)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 538)" onmouseover="showTip(event, 'fs42', 538)" class="i">add</span> <span class="i">interest</span><span class="o">.</span><span class="i">Path</span> <span class="i">interest</span> <span onmouseout="hideTip(event, 'fs36', 539)" onmouseover="showTip(event, 'fs36', 539)" class="i">interestRegistry</span> 
        | <span class="o">:?</span> <span class="i">PriceQuote</span> <span class="k">as</span> <span class="i">priceQuote</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs91', 540)" onmouseover="showTip(event, 'fs91', 540)" class="i">priceQuoteAggregator</span> <span class="o">&lt;!</span> <span class="i">PriceQuoteFulfilled</span> <span class="i">priceQuote</span>
            <span onmouseout="hideTip(event, 'fs4', 541)" onmouseover="showTip(event, 'fs4', 541)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: received: %A&quot;</span> <span class="i">priceQuote</span>
        | <span class="o">:?</span> <span class="i">RequestForQuotation</span> <span class="k">as</span> <span class="i">rfq</span> <span class="k">-&gt;</span> 
            <span class="k">let</span> <span class="i">recipientList</span> <span class="o">=</span> <span class="i">calculateRecipientList</span> <span class="i">rfq</span>
            <span onmouseout="hideTip(event, 'fs91', 542)" onmouseover="showTip(event, 'fs91', 542)" class="i">priceQuoteAggregator</span> <span class="o">&lt;!</span> <span class="i">RequiredPriceQuotesForFulfillment</span>(<span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span>, <span class="i">recipientList</span><span class="o">.</span><span class="i">Length</span> <span class="o">*</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RetailItems</span><span class="o">.</span><span class="i">Length</span>)
            <span class="i">dispatchTo</span> <span class="i">rfq</span> <span class="i">recipientList</span>
        | <span class="o">:?</span> <span class="i">QuotationFulfillment</span> <span class="k">as</span> <span class="i">fulfillment</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 543)" onmouseover="showTip(event, 'fs4', 543)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: received: %A&quot;</span> <span class="i">fulfillment</span>
        | <span class="i">message</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 544)" onmouseover="showTip(event, 'fs4', 544)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: unexpected: %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 545)" onmouseover="showTip(event, 'fs57', 545)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs36', 546)" onmouseover="showTip(event, 'fs36', 546)" class="i">interestRegistry</span> 
    }
    <span onmouseout="hideTip(event, 'fs57', 547)" onmouseover="showTip(event, 'fs57', 547)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 548)" onmouseover="showTip(event, 'fs14', 548)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 549)" onmouseover="showTip(event, 'fs49', 549)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 550)" onmouseover="showTip(event, 'fs64', 550)" class="f">budgetHikersPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 551)" onmouseover="showTip(event, 'fs65', 551)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 552)" onmouseover="showTip(event, 'fs2', 552)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 553)" onmouseover="showTip(event, 'fs65', 553)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 554)" onmouseover="showTip(event, 'fs2', 554)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 555)" onmouseover="showTip(event, 'fs2', 555)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">1.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">1000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 556)" onmouseover="showTip(event, 'fs66', 556)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 557)" onmouseover="showTip(event, 'fs67', 557)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 558)" onmouseover="showTip(event, 'fs67', 558)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">100.00m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 559)" onmouseover="showTip(event, 'fs67', 559)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 560)" onmouseover="showTip(event, 'fs67', 560)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 561)" onmouseover="showTip(event, 'fs67', 561)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.07m</span>
        <span class="k">else</span> <span class="n">0.075m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 562)" onmouseover="showTip(event, 'fs3', 562)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 563)" onmouseover="showTip(event, 'fs2', 563)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 564)" onmouseover="showTip(event, 'fs66', 564)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 565)" onmouseover="showTip(event, 'fs2', 565)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 566)" onmouseover="showTip(event, 'fs3', 566)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 567)" onmouseover="showTip(event, 'fs3', 567)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 568)" onmouseover="showTip(event, 'fs68', 568)" class="f">highSierraPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 569)" onmouseover="showTip(event, 'fs65', 569)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 570)" onmouseover="showTip(event, 'fs2', 570)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 571)" onmouseover="showTip(event, 'fs65', 571)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 572)" onmouseover="showTip(event, 'fs2', 572)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 573)" onmouseover="showTip(event, 'fs2', 573)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">100.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">10000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 574)" onmouseover="showTip(event, 'fs66', 574)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 575)" onmouseover="showTip(event, 'fs67', 575)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 576)" onmouseover="showTip(event, 'fs67', 576)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">150.00m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 577)" onmouseover="showTip(event, 'fs67', 577)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 578)" onmouseover="showTip(event, 'fs67', 578)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 579)" onmouseover="showTip(event, 'fs67', 579)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">else</span> <span class="n">0.05m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 580)" onmouseover="showTip(event, 'fs3', 580)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 581)" onmouseover="showTip(event, 'fs2', 581)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 582)" onmouseover="showTip(event, 'fs66', 582)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 583)" onmouseover="showTip(event, 'fs2', 583)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 584)" onmouseover="showTip(event, 'fs3', 584)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 585)" onmouseover="showTip(event, 'fs3', 585)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 586)" onmouseover="showTip(event, 'fs69', 586)" class="f">mountainAscentPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 587)" onmouseover="showTip(event, 'fs65', 587)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 588)" onmouseover="showTip(event, 'fs2', 588)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 589)" onmouseover="showTip(event, 'fs65', 589)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 590)" onmouseover="showTip(event, 'fs2', 590)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 591)" onmouseover="showTip(event, 'fs2', 591)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">70.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">5000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 592)" onmouseover="showTip(event, 'fs66', 592)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 593)" onmouseover="showTip(event, 'fs67', 593)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 594)" onmouseover="showTip(event, 'fs67', 594)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">99.99m</span>) <span class="k">then</span> <span class="n">0.01m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 595)" onmouseover="showTip(event, 'fs67', 595)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">199.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 596)" onmouseover="showTip(event, 'fs67', 596)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 597)" onmouseover="showTip(event, 'fs67', 597)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 598)" onmouseover="showTip(event, 'fs67', 598)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 599)" onmouseover="showTip(event, 'fs67', 599)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">2999.99m</span>) <span class="k">then</span> <span class="n">0.0475m</span>
        <span class="k">else</span> <span class="n">0.05m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 600)" onmouseover="showTip(event, 'fs3', 600)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 601)" onmouseover="showTip(event, 'fs2', 601)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 602)" onmouseover="showTip(event, 'fs66', 602)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 603)" onmouseover="showTip(event, 'fs2', 603)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 604)" onmouseover="showTip(event, 'fs3', 604)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 605)" onmouseover="showTip(event, 'fs3', 605)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 606)" onmouseover="showTip(event, 'fs70', 606)" class="f">pinnacleGearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 607)" onmouseover="showTip(event, 'fs65', 607)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 608)" onmouseover="showTip(event, 'fs2', 608)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 609)" onmouseover="showTip(event, 'fs65', 609)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 610)" onmouseover="showTip(event, 'fs2', 610)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 611)" onmouseover="showTip(event, 'fs2', 611)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">250.00m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">500000.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 612)" onmouseover="showTip(event, 'fs66', 612)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 613)" onmouseover="showTip(event, 'fs67', 613)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 614)" onmouseover="showTip(event, 'fs67', 614)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">299.99m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 615)" onmouseover="showTip(event, 'fs67', 615)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.0175m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 616)" onmouseover="showTip(event, 'fs67', 616)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 617)" onmouseover="showTip(event, 'fs67', 617)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 618)" onmouseover="showTip(event, 'fs67', 618)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">1199.99m</span>) <span class="k">then</span> <span class="n">0.035m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 619)" onmouseover="showTip(event, 'fs67', 619)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 620)" onmouseover="showTip(event, 'fs67', 620)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">7999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">else</span> <span class="n">0.06m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 621)" onmouseover="showTip(event, 'fs3', 621)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 622)" onmouseover="showTip(event, 'fs2', 622)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 623)" onmouseover="showTip(event, 'fs66', 623)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 624)" onmouseover="showTip(event, 'fs2', 624)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 625)" onmouseover="showTip(event, 'fs3', 625)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 626)" onmouseover="showTip(event, 'fs3', 626)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs71', 627)" onmouseover="showTip(event, 'fs71', 627)" class="f">rockBottomOuterwearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs65', 628)" onmouseover="showTip(event, 'fs65', 628)" class="i">interestRegistrar</span> (<span onmouseout="hideTip(event, 'fs2', 629)" onmouseover="showTip(event, 'fs2', 629)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs65', 630)" onmouseover="showTip(event, 'fs65', 630)" class="i">interestRegistrar</span> <span class="o">&lt;!</span> { <span class="i">Path</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 631)" onmouseover="showTip(event, 'fs2', 631)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">ToString</span> (); <span class="i">QuoteProcessor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 632)" onmouseover="showTip(event, 'fs2', 632)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>; <span class="i">LowTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">0.50m</span>; <span class="i">HighTotalRetail</span> <span class="o">=</span> <span class="i">Money</span> <span class="n">7500.00m</span> }
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 633)" onmouseover="showTip(event, 'fs66', 633)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 634)" onmouseover="showTip(event, 'fs67', 634)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 635)" onmouseover="showTip(event, 'fs67', 635)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">100.00m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 636)" onmouseover="showTip(event, 'fs67', 636)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 637)" onmouseover="showTip(event, 'fs67', 637)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 638)" onmouseover="showTip(event, 'fs67', 638)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 639)" onmouseover="showTip(event, 'fs67', 639)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 640)" onmouseover="showTip(event, 'fs67', 640)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">2999.99m</span>) <span class="k">then</span> <span class="n">0.06m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 641)" onmouseover="showTip(event, 'fs67', 641)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.07m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 642)" onmouseover="showTip(event, 'fs67', 642)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">5999.99m</span>) <span class="k">then</span> <span class="n">0.075m</span>
        <span class="k">else</span> <span class="n">0.08m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 643)" onmouseover="showTip(event, 'fs3', 643)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 644)" onmouseover="showTip(event, 'fs2', 644)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 645)" onmouseover="showTip(event, 'fs66', 645)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 646)" onmouseover="showTip(event, 'fs2', 646)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 647)" onmouseover="showTip(event, 'fs3', 647)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 648)" onmouseover="showTip(event, 'fs3', 648)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs92', 649)" onmouseover="showTip(event, 'fs92', 649)" class="i">priceQuoteAggregatorRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;priceQuoteAggregator&quot;</span> <span onmouseout="hideTip(event, 'fs87', 650)" onmouseover="showTip(event, 'fs87', 650)" class="i">priceQuoteAggregator</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 651)" onmouseover="showTip(event, 'fs72', 651)" class="i">orderProcessorRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;orderProcessor&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs90', 652)" onmouseover="showTip(event, 'fs90', 652)" class="f">mountaineeringSuppliesOrderProcessor</span> <span onmouseout="hideTip(event, 'fs92', 653)" onmouseover="showTip(event, 'fs92', 653)" class="i">priceQuoteAggregatorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 654)" onmouseover="showTip(event, 'fs93', 654)" class="i">budgetHikersRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;budgetHikersPriceQuotes&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs64', 655)" onmouseover="showTip(event, 'fs64', 655)" class="f">budgetHikersPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 656)" onmouseover="showTip(event, 'fs72', 656)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs94', 657)" onmouseover="showTip(event, 'fs94', 657)" class="i">highSierraRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;highSierra&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs68', 658)" onmouseover="showTip(event, 'fs68', 658)" class="f">highSierraPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 659)" onmouseover="showTip(event, 'fs72', 659)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs95', 660)" onmouseover="showTip(event, 'fs95', 660)" class="i">mountainAscentRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;mountainAscent&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs69', 661)" onmouseover="showTip(event, 'fs69', 661)" class="f">mountainAscentPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 662)" onmouseover="showTip(event, 'fs72', 662)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 663)" onmouseover="showTip(event, 'fs96', 663)" class="i">pinnacleGearRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;pinnacleGear&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs70', 664)" onmouseover="showTip(event, 'fs70', 664)" class="f">pinnacleGearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 665)" onmouseover="showTip(event, 'fs72', 665)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs97', 666)" onmouseover="showTip(event, 'fs97', 666)" class="i">rockBottomOuterwearRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;rockBottomOuterwear&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs71', 667)" onmouseover="showTip(event, 'fs71', 667)" class="f">rockBottomOuterwearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs72', 668)" onmouseover="showTip(event, 'fs72', 668)" class="i">orderProcessorRef</span>

<span onmouseout="hideTip(event, 'fs72', 669)" onmouseover="showTip(event, 'fs72', 669)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;123&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">29.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;2&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">99.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;3&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">14.95m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 670)" onmouseover="showTip(event, 'fs72', 670)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;125&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;4&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">39.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;5&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">199.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;6&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">149.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;7&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">724.99m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 671)" onmouseover="showTip(event, 'fs72', 671)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;129&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;8&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">119.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;9&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">499.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;10&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">519.00m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;11&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">209.50m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 672)" onmouseover="showTip(event, 'fs72', 672)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;135&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;12&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">0.97m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;13&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">9.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;14&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">1.99m</span> } ] }
<span onmouseout="hideTip(event, 'fs72', 673)" onmouseover="showTip(event, 'fs72', 673)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;140&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;15&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">107.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;16&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">9.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;17&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">599.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;18&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">249.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;19&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">789.99m</span> } ] }
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/Aggregator.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Resequencer" class="anchor" href="#Resequencer">Resequencer</a></h2>

<p>This pattern ensures that messages are processed in the right order.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
<span class="l">63: </span>
<span class="l">64: </span>
<span class="l">65: </span>
<span class="l">66: </span>
<span class="l">67: </span>
<span class="l">68: </span>
<span class="l">69: </span>
<span class="l">70: </span>
<span class="l">71: </span>
<span class="l">72: </span>
<span class="l">73: </span>
<span class="l">74: </span>
<span class="l">75: </span>
<span class="l">76: </span>
<span class="l">77: </span>
<span class="l">78: </span>
<span class="l">79: </span>
<span class="l">80: </span>
<span class="l">81: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs98', 674)" onmouseover="showTip(event, 'fs98', 674)" class="t">SequencedMessage</span> <span class="o">=</span>  <span onmouseout="hideTip(event, 'fs98', 675)" onmouseover="showTip(event, 'fs98', 675)" class="p">SequencedMessage</span> <span class="k">of</span> <span class="i">correlationId</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs37', 676)" onmouseover="showTip(event, 'fs37', 676)" class="t">string</span> <span class="o">*</span> <span class="i">index</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs99', 677)" onmouseover="showTip(event, 'fs99', 677)" class="t">int</span> <span class="o">*</span> <span class="i">total</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs99', 678)" onmouseover="showTip(event, 'fs99', 678)" class="t">int</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs100', 679)" onmouseover="showTip(event, 'fs100', 679)" class="t">ResequencedMessages</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs101', 680)" onmouseover="showTip(event, 'fs101', 680)" class="i">DispatchableIndex</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs99', 681)" onmouseover="showTip(event, 'fs99', 681)" class="t">int</span>; <span onmouseout="hideTip(event, 'fs102', 682)" onmouseover="showTip(event, 'fs102', 682)" class="i">SequencedMessages</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs98', 683)" onmouseover="showTip(event, 'fs98', 683)" class="t">SequencedMessage</span> [] } <span class="k">with</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs103', 684)" onmouseover="showTip(event, 'fs103', 684)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 685)" onmouseover="showTip(event, 'fs104', 685)" class="f">AdvancedTo</span>(<span onmouseout="hideTip(event, 'fs105', 686)" onmouseover="showTip(event, 'fs105', 686)" class="i">dispatchableIndex</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs99', 687)" onmouseover="showTip(event, 'fs99', 687)" class="t">int</span>) <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs103', 688)" onmouseover="showTip(event, 'fs103', 688)" class="i">this</span> <span class="k">with</span> <span class="i">DispatchableIndex</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs105', 689)" onmouseover="showTip(event, 'fs105', 689)" class="i">dispatchableIndex</span> }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs106', 690)" onmouseover="showTip(event, 'fs106', 690)" class="f">chaosRouter</span> <span onmouseout="hideTip(event, 'fs107', 691)" onmouseover="showTip(event, 'fs107', 691)" class="i">consumer</span> (<span onmouseout="hideTip(event, 'fs2', 692)" onmouseover="showTip(event, 'fs2', 692)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs108', 693)" onmouseover="showTip(event, 'fs108', 693)" class="i">random</span> <span class="o">=</span> <span class="i">Random</span>()
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 694)" onmouseover="showTip(event, 'fs3', 694)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs98', 695)" onmouseover="showTip(event, 'fs98', 695)" class="i">SequencedMessage</span>(<span class="i">correlationId</span>, <span class="i">index</span>, <span class="i">total</span>) <span class="k">as</span> <span class="i">sequencedMessage</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 696)" onmouseover="showTip(event, 'fs2', 696)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> <span class="i">millis</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs108', 697)" onmouseover="showTip(event, 'fs108', 697)" class="i">random</span><span class="o">.</span><span class="i">Next</span> <span class="n">100</span>
        <span onmouseout="hideTip(event, 'fs4', 698)" onmouseover="showTip(event, 'fs4', 698)" class="i">printfn</span> <span class="s">&quot;ChaosRouter: delaying delivery of %A for %i milliseconds&quot;</span> <span class="i">sequencedMessage</span> <span class="i">millis</span>
        <span class="k">let</span> <span class="i">duration</span> <span class="o">=</span> <span class="i">TimeSpan</span><span class="o">.</span><span class="i">FromMilliseconds</span> (<span onmouseout="hideTip(event, 'fs109', 699)" onmouseover="showTip(event, 'fs109', 699)" class="i">float</span> <span class="i">millis</span>)
        <span onmouseout="hideTip(event, 'fs2', 700)" onmouseover="showTip(event, 'fs2', 700)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs110', 701)" onmouseover="showTip(event, 'fs110', 701)" class="i">System</span><span class="o">.</span><span class="i">Scheduler</span><span class="o">.</span><span class="i">ScheduleTellOnce</span> (<span class="i">duration</span>, <span onmouseout="hideTip(event, 'fs107', 702)" onmouseover="showTip(event, 'fs107', 702)" class="i">consumer</span>, <span class="i">sequencedMessage</span>)
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 703)" onmouseover="showTip(event, 'fs3', 703)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 704)" onmouseover="showTip(event, 'fs3', 704)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs111', 705)" onmouseover="showTip(event, 'fs111', 705)" class="f">resequencerConsumer</span> <span onmouseout="hideTip(event, 'fs112', 706)" onmouseover="showTip(event, 'fs112', 706)" class="i">actualConsumer</span> (<span onmouseout="hideTip(event, 'fs2', 707)" onmouseover="showTip(event, 'fs2', 707)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs57', 708)" onmouseover="showTip(event, 'fs57', 708)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs113', 709)" onmouseover="showTip(event, 'fs113', 709)" class="i">resequenced</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let</span> <span class="i">dummySequencedMessages</span> <span class="i">count</span> <span class="o">=</span> [| <span class="k">for</span> _ <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="i">count</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs98', 710)" onmouseover="showTip(event, 'fs98', 710)" class="i">SequencedMessage</span>(<span class="s">&quot;&quot;</span>, <span class="o">-</span><span class="n">1</span>, <span class="i">count</span>) |]
        
        <span class="k">let</span> <span class="i">resequence</span> <span class="i">sequencedMessage</span> <span onmouseout="hideTip(event, 'fs113', 711)" onmouseover="showTip(event, 'fs113', 711)" class="i">resequenced</span> <span class="o">=</span> 
            <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs98', 712)" onmouseover="showTip(event, 'fs98', 712)" class="i">SequencedMessage</span>(<span class="i">correlationId</span>, <span class="i">index</span>, <span class="i">total</span>)) <span class="o">=</span> <span class="i">sequencedMessage</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 713)" onmouseover="showTip(event, 'fs113', 713)" class="i">resequenced</span> <span class="o">=</span> 
                <span onmouseout="hideTip(event, 'fs113', 714)" onmouseover="showTip(event, 'fs113', 714)" class="i">resequenced</span>
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 715)" onmouseover="showTip(event, 'fs14', 715)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 716)" onmouseover="showTip(event, 'fs39', 716)" class="i">tryFind</span> <span class="i">correlationId</span>
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 717)" onmouseover="showTip(event, 'fs40', 717)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 718)" onmouseover="showTip(event, 'fs41', 718)" class="i">fold</span> 
                    (<span class="k">fun</span> _ <span class="i">v</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs113', 719)" onmouseover="showTip(event, 'fs113', 719)" class="i">resequenced</span>) 
                    (<span onmouseout="hideTip(event, 'fs113', 720)" onmouseover="showTip(event, 'fs113', 720)" class="i">resequenced</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 721)" onmouseover="showTip(event, 'fs14', 721)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 722)" onmouseover="showTip(event, 'fs42', 722)" class="i">add</span> <span class="i">correlationId</span> ( { <span class="i">DispatchableIndex</span> <span class="o">=</span> <span class="n">1</span>; <span class="i">SequencedMessages</span> <span class="o">=</span> <span class="i">dummySequencedMessages</span> <span class="i">total</span> }))
            <span onmouseout="hideTip(event, 'fs113', 723)" onmouseover="showTip(event, 'fs113', 723)" class="i">resequenced</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 724)" onmouseover="showTip(event, 'fs14', 724)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 725)" onmouseover="showTip(event, 'fs89', 725)" class="i">find</span> <span class="i">correlationId</span>
            <span class="o">|&gt;</span> <span class="k">fun</span> <span class="i">m</span> <span class="k">-&gt;</span> <span class="i">m</span><span class="o">.</span><span class="i">SequencedMessages</span><span class="o">.</span>[<span class="i">index</span> <span class="o">-</span> <span class="n">1</span>] <span class="o">&lt;-</span> <span class="i">sequencedMessage</span>
            <span onmouseout="hideTip(event, 'fs113', 726)" onmouseover="showTip(event, 'fs113', 726)" class="i">resequenced</span>

        <span class="k">let</span> <span class="k">rec</span> <span class="i">dispatchAllSequenced</span> <span class="i">correlationId</span> <span onmouseout="hideTip(event, 'fs113', 727)" onmouseover="showTip(event, 'fs113', 727)" class="i">resequenced</span> <span class="o">=</span>
            <span class="k">let</span> <span class="i">resequencedMessage</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs113', 728)" onmouseover="showTip(event, 'fs113', 728)" class="i">resequenced</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 729)" onmouseover="showTip(event, 'fs14', 729)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 730)" onmouseover="showTip(event, 'fs89', 730)" class="i">find</span> <span class="i">correlationId</span>
            <span class="k">let</span> <span class="i">dispatchableIndex</span> <span class="o">=</span> 
                <span class="i">resequencedMessage</span><span class="o">.</span><span class="i">SequencedMessages</span> 
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs114', 731)" onmouseover="showTip(event, 'fs114', 731)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs115', 732)" onmouseover="showTip(event, 'fs115', 732)" class="i">filter</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs98', 733)" onmouseover="showTip(event, 'fs98', 733)" class="i">SequencedMessage</span>(_, <span class="i">index</span>, _) <span class="k">as</span> <span class="i">sequencedMessage</span>) <span class="k">-&gt;</span> <span class="i">index</span> <span class="o">=</span> <span class="i">resequencedMessage</span><span class="o">.</span><span class="i">DispatchableIndex</span>)
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs114', 734)" onmouseover="showTip(event, 'fs114', 734)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs116', 735)" onmouseover="showTip(event, 'fs116', 735)" class="i">fold</span> (<span class="k">fun</span> <span class="i">dispatchableIndex</span> <span class="i">sequencedMessage</span> <span class="k">-&gt;</span> 
                        <span onmouseout="hideTip(event, 'fs112', 736)" onmouseover="showTip(event, 'fs112', 736)" class="i">actualConsumer</span> <span class="o">&lt;!</span> <span class="i">sequencedMessage</span>
                        <span class="i">dispatchableIndex</span> <span class="o">+</span> <span class="n">1</span>) 
                        <span class="i">resequencedMessage</span><span class="o">.</span><span class="i">DispatchableIndex</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 737)" onmouseover="showTip(event, 'fs113', 737)" class="i">resequenced</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs113', 738)" onmouseover="showTip(event, 'fs113', 738)" class="i">resequenced</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 739)" onmouseover="showTip(event, 'fs14', 739)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 740)" onmouseover="showTip(event, 'fs42', 740)" class="i">add</span> <span class="i">correlationId</span> (<span class="i">resequencedMessage</span><span class="o">.</span><span class="i">AdvancedTo</span> <span class="i">dispatchableIndex</span>)
            <span class="k">if</span> <span class="i">resequencedMessage</span><span class="o">.</span><span class="i">SequencedMessages</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs114', 741)" onmouseover="showTip(event, 'fs114', 741)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 742)" onmouseover="showTip(event, 'fs117', 742)" class="i">exists</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs98', 743)" onmouseover="showTip(event, 'fs98', 743)" class="i">SequencedMessage</span>(_, <span class="i">index</span>, _)) <span class="k">-&gt;</span> <span class="i">index</span> <span class="o">=</span> <span class="i">dispatchableIndex</span>) <span class="k">then</span> <span class="i">dispatchAllSequenced</span> <span class="i">correlationId</span> <span onmouseout="hideTip(event, 'fs113', 744)" onmouseover="showTip(event, 'fs113', 744)" class="i">resequenced</span>
            <span class="k">else</span> <span onmouseout="hideTip(event, 'fs113', 745)" onmouseover="showTip(event, 'fs113', 745)" class="i">resequenced</span>

        <span class="k">let</span> <span class="i">removeCompleted</span> <span class="i">correlationId</span> <span onmouseout="hideTip(event, 'fs113', 746)" onmouseover="showTip(event, 'fs113', 746)" class="i">resequenced</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs113', 747)" onmouseover="showTip(event, 'fs113', 747)" class="i">resequenced</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 748)" onmouseover="showTip(event, 'fs14', 748)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 749)" onmouseover="showTip(event, 'fs89', 749)" class="i">find</span> <span class="i">correlationId</span>
            <span class="o">|&gt;</span> <span class="k">fun</span> <span class="i">resequencedMessages</span> <span class="k">-&gt;</span> 
                <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs98', 750)" onmouseover="showTip(event, 'fs98', 750)" class="i">SequencedMessage</span>(_,_,<span class="i">total</span>)) <span class="o">=</span> <span class="i">resequencedMessages</span><span class="o">.</span><span class="i">SequencedMessages</span><span class="o">.</span>[<span class="n">0</span>]
                <span class="k">if</span> <span class="i">resequencedMessages</span><span class="o">.</span><span class="i">DispatchableIndex</span> <span class="o">&gt;</span> <span class="i">total</span> <span class="k">then</span>
                    <span onmouseout="hideTip(event, 'fs4', 751)" onmouseover="showTip(event, 'fs4', 751)" class="i">printfn</span> <span class="s">&quot;ResequencerConsumer: removed completed: %s&quot;</span> <span class="i">correlationId</span>
                    <span onmouseout="hideTip(event, 'fs113', 752)" onmouseover="showTip(event, 'fs113', 752)" class="i">resequenced</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 753)" onmouseover="showTip(event, 'fs14', 753)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 754)" onmouseover="showTip(event, 'fs45', 754)" class="i">remove</span> <span class="i">correlationId</span>
                <span class="k">else</span> <span onmouseout="hideTip(event, 'fs113', 755)" onmouseover="showTip(event, 'fs113', 755)" class="i">resequenced</span>

        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs98', 756)" onmouseover="showTip(event, 'fs98', 756)" class="i">SequencedMessage</span>(<span class="i">correlationId</span>, <span class="i">index</span>, <span class="i">total</span>) <span class="k">as</span> <span class="i">unsequencedMessage</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 757)" onmouseover="showTip(event, 'fs2', 757)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 758)" onmouseover="showTip(event, 'fs4', 758)" class="i">printfn</span> <span class="s">&quot;ResequencerConsumer: received: %A&quot;</span> <span class="i">unsequencedMessage</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 759)" onmouseover="showTip(event, 'fs113', 759)" class="i">resequenced</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs113', 760)" onmouseover="showTip(event, 'fs113', 760)" class="i">resequenced</span>
            <span class="o">|&gt;</span> <span class="i">resequence</span> <span class="i">unsequencedMessage</span>
            <span class="o">|&gt;</span> <span class="i">dispatchAllSequenced</span> <span class="i">correlationId</span>
            <span class="o">|&gt;</span> <span class="i">removeCompleted</span> <span class="i">correlationId</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 761)" onmouseover="showTip(event, 'fs57', 761)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs113', 762)" onmouseover="showTip(event, 'fs113', 762)" class="i">resequenced</span>
    }
    <span onmouseout="hideTip(event, 'fs57', 763)" onmouseover="showTip(event, 'fs57', 763)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 764)" onmouseover="showTip(event, 'fs14', 764)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 765)" onmouseover="showTip(event, 'fs49', 765)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs118', 766)" onmouseover="showTip(event, 'fs118', 766)" class="f">sequencedMessageConsumer</span> (<span onmouseout="hideTip(event, 'fs2', 767)" onmouseover="showTip(event, 'fs2', 767)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs98', 768)" onmouseover="showTip(event, 'fs98', 768)" class="i">SequencedMessage</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 769)" onmouseover="showTip(event, 'fs3', 769)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">sequencedMessage</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 770)" onmouseover="showTip(event, 'fs2', 770)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span onmouseout="hideTip(event, 'fs4', 771)" onmouseover="showTip(event, 'fs4', 771)" class="i">printfn</span> <span class="s">&quot;SequencedMessageConsumer: received: %A&quot;</span> <span class="i">sequencedMessage</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 772)" onmouseover="showTip(event, 'fs3', 772)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 773)" onmouseover="showTip(event, 'fs3', 773)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 774)" onmouseover="showTip(event, 'fs119', 774)" class="i">sequencedMessageConsumerRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;sequencedMessageConsumer&quot;</span> <span onmouseout="hideTip(event, 'fs118', 775)" onmouseover="showTip(event, 'fs118', 775)" class="i">sequencedMessageConsumer</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 776)" onmouseover="showTip(event, 'fs120', 776)" class="i">resequencerConsumerRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;resequencerConsumer&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs111', 777)" onmouseover="showTip(event, 'fs111', 777)" class="f">resequencerConsumer</span> <span onmouseout="hideTip(event, 'fs119', 778)" onmouseover="showTip(event, 'fs119', 778)" class="i">sequencedMessageConsumerRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs121', 779)" onmouseover="showTip(event, 'fs121', 779)" class="i">chaosRouterRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;chaosRouter&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs106', 780)" onmouseover="showTip(event, 'fs106', 780)" class="f">chaosRouter</span> <span onmouseout="hideTip(event, 'fs120', 781)" onmouseover="showTip(event, 'fs120', 781)" class="i">resequencerConsumerRef</span>

[<span class="n">1</span> <span class="o">..</span> <span class="n">5</span>] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 782)" onmouseover="showTip(event, 'fs59', 782)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 783)" onmouseover="showTip(event, 'fs63', 783)" class="f">iter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs122', 784)" onmouseover="showTip(event, 'fs122', 784)" class="i">index</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs121', 785)" onmouseover="showTip(event, 'fs121', 785)" class="i">chaosRouterRef</span> <span class="o">&lt;!</span> <span onmouseout="hideTip(event, 'fs98', 786)" onmouseover="showTip(event, 'fs98', 786)" class="p">SequencedMessage</span>(<span class="s">&quot;ABC&quot;</span>, <span onmouseout="hideTip(event, 'fs122', 787)" onmouseover="showTip(event, 'fs122', 787)" class="i">index</span>, <span class="n">5</span>))
[<span class="n">1</span> <span class="o">..</span> <span class="n">5</span>] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 788)" onmouseover="showTip(event, 'fs59', 788)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 789)" onmouseover="showTip(event, 'fs63', 789)" class="f">iter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs122', 790)" onmouseover="showTip(event, 'fs122', 790)" class="i">index</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs121', 791)" onmouseover="showTip(event, 'fs121', 791)" class="i">chaosRouterRef</span> <span class="o">&lt;!</span> <span onmouseout="hideTip(event, 'fs98', 792)" onmouseover="showTip(event, 'fs98', 792)" class="p">SequencedMessage</span>(<span class="s">&quot;XYZ&quot;</span>, <span onmouseout="hideTip(event, 'fs122', 793)" onmouseover="showTip(event, 'fs122', 793)" class="i">index</span>, <span class="n">5</span>))
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/Resequencer.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Composed-Message-Processor" class="anchor" href="#Composed-Message-Processor">Composed Message Processor</a></h2>

<p>This pattern handles composite messages by splitting them, routing the parts and then aggregating the results.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// No code example</span>
</code></pre></td>
</tr>
</table>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Scatter-Gather" class="anchor" href="#Scatter-Gather">Scatter-Gather</a></h2>

<p>This pattern broadcasts a message to multiple actors and then aggregates the results.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">  1: </span>
<span class="l">  2: </span>
<span class="l">  3: </span>
<span class="l">  4: </span>
<span class="l">  5: </span>
<span class="l">  6: </span>
<span class="l">  7: </span>
<span class="l">  8: </span>
<span class="l">  9: </span>
<span class="l"> 10: </span>
<span class="l"> 11: </span>
<span class="l"> 12: </span>
<span class="l"> 13: </span>
<span class="l"> 14: </span>
<span class="l"> 15: </span>
<span class="l"> 16: </span>
<span class="l"> 17: </span>
<span class="l"> 18: </span>
<span class="l"> 19: </span>
<span class="l"> 20: </span>
<span class="l"> 21: </span>
<span class="l"> 22: </span>
<span class="l"> 23: </span>
<span class="l"> 24: </span>
<span class="l"> 25: </span>
<span class="l"> 26: </span>
<span class="l"> 27: </span>
<span class="l"> 28: </span>
<span class="l"> 29: </span>
<span class="l"> 30: </span>
<span class="l"> 31: </span>
<span class="l"> 32: </span>
<span class="l"> 33: </span>
<span class="l"> 34: </span>
<span class="l"> 35: </span>
<span class="l"> 36: </span>
<span class="l"> 37: </span>
<span class="l"> 38: </span>
<span class="l"> 39: </span>
<span class="l"> 40: </span>
<span class="l"> 41: </span>
<span class="l"> 42: </span>
<span class="l"> 43: </span>
<span class="l"> 44: </span>
<span class="l"> 45: </span>
<span class="l"> 46: </span>
<span class="l"> 47: </span>
<span class="l"> 48: </span>
<span class="l"> 49: </span>
<span class="l"> 50: </span>
<span class="l"> 51: </span>
<span class="l"> 52: </span>
<span class="l"> 53: </span>
<span class="l"> 54: </span>
<span class="l"> 55: </span>
<span class="l"> 56: </span>
<span class="l"> 57: </span>
<span class="l"> 58: </span>
<span class="l"> 59: </span>
<span class="l"> 60: </span>
<span class="l"> 61: </span>
<span class="l"> 62: </span>
<span class="l"> 63: </span>
<span class="l"> 64: </span>
<span class="l"> 65: </span>
<span class="l"> 66: </span>
<span class="l"> 67: </span>
<span class="l"> 68: </span>
<span class="l"> 69: </span>
<span class="l"> 70: </span>
<span class="l"> 71: </span>
<span class="l"> 72: </span>
<span class="l"> 73: </span>
<span class="l"> 74: </span>
<span class="l"> 75: </span>
<span class="l"> 76: </span>
<span class="l"> 77: </span>
<span class="l"> 78: </span>
<span class="l"> 79: </span>
<span class="l"> 80: </span>
<span class="l"> 81: </span>
<span class="l"> 82: </span>
<span class="l"> 83: </span>
<span class="l"> 84: </span>
<span class="l"> 85: </span>
<span class="l"> 86: </span>
<span class="l"> 87: </span>
<span class="l"> 88: </span>
<span class="l"> 89: </span>
<span class="l"> 90: </span>
<span class="l"> 91: </span>
<span class="l"> 92: </span>
<span class="l"> 93: </span>
<span class="l"> 94: </span>
<span class="l"> 95: </span>
<span class="l"> 96: </span>
<span class="l"> 97: </span>
<span class="l"> 98: </span>
<span class="l"> 99: </span>
<span class="l">100: </span>
<span class="l">101: </span>
<span class="l">102: </span>
<span class="l">103: </span>
<span class="l">104: </span>
<span class="l">105: </span>
<span class="l">106: </span>
<span class="l">107: </span>
<span class="l">108: </span>
<span class="l">109: </span>
<span class="l">110: </span>
<span class="l">111: </span>
<span class="l">112: </span>
<span class="l">113: </span>
<span class="l">114: </span>
<span class="l">115: </span>
<span class="l">116: </span>
<span class="l">117: </span>
<span class="l">118: </span>
<span class="l">119: </span>
<span class="l">120: </span>
<span class="l">121: </span>
<span class="l">122: </span>
<span class="l">123: </span>
<span class="l">124: </span>
<span class="l">125: </span>
<span class="l">126: </span>
<span class="l">127: </span>
<span class="l">128: </span>
<span class="l">129: </span>
<span class="l">130: </span>
<span class="l">131: </span>
<span class="l">132: </span>
<span class="l">133: </span>
<span class="l">134: </span>
<span class="l">135: </span>
<span class="l">136: </span>
<span class="l">137: </span>
<span class="l">138: </span>
<span class="l">139: </span>
<span class="l">140: </span>
<span class="l">141: </span>
<span class="l">142: </span>
<span class="l">143: </span>
<span class="l">144: </span>
<span class="l">145: </span>
<span class="l">146: </span>
<span class="l">147: </span>
<span class="l">148: </span>
<span class="l">149: </span>
<span class="l">150: </span>
<span class="l">151: </span>
<span class="l">152: </span>
<span class="l">153: </span>
<span class="l">154: </span>
<span class="l">155: </span>
<span class="l">156: </span>
<span class="l">157: </span>
<span class="l">158: </span>
<span class="l">159: </span>
<span class="l">160: </span>
<span class="l">161: </span>
<span class="l">162: </span>
<span class="l">163: </span>
<span class="l">164: </span>
<span class="l">165: </span>
<span class="l">166: </span>
<span class="l">167: </span>
<span class="l">168: </span>
<span class="l">169: </span>
<span class="l">170: </span>
<span class="l">171: </span>
<span class="l">172: </span>
<span class="l">173: </span>
<span class="l">174: </span>
<span class="l">175: </span>
<span class="l">176: </span>
<span class="l">177: </span>
<span class="l">178: </span>
<span class="l">179: </span>
<span class="l">180: </span>
<span class="l">181: </span>
<span class="l">182: </span>
<span class="l">183: </span>
<span class="l">184: </span>
<span class="l">185: </span>
<span class="l">186: </span>
<span class="l">187: </span>
<span class="l">188: </span>
<span class="l">189: </span>
<span class="l">190: </span>
<span class="l">191: </span>
<span class="l">192: </span>
<span class="l">193: </span>
<span class="l">194: </span>
<span class="l">195: </span>
<span class="l">196: </span>
<span class="l">197: </span>
<span class="l">198: </span>
<span class="l">199: </span>
<span class="l">200: </span>
<span class="l">201: </span>
<span class="l">202: </span>
<span class="l">203: </span>
<span class="l">204: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs87', 794)" onmouseover="showTip(event, 'fs87', 794)" class="f">priceQuoteAggregator</span> (<span onmouseout="hideTip(event, 'fs2', 795)" onmouseover="showTip(event, 'fs2', 795)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs57', 796)" onmouseover="showTip(event, 'fs57', 796)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs88', 797)" onmouseover="showTip(event, 'fs88', 797)" class="i">fulfilledPriceQuotes</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let</span> <span class="i">bestPriceQuotationFrom</span> (<span class="i">quotationFulfillment</span><span class="o">:</span> <span class="i">QuotationFulfillment</span>) <span class="o">=</span>
            <span class="k">let</span> <span class="i">bestPrices</span> <span class="o">=</span> 
                <span class="i">quotationFulfillment</span><span class="o">.</span><span class="i">PriceQuotes</span>
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 798)" onmouseover="showTip(event, 'fs59', 798)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs123', 799)" onmouseover="showTip(event, 'fs123', 799)" class="i">groupBy</span> (<span class="k">fun</span> <span class="i">priceQuote</span> <span class="k">-&gt;</span> <span class="i">priceQuote</span><span class="o">.</span><span class="i">ItemId</span>)
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 800)" onmouseover="showTip(event, 'fs59', 800)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 801)" onmouseover="showTip(event, 'fs61', 801)" class="i">map</span> (<span class="k">fun</span> (<span class="i">itemId</span>, <span class="i">quotes</span>) <span class="k">-&gt;</span> 
                    <span class="i">quotes</span> 
                    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 802)" onmouseover="showTip(event, 'fs59', 802)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs124', 803)" onmouseover="showTip(event, 'fs124', 803)" class="i">maxBy</span> (<span class="k">fun</span> <span class="i">quote</span> <span class="k">-&gt;</span>  
                        <span class="k">let</span> (<span class="i">Money</span> <span class="i">discount</span>) <span class="o">=</span> <span class="i">quote</span><span class="o">.</span><span class="i">DiscountPrice</span>
                        <span class="i">discount</span>))
            { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">quotationFulfillment</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">PriceQuotes</span> <span class="o">=</span> <span class="i">bestPrices</span> }
        
        <span class="k">let</span> <span class="i">quoteBestPrice</span> (<span class="i">quotationFulfillment</span><span class="o">:</span> <span class="i">QuotationFulfillment</span>) <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs88', 804)" onmouseover="showTip(event, 'fs88', 804)" class="i">fulfilledPriceQuotes</span> 
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 805)" onmouseover="showTip(event, 'fs14', 805)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 806)" onmouseover="showTip(event, 'fs39', 806)" class="i">tryFind</span> <span class="i">quotationFulfillment</span><span class="o">.</span><span class="i">RfqId</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 807)" onmouseover="showTip(event, 'fs40', 807)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 808)" onmouseover="showTip(event, 'fs47', 808)" class="i">map</span> (<span class="k">fun</span> <span class="i">q</span> <span class="k">-&gt;</span> <span class="i">quotationFulfillment</span><span class="o">.</span><span class="i">Requester</span> <span class="o">&lt;!</span> <span class="i">bestPriceQuotationFrom</span> <span class="i">quotationFulfillment</span>)
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 809)" onmouseover="showTip(event, 'fs40', 809)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 810)" onmouseover="showTip(event, 'fs41', 810)" class="i">fold</span> (<span class="k">fun</span> _ _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs88', 811)" onmouseover="showTip(event, 'fs88', 811)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 812)" onmouseover="showTip(event, 'fs14', 812)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 813)" onmouseover="showTip(event, 'fs45', 813)" class="i">remove</span> <span class="i">quotationFulfillment</span><span class="o">.</span><span class="i">RfqId</span>) <span onmouseout="hideTip(event, 'fs88', 814)" onmouseover="showTip(event, 'fs88', 814)" class="i">fulfilledPriceQuotes</span>

        <span class="k">let</span> <span class="i">priceQuoteRequestTimedOut</span> <span class="i">rfqId</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs88', 815)" onmouseover="showTip(event, 'fs88', 815)" class="i">fulfilledPriceQuotes</span> 
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 816)" onmouseover="showTip(event, 'fs14', 816)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs39', 817)" onmouseover="showTip(event, 'fs39', 817)" class="i">tryFind</span> <span class="i">rfqId</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs40', 818)" onmouseover="showTip(event, 'fs40', 818)" class="i">Option</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 819)" onmouseover="showTip(event, 'fs41', 819)" class="i">fold</span> (<span class="k">fun</span> _ _ <span class="k">-&gt;</span> <span class="i">quoteBestPrice</span> (<span onmouseout="hideTip(event, 'fs88', 820)" onmouseover="showTip(event, 'fs88', 820)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 821)" onmouseover="showTip(event, 'fs14', 821)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 822)" onmouseover="showTip(event, 'fs89', 822)" class="i">find</span> <span class="i">rfqId</span>)) <span onmouseout="hideTip(event, 'fs88', 823)" onmouseover="showTip(event, 'fs88', 823)" class="i">fulfilledPriceQuotes</span>

        <span class="k">let</span> <span class="i">priceQuoteRequestFulfilled</span> (<span class="i">priceQuoteFulfilled</span><span class="o">:</span> <span class="i">PriceQuote</span>) <span class="o">=</span>
            <span class="k">let</span> <span class="i">previousFulfillment</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs88', 824)" onmouseover="showTip(event, 'fs88', 824)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 825)" onmouseover="showTip(event, 'fs14', 825)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 826)" onmouseover="showTip(event, 'fs89', 826)" class="i">find</span> <span class="i">priceQuoteFulfilled</span><span class="o">.</span><span class="i">RfqId</span>
            <span class="k">let</span> <span class="i">currentPriceQuotes</span> <span class="o">=</span> <span class="i">previousFulfillment</span><span class="o">.</span><span class="i">PriceQuotes</span> <span class="o">@</span> [<span class="i">priceQuoteFulfilled</span>]
            <span class="k">let</span> <span class="i">currentFulfillment</span> <span class="o">=</span> { <span class="i">previousFulfillment</span> <span class="k">with</span> <span class="i">PriceQuotes</span> <span class="o">=</span> <span class="i">currentPriceQuotes</span> }
            <span class="k">if</span> (<span class="i">currentPriceQuotes</span><span class="o">.</span><span class="i">Length</span> <span class="o">&gt;</span><span class="o">=</span> <span class="i">currentFulfillment</span><span class="o">.</span><span class="i">QuotesRequested</span>) <span class="k">then</span> <span class="i">quoteBestPrice</span> <span class="i">currentFulfillment</span>
            <span class="k">else</span> <span onmouseout="hideTip(event, 'fs88', 827)" onmouseover="showTip(event, 'fs88', 827)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 828)" onmouseover="showTip(event, 'fs14', 828)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 829)" onmouseover="showTip(event, 'fs42', 829)" class="i">add</span> <span class="i">priceQuoteFulfilled</span><span class="o">.</span><span class="i">RfqId</span> <span class="i">currentFulfillment</span>

        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 830)" onmouseover="showTip(event, 'fs2', 830)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">match</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="i">RequiredPriceQuotesForFulfillment</span>(<span class="i">rfqId</span>, <span class="i">quotesRequested</span>) <span class="k">as</span> <span class="i">message</span> <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 831)" onmouseover="showTip(event, 'fs4', 831)" class="i">printfn</span> <span class="s">&quot;PriceQuoteAggregator: required fulfilled: %A&quot;</span> <span class="i">message</span>
            <span class="k">let</span> <span class="i">duration</span> <span class="o">=</span> <span class="i">TimeSpan</span><span class="o">.</span><span class="i">FromSeconds</span> <span class="n">2.</span>
            <span onmouseout="hideTip(event, 'fs2', 832)" onmouseover="showTip(event, 'fs2', 832)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs110', 833)" onmouseover="showTip(event, 'fs110', 833)" class="i">System</span><span class="o">.</span><span class="i">Scheduler</span><span class="o">.</span><span class="i">ScheduleTellOnce</span> (<span class="i">duration</span>, <span onmouseout="hideTip(event, 'fs2', 834)" onmouseover="showTip(event, 'fs2', 834)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>, <span class="i">PriceQuoteTimedOut</span> <span class="i">rfqId</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 835)" onmouseover="showTip(event, 'fs57', 835)" class="i">loop</span> (<span onmouseout="hideTip(event, 'fs88', 836)" onmouseover="showTip(event, 'fs88', 836)" class="i">fulfilledPriceQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 837)" onmouseover="showTip(event, 'fs14', 837)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 838)" onmouseover="showTip(event, 'fs42', 838)" class="i">add</span> <span class="i">rfqId</span> ({<span class="i">RfqId</span> <span class="o">=</span> <span class="i">rfqId</span>; <span class="i">QuotesRequested</span> <span class="o">=</span> <span class="i">quotesRequested</span>; <span class="i">PriceQuotes</span> <span class="o">=</span> []; <span class="i">Requester</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 839)" onmouseover="showTip(event, 'fs2', 839)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () }))
        | <span class="i">PriceQuoteFulfilled</span> <span class="i">priceQuote</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs4', 840)" onmouseover="showTip(event, 'fs4', 840)" class="i">printfn</span> <span class="s">&quot;PriceQuoteAggregator: fulfilled price quote: %A&quot;</span> <span class="i">priceQuote</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 841)" onmouseover="showTip(event, 'fs57', 841)" class="i">loop</span> <span class="o">&lt;|</span> <span class="i">priceQuoteRequestFulfilled</span> <span class="i">priceQuote</span>
        | <span class="i">PriceQuoteTimedOut</span> <span class="i">rfqId</span> <span class="k">-&gt;</span> <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 842)" onmouseover="showTip(event, 'fs57', 842)" class="i">loop</span> <span class="o">&lt;|</span> <span class="i">priceQuoteRequestTimedOut</span> <span class="i">rfqId</span>
    }
    <span onmouseout="hideTip(event, 'fs57', 843)" onmouseover="showTip(event, 'fs57', 843)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 844)" onmouseover="showTip(event, 'fs14', 844)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 845)" onmouseover="showTip(event, 'fs49', 845)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs90', 846)" onmouseover="showTip(event, 'fs90', 846)" class="f">mountaineeringSuppliesOrderProcessor</span> <span onmouseout="hideTip(event, 'fs91', 847)" onmouseover="showTip(event, 'fs91', 847)" class="i">priceQuoteAggregator</span> (<span onmouseout="hideTip(event, 'fs2', 848)" onmouseover="showTip(event, 'fs2', 848)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs57', 849)" onmouseover="showTip(event, 'fs57', 849)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs125', 850)" onmouseover="showTip(event, 'fs125', 850)" class="i">subscribers</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let</span> <span class="i">dispatch</span> <span class="i">rfq</span> <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs125', 851)" onmouseover="showTip(event, 'fs125', 851)" class="i">subscribers</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 852)" onmouseover="showTip(event, 'fs14', 852)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs58', 853)" onmouseover="showTip(event, 'fs58', 853)" class="i">toList</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 854)" onmouseover="showTip(event, 'fs59', 854)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 855)" onmouseover="showTip(event, 'fs63', 855)" class="i">iter</span> (<span class="k">fun</span> (_, (<span class="i">SubscribeToPriceQuoteRequests</span>(<span class="i">quoterId</span>, <span class="i">quoteProcessor</span>) <span class="k">as</span> <span class="i">subscriber</span>)) <span class="k">-&gt;</span>
                <span class="i">rfq</span><span class="o">.</span><span class="i">RetailItems</span>
                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 856)" onmouseover="showTip(event, 'fs59', 856)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 857)" onmouseover="showTip(event, 'fs63', 857)" class="i">iter</span> (<span class="k">fun</span> <span class="i">retailItem</span> <span class="k">-&gt;</span> 
                    <span onmouseout="hideTip(event, 'fs4', 858)" onmouseover="showTip(event, 'fs4', 858)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: %s item: %s to: %s&quot;</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">ItemId</span> <span class="i">quoterId</span>
                    <span class="i">quoteProcessor</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">Money</span> <span class="i">retailItem</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">OrderTotalRetailPrice</span> <span class="o">=</span> <span class="i">Money</span> <span class="i">rfq</span><span class="o">.</span><span class="i">TotalRetailPrice</span> }))

        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 859)" onmouseover="showTip(event, 'fs2', 859)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs48', 860)" onmouseover="showTip(event, 'fs48', 860)" class="i">box</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="o">:?</span> <span class="i">SubscribeToPriceQuoteRequests</span> <span class="k">as</span> <span class="i">subscriber</span> <span class="k">-&gt;</span> 
            <span class="k">let</span> (<span class="i">SubscribeToPriceQuoteRequests</span>(<span class="i">quoterId</span>, <span class="i">quoteProcessor</span>)) <span class="o">=</span> <span class="i">subscriber</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 861)" onmouseover="showTip(event, 'fs57', 861)" class="i">loop</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs14', 862)" onmouseover="showTip(event, 'fs14', 862)" class="i">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 863)" onmouseover="showTip(event, 'fs42', 863)" class="i">add</span> <span class="i">quoteProcessor</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">Name</span> <span class="i">subscriber</span> <span onmouseout="hideTip(event, 'fs125', 864)" onmouseover="showTip(event, 'fs125', 864)" class="i">subscribers</span> 
        | <span class="o">:?</span> <span class="i">PriceQuote</span> <span class="k">as</span> <span class="i">priceQuote</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs91', 865)" onmouseover="showTip(event, 'fs91', 865)" class="i">priceQuoteAggregator</span> <span class="o">&lt;!</span> <span class="i">PriceQuoteFulfilled</span> <span class="i">priceQuote</span>
            <span onmouseout="hideTip(event, 'fs4', 866)" onmouseover="showTip(event, 'fs4', 866)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: received: %A&quot;</span> <span class="i">priceQuote</span>
        | <span class="o">:?</span> <span class="i">RequestForQuotation</span> <span class="k">as</span> <span class="i">rfq</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs91', 867)" onmouseover="showTip(event, 'fs91', 867)" class="i">priceQuoteAggregator</span> <span class="o">&lt;!</span> <span class="i">RequiredPriceQuotesForFulfillment</span>(<span class="i">rfq</span><span class="o">.</span><span class="i">RfqId</span>, <span onmouseout="hideTip(event, 'fs125', 868)" onmouseover="showTip(event, 'fs125', 868)" class="i">subscribers</span><span class="o">.</span><span class="i">Count</span> <span class="o">*</span> <span class="i">rfq</span><span class="o">.</span><span class="i">RetailItems</span><span class="o">.</span><span class="i">Length</span>)
            <span class="i">dispatch</span> <span class="i">rfq</span>
        | <span class="o">:?</span> <span class="i">BestPriceQuotation</span> <span class="k">as</span> <span class="i">bestPriceQuotation</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 869)" onmouseover="showTip(event, 'fs4', 869)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: received: %A&quot;</span> <span class="i">bestPriceQuotation</span>
        | <span class="i">message</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 870)" onmouseover="showTip(event, 'fs4', 870)" class="i">printfn</span> <span class="s">&quot;OrderProcessor: unexpected: %A&quot;</span> <span class="i">message</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 871)" onmouseover="showTip(event, 'fs57', 871)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs125', 872)" onmouseover="showTip(event, 'fs125', 872)" class="i">subscribers</span> 
    }
    <span onmouseout="hideTip(event, 'fs57', 873)" onmouseover="showTip(event, 'fs57', 873)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 874)" onmouseover="showTip(event, 'fs14', 874)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 875)" onmouseover="showTip(event, 'fs49', 875)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs126', 876)" onmouseover="showTip(event, 'fs126', 876)" class="f">budgetHikersPriceQuotes</span> <span onmouseout="hideTip(event, 'fs127', 877)" onmouseover="showTip(event, 'fs127', 877)" class="i">priceQuoteRequestPublisher</span> (<span onmouseout="hideTip(event, 'fs2', 878)" onmouseover="showTip(event, 'fs2', 878)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 879)" onmouseover="showTip(event, 'fs128', 879)" class="i">quoterId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 880)" onmouseover="showTip(event, 'fs2', 880)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">Name</span>
    <span onmouseout="hideTip(event, 'fs127', 881)" onmouseover="showTip(event, 'fs127', 881)" class="i">priceQuoteRequestPublisher</span> <span class="o">&lt;!</span> <span class="i">SubscribeToPriceQuoteRequests</span>(<span onmouseout="hideTip(event, 'fs128', 882)" onmouseover="showTip(event, 'fs128', 882)" class="i">quoterId</span>, <span onmouseout="hideTip(event, 'fs2', 883)" onmouseover="showTip(event, 'fs2', 883)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>)

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 884)" onmouseover="showTip(event, 'fs66', 884)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 885)" onmouseover="showTip(event, 'fs67', 885)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 886)" onmouseover="showTip(event, 'fs67', 886)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">100.00m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 887)" onmouseover="showTip(event, 'fs67', 887)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 888)" onmouseover="showTip(event, 'fs67', 888)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 889)" onmouseover="showTip(event, 'fs67', 889)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.07m</span>
        <span class="k">else</span> <span class="n">0.075m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 890)" onmouseover="showTip(event, 'fs3', 890)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 891)" onmouseover="showTip(event, 'fs2', 891)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 892)" onmouseover="showTip(event, 'fs66', 892)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 893)" onmouseover="showTip(event, 'fs2', 893)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 894)" onmouseover="showTip(event, 'fs3', 894)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 895)" onmouseover="showTip(event, 'fs3', 895)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs129', 896)" onmouseover="showTip(event, 'fs129', 896)" class="f">highSierraPriceQuotes</span> <span onmouseout="hideTip(event, 'fs127', 897)" onmouseover="showTip(event, 'fs127', 897)" class="i">priceQuoteRequestPublisher</span> (<span onmouseout="hideTip(event, 'fs2', 898)" onmouseover="showTip(event, 'fs2', 898)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 899)" onmouseover="showTip(event, 'fs128', 899)" class="i">quoterId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 900)" onmouseover="showTip(event, 'fs2', 900)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">Name</span>
    <span onmouseout="hideTip(event, 'fs127', 901)" onmouseover="showTip(event, 'fs127', 901)" class="i">priceQuoteRequestPublisher</span> <span class="o">&lt;!</span> <span class="i">SubscribeToPriceQuoteRequests</span>(<span onmouseout="hideTip(event, 'fs128', 902)" onmouseover="showTip(event, 'fs128', 902)" class="i">quoterId</span>, <span onmouseout="hideTip(event, 'fs2', 903)" onmouseover="showTip(event, 'fs2', 903)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>)
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 904)" onmouseover="showTip(event, 'fs66', 904)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 905)" onmouseover="showTip(event, 'fs67', 905)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 906)" onmouseover="showTip(event, 'fs67', 906)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">150.00m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 907)" onmouseover="showTip(event, 'fs67', 907)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 908)" onmouseover="showTip(event, 'fs67', 908)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 909)" onmouseover="showTip(event, 'fs67', 909)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">else</span> <span class="n">0.05m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 910)" onmouseover="showTip(event, 'fs3', 910)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 911)" onmouseover="showTip(event, 'fs2', 911)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">if</span> <span class="i">orderTotalRetailPrice</span> <span class="o">&lt;</span> <span class="n">1000.00m</span> <span class="k">then</span>
            <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 912)" onmouseover="showTip(event, 'fs66', 912)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
            <span onmouseout="hideTip(event, 'fs2', 913)" onmouseover="showTip(event, 'fs2', 913)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">else</span> <span onmouseout="hideTip(event, 'fs4', 914)" onmouseover="showTip(event, 'fs4', 914)" class="i">printfn</span> <span class="s">&quot;BudgetHikersPriceQuotes: ignoring: %A&quot;</span> <span class="i">rpq</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 915)" onmouseover="showTip(event, 'fs3', 915)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 916)" onmouseover="showTip(event, 'fs3', 916)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs130', 917)" onmouseover="showTip(event, 'fs130', 917)" class="f">mountainAscentPriceQuotes</span> <span onmouseout="hideTip(event, 'fs127', 918)" onmouseover="showTip(event, 'fs127', 918)" class="i">priceQuoteRequestPublisher</span> (<span onmouseout="hideTip(event, 'fs2', 919)" onmouseover="showTip(event, 'fs2', 919)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 920)" onmouseover="showTip(event, 'fs128', 920)" class="i">quoterId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 921)" onmouseover="showTip(event, 'fs2', 921)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">Name</span>
    <span onmouseout="hideTip(event, 'fs127', 922)" onmouseover="showTip(event, 'fs127', 922)" class="i">priceQuoteRequestPublisher</span> <span class="o">&lt;!</span> <span class="i">SubscribeToPriceQuoteRequests</span>(<span onmouseout="hideTip(event, 'fs128', 923)" onmouseover="showTip(event, 'fs128', 923)" class="i">quoterId</span>, <span onmouseout="hideTip(event, 'fs2', 924)" onmouseover="showTip(event, 'fs2', 924)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>)
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 925)" onmouseover="showTip(event, 'fs66', 925)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 926)" onmouseover="showTip(event, 'fs67', 926)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 927)" onmouseover="showTip(event, 'fs67', 927)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">99.99m</span>) <span class="k">then</span> <span class="n">0.01m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 928)" onmouseover="showTip(event, 'fs67', 928)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">199.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 929)" onmouseover="showTip(event, 'fs67', 929)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 930)" onmouseover="showTip(event, 'fs67', 930)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 931)" onmouseover="showTip(event, 'fs67', 931)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 932)" onmouseover="showTip(event, 'fs67', 932)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">2999.99m</span>) <span class="k">then</span> <span class="n">0.0475m</span>
        <span class="k">else</span> <span class="n">0.05m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 933)" onmouseover="showTip(event, 'fs3', 933)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 934)" onmouseover="showTip(event, 'fs2', 934)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 935)" onmouseover="showTip(event, 'fs66', 935)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 936)" onmouseover="showTip(event, 'fs2', 936)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 937)" onmouseover="showTip(event, 'fs3', 937)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 938)" onmouseover="showTip(event, 'fs3', 938)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs131', 939)" onmouseover="showTip(event, 'fs131', 939)" class="f">pinnacleGearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs127', 940)" onmouseover="showTip(event, 'fs127', 940)" class="i">priceQuoteRequestPublisher</span> (<span onmouseout="hideTip(event, 'fs2', 941)" onmouseover="showTip(event, 'fs2', 941)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 942)" onmouseover="showTip(event, 'fs128', 942)" class="i">quoterId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 943)" onmouseover="showTip(event, 'fs2', 943)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">Name</span>
    <span onmouseout="hideTip(event, 'fs127', 944)" onmouseover="showTip(event, 'fs127', 944)" class="i">priceQuoteRequestPublisher</span> <span class="o">&lt;!</span> <span class="i">SubscribeToPriceQuoteRequests</span>(<span onmouseout="hideTip(event, 'fs128', 945)" onmouseover="showTip(event, 'fs128', 945)" class="i">quoterId</span>, <span onmouseout="hideTip(event, 'fs2', 946)" onmouseover="showTip(event, 'fs2', 946)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>)
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 947)" onmouseover="showTip(event, 'fs66', 947)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 948)" onmouseover="showTip(event, 'fs67', 948)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 949)" onmouseover="showTip(event, 'fs67', 949)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">299.99m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 950)" onmouseover="showTip(event, 'fs67', 950)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.0175m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 951)" onmouseover="showTip(event, 'fs67', 951)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 952)" onmouseover="showTip(event, 'fs67', 952)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 953)" onmouseover="showTip(event, 'fs67', 953)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">1199.99m</span>) <span class="k">then</span> <span class="n">0.035m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 954)" onmouseover="showTip(event, 'fs67', 954)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 955)" onmouseover="showTip(event, 'fs67', 955)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">7999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">else</span> <span class="n">0.06m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 956)" onmouseover="showTip(event, 'fs3', 956)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 957)" onmouseover="showTip(event, 'fs2', 957)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 958)" onmouseover="showTip(event, 'fs66', 958)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
        <span onmouseout="hideTip(event, 'fs2', 959)" onmouseover="showTip(event, 'fs2', 959)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 960)" onmouseover="showTip(event, 'fs3', 960)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 961)" onmouseover="showTip(event, 'fs3', 961)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs132', 962)" onmouseover="showTip(event, 'fs132', 962)" class="f">rockBottomOuterwearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs127', 963)" onmouseover="showTip(event, 'fs127', 963)" class="i">priceQuoteRequestPublisher</span> (<span onmouseout="hideTip(event, 'fs2', 964)" onmouseover="showTip(event, 'fs2', 964)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span><span class="i">RequestPriceQuote</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 965)" onmouseover="showTip(event, 'fs128', 965)" class="i">quoterId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 966)" onmouseover="showTip(event, 'fs2', 966)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span><span class="o">.</span><span class="i">Path</span><span class="o">.</span><span class="i">Name</span>
    <span onmouseout="hideTip(event, 'fs127', 967)" onmouseover="showTip(event, 'fs127', 967)" class="i">priceQuoteRequestPublisher</span> <span class="o">&lt;!</span> <span class="i">SubscribeToPriceQuoteRequests</span>(<span onmouseout="hideTip(event, 'fs128', 968)" onmouseover="showTip(event, 'fs128', 968)" class="i">quoterId</span>, <span onmouseout="hideTip(event, 'fs2', 969)" onmouseover="showTip(event, 'fs2', 969)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>)
    
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 970)" onmouseover="showTip(event, 'fs66', 970)" class="f">discountPercentage</span> <span onmouseout="hideTip(event, 'fs67', 971)" onmouseover="showTip(event, 'fs67', 971)" class="i">orderTotalRetailPrice</span> <span class="o">=</span>
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs67', 972)" onmouseover="showTip(event, 'fs67', 972)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">100.00m</span>) <span class="k">then</span> <span class="n">0.015m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 973)" onmouseover="showTip(event, 'fs67', 973)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">399.99m</span>) <span class="k">then</span> <span class="n">0.02m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 974)" onmouseover="showTip(event, 'fs67', 974)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">499.99m</span>) <span class="k">then</span> <span class="n">0.03m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 975)" onmouseover="showTip(event, 'fs67', 975)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">799.99m</span>) <span class="k">then</span> <span class="n">0.04m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 976)" onmouseover="showTip(event, 'fs67', 976)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">999.99m</span>) <span class="k">then</span> <span class="n">0.05m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 977)" onmouseover="showTip(event, 'fs67', 977)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">2999.99m</span>) <span class="k">then</span> <span class="n">0.06m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 978)" onmouseover="showTip(event, 'fs67', 978)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">4999.99m</span>) <span class="k">then</span> <span class="n">0.07m</span>
        <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs67', 979)" onmouseover="showTip(event, 'fs67', 979)" class="i">orderTotalRetailPrice</span> <span class="o">&lt;=</span> <span class="n">5999.99m</span>) <span class="k">then</span> <span class="n">0.075m</span>
        <span class="k">else</span> <span class="n">0.08m</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 980)" onmouseover="showTip(event, 'fs3', 980)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">rpq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 981)" onmouseover="showTip(event, 'fs2', 981)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">retailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>
        <span class="k">let</span> (<span class="i">Money</span> <span class="i">orderTotalRetailPrice</span>) <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">OrderTotalRetailPrice</span>
        <span class="k">if</span> <span class="i">orderTotalRetailPrice</span> <span class="o">&lt;</span> <span class="n">1000.00m</span> <span class="k">then</span>
            <span class="k">let</span> <span class="i">discount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 982)" onmouseover="showTip(event, 'fs66', 982)" class="i">discountPercentage</span> (<span class="i">orderTotalRetailPrice</span> <span class="o">*</span> <span class="i">retailPrice</span>)
            <span onmouseout="hideTip(event, 'fs2', 983)" onmouseover="showTip(event, 'fs2', 983)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RfqId</span>; <span class="i">ItemId</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">ItemId</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="i">rpq</span><span class="o">.</span><span class="i">RetailPrice</span>; <span class="i">DiscountPrice</span> <span class="o">=</span> <span class="i">Money</span> (<span class="i">retailPrice</span> <span class="o">-</span> <span class="i">discount</span>) }
        <span class="k">else</span> <span onmouseout="hideTip(event, 'fs4', 984)" onmouseover="showTip(event, 'fs4', 984)" class="i">printfn</span> <span class="s">&quot;RockBottomOuterwearPriceQuotes: ignoring: %A&quot;</span> <span class="i">rpq</span>
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 985)" onmouseover="showTip(event, 'fs3', 985)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 986)" onmouseover="showTip(event, 'fs3', 986)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs92', 987)" onmouseover="showTip(event, 'fs92', 987)" class="i">priceQuoteAggregatorRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;priceQuoteAggregator&quot;</span> <span onmouseout="hideTip(event, 'fs87', 988)" onmouseover="showTip(event, 'fs87', 988)" class="i">priceQuoteAggregator</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 989)" onmouseover="showTip(event, 'fs133', 989)" class="i">orderProcessorRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;orderProcessor&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs90', 990)" onmouseover="showTip(event, 'fs90', 990)" class="f">mountaineeringSuppliesOrderProcessor</span> <span onmouseout="hideTip(event, 'fs92', 991)" onmouseover="showTip(event, 'fs92', 991)" class="i">priceQuoteAggregatorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 992)" onmouseover="showTip(event, 'fs93', 992)" class="i">budgetHikersRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;budgetHikersPriceQuotes&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs126', 993)" onmouseover="showTip(event, 'fs126', 993)" class="f">budgetHikersPriceQuotes</span> <span onmouseout="hideTip(event, 'fs133', 994)" onmouseover="showTip(event, 'fs133', 994)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs94', 995)" onmouseover="showTip(event, 'fs94', 995)" class="i">highSierraRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;highSierra&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs129', 996)" onmouseover="showTip(event, 'fs129', 996)" class="f">highSierraPriceQuotes</span> <span onmouseout="hideTip(event, 'fs133', 997)" onmouseover="showTip(event, 'fs133', 997)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs95', 998)" onmouseover="showTip(event, 'fs95', 998)" class="i">mountainAscentRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;mountainAscent&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs130', 999)" onmouseover="showTip(event, 'fs130', 999)" class="f">mountainAscentPriceQuotes</span> <span onmouseout="hideTip(event, 'fs133', 1000)" onmouseover="showTip(event, 'fs133', 1000)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 1001)" onmouseover="showTip(event, 'fs96', 1001)" class="i">pinnacleGearRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;pinnacleGear&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs131', 1002)" onmouseover="showTip(event, 'fs131', 1002)" class="f">pinnacleGearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs133', 1003)" onmouseover="showTip(event, 'fs133', 1003)" class="i">orderProcessorRef</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs97', 1004)" onmouseover="showTip(event, 'fs97', 1004)" class="i">rockBottomOuterwearRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;rockBottomOuterwear&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs132', 1005)" onmouseover="showTip(event, 'fs132', 1005)" class="f">rockBottomOuterwearPriceQuotes</span> <span onmouseout="hideTip(event, 'fs133', 1006)" onmouseover="showTip(event, 'fs133', 1006)" class="i">orderProcessorRef</span>

<span onmouseout="hideTip(event, 'fs133', 1007)" onmouseover="showTip(event, 'fs133', 1007)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;123&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">29.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;2&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">99.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;3&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">14.95m</span> } ] }
<span onmouseout="hideTip(event, 'fs133', 1008)" onmouseover="showTip(event, 'fs133', 1008)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;125&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;4&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">39.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;5&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">199.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;6&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">149.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;7&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">724.99m</span> } ] }
<span onmouseout="hideTip(event, 'fs133', 1009)" onmouseover="showTip(event, 'fs133', 1009)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;129&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;8&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">119.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;9&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">499.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;10&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">519.00m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;11&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">209.50m</span> } ] }
<span onmouseout="hideTip(event, 'fs133', 1010)" onmouseover="showTip(event, 'fs133', 1010)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;135&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;12&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">0.97m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;13&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">9.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;14&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">1.99m</span> } ] }
<span onmouseout="hideTip(event, 'fs133', 1011)" onmouseover="showTip(event, 'fs133', 1011)" class="i">orderProcessorRef</span> <span class="o">&lt;!</span> { <span class="i">RfqId</span> <span class="o">=</span> <span class="s">&quot;140&quot;</span>; <span class="i">RetailItems</span> <span class="o">=</span> [ { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;15&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">107.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;16&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">9.50m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;17&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">599.99m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;18&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">249.95m</span> }; { <span class="i">ItemId</span> <span class="o">=</span> <span class="s">&quot;19&quot;</span>; <span class="i">RetailPrice</span> <span class="o">=</span> <span class="n">789.99m</span> } ] }
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/ScatterGather.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Routing-Slip" class="anchor" href="#Routing-Slip">Routing Slip</a></h2>

<p>This pattern allows to split one large procedure into smaller sequential steps that are handled by different actors. On each step, the specified actor can attach additional information to the message and send it to the next one.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
<span class="l">63: </span>
<span class="l">64: </span>
<span class="l">65: </span>
<span class="l">66: </span>
<span class="l">67: </span>
<span class="l">68: </span>
<span class="l">69: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs134', 1012)" onmouseover="showTip(event, 'fs134', 1012)" class="t">RegistrationProcess</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs135', 1013)" onmouseover="showTip(event, 'fs135', 1013)" class="i">ProcessId</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs37', 1014)" onmouseover="showTip(event, 'fs37', 1014)" class="t">string</span>; <span onmouseout="hideTip(event, 'fs136', 1015)" onmouseover="showTip(event, 'fs136', 1015)" class="i">ProcessSteps</span><span class="o">:</span> <span class="i">ProcessStep</span> <span onmouseout="hideTip(event, 'fs62', 1016)" onmouseover="showTip(event, 'fs62', 1016)" class="t">list</span>; <span onmouseout="hideTip(event, 'fs137', 1017)" onmouseover="showTip(event, 'fs137', 1017)" class="i">CurrentStep</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs99', 1018)" onmouseover="showTip(event, 'fs99', 1018)" class="t">int</span> } <span class="k">with</span>
    <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs138', 1019)" onmouseover="showTip(event, 'fs138', 1019)" class="f">Create</span> (<span onmouseout="hideTip(event, 'fs139', 1020)" onmouseover="showTip(event, 'fs139', 1020)" class="i">processId</span>, <span onmouseout="hideTip(event, 'fs140', 1021)" onmouseover="showTip(event, 'fs140', 1021)" class="i">processSteps</span>) <span class="o">=</span> { <span class="i">ProcessId</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs139', 1022)" onmouseover="showTip(event, 'fs139', 1022)" class="i">processId</span>; <span class="i">ProcessSteps</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs140', 1023)" onmouseover="showTip(event, 'fs140', 1023)" class="i">processSteps</span>; <span class="i">CurrentStep</span> <span class="o">=</span> <span class="n">0</span> }
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs141', 1024)" onmouseover="showTip(event, 'fs141', 1024)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs142', 1025)" onmouseover="showTip(event, 'fs142', 1025)" class="i">IsCompleted</span> <span class="k">with</span> <span class="i">get</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs141', 1026)" onmouseover="showTip(event, 'fs141', 1026)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs137', 1027)" onmouseover="showTip(event, 'fs137', 1027)" class="i">CurrentStep</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs141', 1028)" onmouseover="showTip(event, 'fs141', 1028)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 1029)" onmouseover="showTip(event, 'fs136', 1029)" class="i">ProcessSteps</span><span class="o">.</span><span class="i">Length</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs141', 1030)" onmouseover="showTip(event, 'fs141', 1030)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs143', 1031)" onmouseover="showTip(event, 'fs143', 1031)" class="f">NextStep</span> () <span class="o">=</span> 
        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs141', 1032)" onmouseover="showTip(event, 'fs141', 1032)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs144', 1033)" onmouseover="showTip(event, 'fs144', 1033)" class="i">IsCompleted</span>) <span class="k">then</span> <span onmouseout="hideTip(event, 'fs145', 1034)" onmouseover="showTip(event, 'fs145', 1034)" class="f">failwith</span> <span class="s">&quot;Process had already completed.&quot;</span>
        <span class="k">else</span> <span onmouseout="hideTip(event, 'fs141', 1035)" onmouseover="showTip(event, 'fs141', 1035)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 1036)" onmouseover="showTip(event, 'fs136', 1036)" class="i">ProcessSteps</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 1037)" onmouseover="showTip(event, 'fs59', 1037)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs146', 1038)" onmouseover="showTip(event, 'fs146', 1038)" class="f">item</span> <span onmouseout="hideTip(event, 'fs141', 1039)" onmouseover="showTip(event, 'fs141', 1039)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs137', 1040)" onmouseover="showTip(event, 'fs137', 1040)" class="i">CurrentStep</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs141', 1041)" onmouseover="showTip(event, 'fs141', 1041)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs147', 1042)" onmouseover="showTip(event, 'fs147', 1042)" class="f">StepCompleted</span> () <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs141', 1043)" onmouseover="showTip(event, 'fs141', 1043)" class="i">this</span> <span class="k">with</span> <span class="i">CurrentStep</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs141', 1044)" onmouseover="showTip(event, 'fs141', 1044)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs137', 1045)" onmouseover="showTip(event, 'fs137', 1045)" class="i">CurrentStep</span> <span class="o">+</span> <span class="n">1</span> }
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs148', 1046)" onmouseover="showTip(event, 'fs148', 1046)" class="t">RegisterCustomer</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs149', 1047)" onmouseover="showTip(event, 'fs149', 1047)" class="i">RegistrationData</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs149', 1048)" onmouseover="showTip(event, 'fs149', 1048)" class="i">RegistrationData</span>; <span onmouseout="hideTip(event, 'fs150', 1049)" onmouseover="showTip(event, 'fs150', 1049)" class="i">RegistrationProcess</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs150', 1050)" onmouseover="showTip(event, 'fs150', 1050)" class="t">RegistrationProcess</span> } <span class="k">with</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs151', 1051)" onmouseover="showTip(event, 'fs151', 1051)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 1052)" onmouseover="showTip(event, 'fs152', 1052)" class="f">Advance</span> () <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs153', 1053)" onmouseover="showTip(event, 'fs153', 1053)" class="i">advancedProcess</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs151', 1054)" onmouseover="showTip(event, 'fs151', 1054)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs154', 1055)" onmouseover="showTip(event, 'fs154', 1055)" class="i">RegistrationProcess</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs155', 1056)" onmouseover="showTip(event, 'fs155', 1056)" class="f">StepCompleted</span> ()
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs156', 1057)" onmouseover="showTip(event, 'fs156', 1057)" class="f">not</span> <span onmouseout="hideTip(event, 'fs153', 1058)" onmouseover="showTip(event, 'fs153', 1058)" class="i">advancedProcess</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs144', 1059)" onmouseover="showTip(event, 'fs144', 1059)" class="i">IsCompleted</span> <span class="k">then</span> (<span onmouseout="hideTip(event, 'fs153', 1060)" onmouseover="showTip(event, 'fs153', 1060)" class="i">advancedProcess</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs157', 1061)" onmouseover="showTip(event, 'fs157', 1061)" class="f">NextStep</span> ())<span class="o">.</span><span class="i">Processor</span> <span class="o">&lt;!</span> { <span onmouseout="hideTip(event, 'fs151', 1062)" onmouseover="showTip(event, 'fs151', 1062)" class="i">this</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs134', 1063)" onmouseover="showTip(event, 'fs134', 1063)" class="i">RegistrationProcess</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs153', 1064)" onmouseover="showTip(event, 'fs153', 1064)" class="i">advancedProcess</span> }
        <span class="k">else</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs158', 1065)" onmouseover="showTip(event, 'fs158', 1065)" class="f">creditChecker</span> (<span onmouseout="hideTip(event, 'fs2', 1066)" onmouseover="showTip(event, 'fs2', 1066)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 1067)" onmouseover="showTip(event, 'fs3', 1067)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">registerCustomer</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1068)" onmouseover="showTip(event, 'fs2', 1068)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> <span class="i">federalTaxId</span> <span class="o">=</span> <span class="i">registerCustomer</span><span class="o">.</span><span class="i">RegistrationData</span><span class="o">.</span><span class="i">CustomerInformation</span><span class="o">.</span><span class="i">FederalTaxId</span>
        <span onmouseout="hideTip(event, 'fs4', 1069)" onmouseover="showTip(event, 'fs4', 1069)" class="i">printfn</span> <span class="s">&quot;CreditChecker: handling register customer to perform credit check: %s&quot;</span> <span class="i">federalTaxId</span>
        <span class="i">registerCustomer</span><span class="o">.</span><span class="i">Advance</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 1070)" onmouseover="showTip(event, 'fs3', 1070)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs159', 1071)" onmouseover="showTip(event, 'fs159', 1071)" class="f">contactKeeper</span> (<span onmouseout="hideTip(event, 'fs2', 1072)" onmouseover="showTip(event, 'fs2', 1072)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 1073)" onmouseover="showTip(event, 'fs3', 1073)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">registerCustomer</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1074)" onmouseover="showTip(event, 'fs2', 1074)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> <span class="i">contactInfo</span> <span class="o">=</span> <span class="i">registerCustomer</span><span class="o">.</span><span class="i">RegistrationData</span><span class="o">.</span><span class="i">ContactInformation</span>
        <span onmouseout="hideTip(event, 'fs4', 1075)" onmouseover="showTip(event, 'fs4', 1075)" class="i">printfn</span> <span class="s">&quot;ContactKeeper: handling register customer to keep contact information: %A&quot;</span> <span class="i">contactInfo</span>
        <span class="i">registerCustomer</span><span class="o">.</span><span class="i">Advance</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 1076)" onmouseover="showTip(event, 'fs3', 1076)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs160', 1077)" onmouseover="showTip(event, 'fs160', 1077)" class="f">customerVault</span> (<span onmouseout="hideTip(event, 'fs2', 1078)" onmouseover="showTip(event, 'fs2', 1078)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 1079)" onmouseover="showTip(event, 'fs3', 1079)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">registerCustomer</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1080)" onmouseover="showTip(event, 'fs2', 1080)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> <span class="i">customerInformation</span> <span class="o">=</span> <span class="i">registerCustomer</span><span class="o">.</span><span class="i">RegistrationData</span><span class="o">.</span><span class="i">CustomerInformation</span>
        <span onmouseout="hideTip(event, 'fs4', 1081)" onmouseover="showTip(event, 'fs4', 1081)" class="i">printfn</span> <span class="s">&quot;CustomerVault: handling register customer to create a new custoner: %A&quot;</span> <span class="i">customerInformation</span>
        <span class="i">registerCustomer</span><span class="o">.</span><span class="i">Advance</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 1082)" onmouseover="showTip(event, 'fs3', 1082)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs161', 1083)" onmouseover="showTip(event, 'fs161', 1083)" class="f">servicePlanner</span> (<span onmouseout="hideTip(event, 'fs2', 1084)" onmouseover="showTip(event, 'fs2', 1084)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 1085)" onmouseover="showTip(event, 'fs3', 1085)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">registerCustomer</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1086)" onmouseover="showTip(event, 'fs2', 1086)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> <span class="i">serviceOption</span> <span class="o">=</span> <span class="i">registerCustomer</span><span class="o">.</span><span class="i">RegistrationData</span><span class="o">.</span><span class="i">ServiceOption</span>
        <span onmouseout="hideTip(event, 'fs4', 1087)" onmouseover="showTip(event, 'fs4', 1087)" class="i">printfn</span> <span class="s">&quot;ServicePlanner: handling register customer to plan a new customer service: %A&quot;</span> <span class="i">serviceOption</span>
        <span class="i">registerCustomer</span><span class="o">.</span><span class="i">Advance</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 1088)" onmouseover="showTip(event, 'fs3', 1088)" class="f">loop</span> ()

<span class="k">module</span> <span class="t">ServiceRegistry</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs162', 1089)" onmouseover="showTip(event, 'fs162', 1089)" class="f">contactKeeper</span> (<span onmouseout="hideTip(event, 'fs163', 1090)" onmouseover="showTip(event, 'fs163', 1090)" class="i">system</span><span class="o">:</span> <span class="i">ActorSystem</span>) (<span onmouseout="hideTip(event, 'fs164', 1091)" onmouseover="showTip(event, 'fs164', 1091)" class="i">id</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs37', 1092)" onmouseover="showTip(event, 'fs37', 1092)" class="t">string</span>) <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs163', 1093)" onmouseover="showTip(event, 'fs163', 1093)" class="i">system</span> (<span onmouseout="hideTip(event, 'fs165', 1094)" onmouseover="showTip(event, 'fs165', 1094)" class="i">sprintf</span> <span class="s">&quot;contactKeeper-%s&quot;</span> <span onmouseout="hideTip(event, 'fs164', 1095)" onmouseover="showTip(event, 'fs164', 1095)" class="i">id</span>) <span onmouseout="hideTip(event, 'fs159', 1096)" onmouseover="showTip(event, 'fs159', 1096)" class="i">contactKeeper</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs166', 1097)" onmouseover="showTip(event, 'fs166', 1097)" class="f">creditChecker</span> (<span onmouseout="hideTip(event, 'fs163', 1098)" onmouseover="showTip(event, 'fs163', 1098)" class="i">system</span><span class="o">:</span> <span class="i">ActorSystem</span>) (<span onmouseout="hideTip(event, 'fs164', 1099)" onmouseover="showTip(event, 'fs164', 1099)" class="i">id</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs37', 1100)" onmouseover="showTip(event, 'fs37', 1100)" class="t">string</span>) <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs163', 1101)" onmouseover="showTip(event, 'fs163', 1101)" class="i">system</span> (<span onmouseout="hideTip(event, 'fs165', 1102)" onmouseover="showTip(event, 'fs165', 1102)" class="i">sprintf</span> <span class="s">&quot;creditChecker-%s&quot;</span> <span onmouseout="hideTip(event, 'fs164', 1103)" onmouseover="showTip(event, 'fs164', 1103)" class="i">id</span>) <span onmouseout="hideTip(event, 'fs158', 1104)" onmouseover="showTip(event, 'fs158', 1104)" class="i">creditChecker</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs167', 1105)" onmouseover="showTip(event, 'fs167', 1105)" class="f">customerVault</span> (<span onmouseout="hideTip(event, 'fs163', 1106)" onmouseover="showTip(event, 'fs163', 1106)" class="i">system</span><span class="o">:</span> <span class="i">ActorSystem</span>) (<span onmouseout="hideTip(event, 'fs164', 1107)" onmouseover="showTip(event, 'fs164', 1107)" class="i">id</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs37', 1108)" onmouseover="showTip(event, 'fs37', 1108)" class="t">string</span>) <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs163', 1109)" onmouseover="showTip(event, 'fs163', 1109)" class="i">system</span> (<span onmouseout="hideTip(event, 'fs165', 1110)" onmouseover="showTip(event, 'fs165', 1110)" class="i">sprintf</span> <span class="s">&quot;customerVault-%s&quot;</span> <span onmouseout="hideTip(event, 'fs164', 1111)" onmouseover="showTip(event, 'fs164', 1111)" class="i">id</span>) <span onmouseout="hideTip(event, 'fs160', 1112)" onmouseover="showTip(event, 'fs160', 1112)" class="i">customerVault</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs168', 1113)" onmouseover="showTip(event, 'fs168', 1113)" class="f">servicePlanner</span> (<span onmouseout="hideTip(event, 'fs163', 1114)" onmouseover="showTip(event, 'fs163', 1114)" class="i">system</span><span class="o">:</span> <span class="i">ActorSystem</span>) (<span onmouseout="hideTip(event, 'fs164', 1115)" onmouseover="showTip(event, 'fs164', 1115)" class="i">id</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs37', 1116)" onmouseover="showTip(event, 'fs37', 1116)" class="t">string</span>) <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs163', 1117)" onmouseover="showTip(event, 'fs163', 1117)" class="i">system</span> (<span onmouseout="hideTip(event, 'fs165', 1118)" onmouseover="showTip(event, 'fs165', 1118)" class="i">sprintf</span> <span class="s">&quot;servicePlanner-%s&quot;</span> <span onmouseout="hideTip(event, 'fs164', 1119)" onmouseover="showTip(event, 'fs164', 1119)" class="i">id</span>) <span onmouseout="hideTip(event, 'fs161', 1120)" onmouseover="showTip(event, 'fs161', 1120)" class="i">servicePlanner</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs169', 1121)" onmouseover="showTip(event, 'fs169', 1121)" class="i">processId</span> <span class="o">=</span> (<span class="i">Guid</span><span class="o">.</span><span class="i">NewGuid</span> ())<span class="o">.</span><span class="f">ToString</span> ()
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs170', 1122)" onmouseover="showTip(event, 'fs170', 1122)" class="i">step1</span> <span class="o">=</span> { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;create_customer&quot;</span>; <span class="i">Processor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs171', 1123)" onmouseover="showTip(event, 'fs171', 1123)" class="i">ServiceRegistry</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs167', 1124)" onmouseover="showTip(event, 'fs167', 1124)" class="i">customerVault</span> <span class="i">system</span> <span onmouseout="hideTip(event, 'fs169', 1125)" onmouseover="showTip(event, 'fs169', 1125)" class="i">processId</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs172', 1126)" onmouseover="showTip(event, 'fs172', 1126)" class="i">step2</span> <span class="o">=</span> { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;set_up_contact_info&quot;</span>; <span class="i">Processor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs171', 1127)" onmouseover="showTip(event, 'fs171', 1127)" class="i">ServiceRegistry</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 1128)" onmouseover="showTip(event, 'fs162', 1128)" class="i">contactKeeper</span> <span class="i">system</span> <span onmouseout="hideTip(event, 'fs169', 1129)" onmouseover="showTip(event, 'fs169', 1129)" class="i">processId</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs173', 1130)" onmouseover="showTip(event, 'fs173', 1130)" class="i">step3</span> <span class="o">=</span> { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;select_service_plan&quot;</span>; <span class="i">Processor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs171', 1131)" onmouseover="showTip(event, 'fs171', 1131)" class="i">ServiceRegistry</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs168', 1132)" onmouseover="showTip(event, 'fs168', 1132)" class="i">servicePlanner</span> <span class="i">system</span> <span onmouseout="hideTip(event, 'fs169', 1133)" onmouseover="showTip(event, 'fs169', 1133)" class="i">processId</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs174', 1134)" onmouseover="showTip(event, 'fs174', 1134)" class="i">step4</span> <span class="o">=</span> { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;check_credit&quot;</span>; <span class="i">Processor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs171', 1135)" onmouseover="showTip(event, 'fs171', 1135)" class="i">ServiceRegistry</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs166', 1136)" onmouseover="showTip(event, 'fs166', 1136)" class="i">creditChecker</span> <span class="i">system</span> <span onmouseout="hideTip(event, 'fs169', 1137)" onmouseover="showTip(event, 'fs169', 1137)" class="i">processId</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs175', 1138)" onmouseover="showTip(event, 'fs175', 1138)" class="i">registrationProcess</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs134', 1139)" onmouseover="showTip(event, 'fs134', 1139)" class="t">RegistrationProcess</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs176', 1140)" onmouseover="showTip(event, 'fs176', 1140)" class="f">Create</span> (<span onmouseout="hideTip(event, 'fs169', 1141)" onmouseover="showTip(event, 'fs169', 1141)" class="i">processId</span>, [ <span onmouseout="hideTip(event, 'fs170', 1142)" onmouseover="showTip(event, 'fs170', 1142)" class="i">step1</span>; <span onmouseout="hideTip(event, 'fs172', 1143)" onmouseover="showTip(event, 'fs172', 1143)" class="i">step2</span>; <span onmouseout="hideTip(event, 'fs173', 1144)" onmouseover="showTip(event, 'fs173', 1144)" class="i">step3</span>; <span onmouseout="hideTip(event, 'fs174', 1145)" onmouseover="showTip(event, 'fs174', 1145)" class="i">step4</span> ])
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs177', 1146)" onmouseover="showTip(event, 'fs177', 1146)" class="i">registrationData</span> <span class="o">=</span> { 
    <span class="i">CustomerInformation</span> <span class="o">=</span> { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;ABC, Inc.&quot;</span>; <span class="i">FederalTaxId</span> <span class="o">=</span> <span class="s">&quot;123-45-6789&quot;</span> }
    <span class="i">ContactInformation</span> <span class="o">=</span> { <span class="i">PostalAddress</span> <span class="o">=</span> { <span class="i">Address1</span> <span class="o">=</span> <span class="s">&quot;123 Main Street&quot;</span>; <span class="i">Address2</span> <span class="o">=</span> <span class="s">&quot;Suite 100&quot;</span>; <span class="i">City</span> <span class="o">=</span> <span class="s">&quot;Boulder&quot;</span>; <span class="i">State</span> <span class="o">=</span> <span class="s">&quot;CO&quot;</span>; <span class="i">ZipCode</span> <span class="o">=</span> <span class="s">&quot;80301&quot;</span> }
                           <span class="i">Telephone</span> <span class="o">=</span> <span class="i">Telephone</span> <span class="s">&quot;303-555-1212&quot;</span> }
    <span class="i">ServiceOption</span> <span class="o">=</span> { <span class="i">Id</span> <span class="o">=</span> <span class="s">&quot;99-1203&quot;</span>; <span class="i">Description</span> <span class="o">=</span> <span class="s">&quot;A description of 99-1203.&quot;</span> } }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs178', 1147)" onmouseover="showTip(event, 'fs178', 1147)" class="i">registerCustomer</span> <span class="o">=</span> { <span class="i">RegistrationData</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs177', 1148)" onmouseover="showTip(event, 'fs177', 1148)" class="i">registrationData</span>; <span onmouseout="hideTip(event, 'fs134', 1149)" onmouseover="showTip(event, 'fs134', 1149)" class="i">RegistrationProcess</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs175', 1150)" onmouseover="showTip(event, 'fs175', 1150)" class="i">registrationProcess</span> }

(<span onmouseout="hideTip(event, 'fs175', 1151)" onmouseover="showTip(event, 'fs175', 1151)" class="i">registrationProcess</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs157', 1152)" onmouseover="showTip(event, 'fs157', 1152)" class="f">NextStep</span> ())<span class="o">.</span><span class="i">Processor</span> <span class="o">&lt;!</span> <span onmouseout="hideTip(event, 'fs178', 1153)" onmouseover="showTip(event, 'fs178', 1153)" class="i">registerCustomer</span>
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/RoutingSlip.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Process-Manager" class="anchor" href="#Process-Manager">Process Manager</a></h2>

<p>This pattern splits a large process into smaller steps that may not be sequential and may not be known at design time. The Process Manager maintains the state of the process and calculates each step.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">  1: </span>
<span class="l">  2: </span>
<span class="l">  3: </span>
<span class="l">  4: </span>
<span class="l">  5: </span>
<span class="l">  6: </span>
<span class="l">  7: </span>
<span class="l">  8: </span>
<span class="l">  9: </span>
<span class="l"> 10: </span>
<span class="l"> 11: </span>
<span class="l"> 12: </span>
<span class="l"> 13: </span>
<span class="l"> 14: </span>
<span class="l"> 15: </span>
<span class="l"> 16: </span>
<span class="l"> 17: </span>
<span class="l"> 18: </span>
<span class="l"> 19: </span>
<span class="l"> 20: </span>
<span class="l"> 21: </span>
<span class="l"> 22: </span>
<span class="l"> 23: </span>
<span class="l"> 24: </span>
<span class="l"> 25: </span>
<span class="l"> 26: </span>
<span class="l"> 27: </span>
<span class="l"> 28: </span>
<span class="l"> 29: </span>
<span class="l"> 30: </span>
<span class="l"> 31: </span>
<span class="l"> 32: </span>
<span class="l"> 33: </span>
<span class="l"> 34: </span>
<span class="l"> 35: </span>
<span class="l"> 36: </span>
<span class="l"> 37: </span>
<span class="l"> 38: </span>
<span class="l"> 39: </span>
<span class="l"> 40: </span>
<span class="l"> 41: </span>
<span class="l"> 42: </span>
<span class="l"> 43: </span>
<span class="l"> 44: </span>
<span class="l"> 45: </span>
<span class="l"> 46: </span>
<span class="l"> 47: </span>
<span class="l"> 48: </span>
<span class="l"> 49: </span>
<span class="l"> 50: </span>
<span class="l"> 51: </span>
<span class="l"> 52: </span>
<span class="l"> 53: </span>
<span class="l"> 54: </span>
<span class="l"> 55: </span>
<span class="l"> 56: </span>
<span class="l"> 57: </span>
<span class="l"> 58: </span>
<span class="l"> 59: </span>
<span class="l"> 60: </span>
<span class="l"> 61: </span>
<span class="l"> 62: </span>
<span class="l"> 63: </span>
<span class="l"> 64: </span>
<span class="l"> 65: </span>
<span class="l"> 66: </span>
<span class="l"> 67: </span>
<span class="l"> 68: </span>
<span class="l"> 69: </span>
<span class="l"> 70: </span>
<span class="l"> 71: </span>
<span class="l"> 72: </span>
<span class="l"> 73: </span>
<span class="l"> 74: </span>
<span class="l"> 75: </span>
<span class="l"> 76: </span>
<span class="l"> 77: </span>
<span class="l"> 78: </span>
<span class="l"> 79: </span>
<span class="l"> 80: </span>
<span class="l"> 81: </span>
<span class="l"> 82: </span>
<span class="l"> 83: </span>
<span class="l"> 84: </span>
<span class="l"> 85: </span>
<span class="l"> 86: </span>
<span class="l"> 87: </span>
<span class="l"> 88: </span>
<span class="l"> 89: </span>
<span class="l"> 90: </span>
<span class="l"> 91: </span>
<span class="l"> 92: </span>
<span class="l"> 93: </span>
<span class="l"> 94: </span>
<span class="l"> 95: </span>
<span class="l"> 96: </span>
<span class="l"> 97: </span>
<span class="l"> 98: </span>
<span class="l"> 99: </span>
<span class="l">100: </span>
<span class="l">101: </span>
<span class="l">102: </span>
<span class="l">103: </span>
<span class="l">104: </span>
<span class="l">105: </span>
<span class="l">106: </span>
<span class="l">107: </span>
<span class="l">108: </span>
<span class="l">109: </span>
<span class="l">110: </span>
<span class="l">111: </span>
<span class="l">112: </span>
<span class="l">113: </span>
<span class="l">114: </span>
<span class="l">115: </span>
<span class="l">116: </span>
<span class="l">117: </span>
<span class="l">118: </span>
<span class="l">119: </span>
<span class="l">120: </span>
<span class="l">121: </span>
<span class="l">122: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span class="t">Process</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 1154)" onmouseover="showTip(event, 'fs179', 1154)" class="f">processOf</span> <span onmouseout="hideTip(event, 'fs180', 1155)" onmouseover="showTip(event, 'fs180', 1155)" class="i">processId</span> <span onmouseout="hideTip(event, 'fs181', 1156)" onmouseover="showTip(event, 'fs181', 1156)" class="i">processes</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs181', 1157)" onmouseover="showTip(event, 'fs181', 1157)" class="i">processes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 1158)" onmouseover="showTip(event, 'fs14', 1158)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 1159)" onmouseover="showTip(event, 'fs89', 1159)" class="f">find</span> <span onmouseout="hideTip(event, 'fs180', 1160)" onmouseover="showTip(event, 'fs180', 1160)" class="i">processId</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs182', 1161)" onmouseover="showTip(event, 'fs182', 1161)" class="f">startProcess</span> <span onmouseout="hideTip(event, 'fs180', 1162)" onmouseover="showTip(event, 'fs180', 1162)" class="i">processId</span> <span class="i">``process``</span> <span onmouseout="hideTip(event, 'fs183', 1163)" onmouseover="showTip(event, 'fs183', 1163)" class="i">self</span> <span onmouseout="hideTip(event, 'fs181', 1164)" onmouseover="showTip(event, 'fs181', 1164)" class="i">processes</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs183', 1165)" onmouseover="showTip(event, 'fs183', 1165)" class="i">self</span> <span class="o">&lt;!</span> <span class="i">ProcessStarted</span>(<span onmouseout="hideTip(event, 'fs180', 1166)" onmouseover="showTip(event, 'fs180', 1166)" class="i">processId</span>, <span class="i">``process``</span>)
        <span onmouseout="hideTip(event, 'fs181', 1167)" onmouseover="showTip(event, 'fs181', 1167)" class="i">processes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 1168)" onmouseover="showTip(event, 'fs14', 1168)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs42', 1169)" onmouseover="showTip(event, 'fs42', 1169)" class="f">add</span> <span onmouseout="hideTip(event, 'fs180', 1170)" onmouseover="showTip(event, 'fs180', 1170)" class="i">processId</span> <span class="i">``process``</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs184', 1171)" onmouseover="showTip(event, 'fs184', 1171)" class="f">stopProcess</span> <span onmouseout="hideTip(event, 'fs180', 1172)" onmouseover="showTip(event, 'fs180', 1172)" class="i">processId</span> <span onmouseout="hideTip(event, 'fs183', 1173)" onmouseover="showTip(event, 'fs183', 1173)" class="i">self</span> <span onmouseout="hideTip(event, 'fs181', 1174)" onmouseover="showTip(event, 'fs181', 1174)" class="i">processes</span> <span class="o">=</span>
        <span class="k">let</span> <span class="i">``process``</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs179', 1175)" onmouseover="showTip(event, 'fs179', 1175)" class="f">processOf</span> <span onmouseout="hideTip(event, 'fs180', 1176)" onmouseover="showTip(event, 'fs180', 1176)" class="i">processId</span> <span onmouseout="hideTip(event, 'fs181', 1177)" onmouseover="showTip(event, 'fs181', 1177)" class="i">processes</span>
        <span onmouseout="hideTip(event, 'fs183', 1178)" onmouseover="showTip(event, 'fs183', 1178)" class="i">self</span> <span class="o">&lt;!</span> <span class="i">ProcessStopped</span>(<span onmouseout="hideTip(event, 'fs180', 1179)" onmouseover="showTip(event, 'fs180', 1179)" class="i">processId</span>, <span class="i">``process``</span>)
        <span onmouseout="hideTip(event, 'fs181', 1180)" onmouseover="showTip(event, 'fs181', 1180)" class="i">processes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 1181)" onmouseover="showTip(event, 'fs14', 1181)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 1182)" onmouseover="showTip(event, 'fs45', 1182)" class="f">remove</span> <span onmouseout="hideTip(event, 'fs180', 1183)" onmouseover="showTip(event, 'fs180', 1183)" class="i">processId</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs185', 1184)" onmouseover="showTip(event, 'fs185', 1184)" class="f">loanRateQuote</span> <span onmouseout="hideTip(event, 'fs186', 1185)" onmouseover="showTip(event, 'fs186', 1185)" class="i">loanRateQuoteId</span> <span onmouseout="hideTip(event, 'fs187', 1186)" onmouseover="showTip(event, 'fs187', 1186)" class="i">taxId</span> <span onmouseout="hideTip(event, 'fs188', 1187)" onmouseover="showTip(event, 'fs188', 1187)" class="i">amount</span> <span onmouseout="hideTip(event, 'fs189', 1188)" onmouseover="showTip(event, 'fs189', 1188)" class="i">termInMonths</span> <span onmouseout="hideTip(event, 'fs190', 1189)" onmouseover="showTip(event, 'fs190', 1189)" class="i">loanBroker</span> (<span onmouseout="hideTip(event, 'fs2', 1190)" onmouseover="showTip(event, 'fs2', 1190)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs191', 1191)" onmouseover="showTip(event, 'fs191', 1191)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs192', 1192)" onmouseover="showTip(event, 'fs192', 1192)" class="i">bankLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs193', 1193)" onmouseover="showTip(event, 'fs193', 1193)" class="i">expectedLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs194', 1194)" onmouseover="showTip(event, 'fs194', 1194)" class="i">creditRatingScore</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let</span> <span class="i">quotableCreditScore</span> <span class="i">score</span> <span class="o">=</span> <span class="i">score</span> <span class="o">&gt;</span> <span class="n">399</span>

        <span class="k">let</span> <span class="i">bestBankLoanRateQuote</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs192', 1195)" onmouseover="showTip(event, 'fs192', 1195)" class="i">bankLoanRateQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 1196)" onmouseover="showTip(event, 'fs59', 1196)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs195', 1197)" onmouseover="showTip(event, 'fs195', 1197)" class="i">minBy</span> (<span class="k">fun</span> <span class="i">bankLoanRateQuote</span> <span class="k">-&gt;</span> <span class="i">bankLoanRateQuote</span><span class="o">.</span><span class="i">InterestRate</span>)

        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1198)" onmouseover="showTip(event, 'fs2', 1198)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> () 
        <span class="k">match</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="i">StartLoanRateQuote</span> <span onmouseout="hideTip(event, 'fs193', 1199)" onmouseover="showTip(event, 'fs193', 1199)" class="i">expectedLoanRateQuotes</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs190', 1200)" onmouseover="showTip(event, 'fs190', 1200)" class="i">loanBroker</span> <span class="o">&lt;!</span> <span class="i">LoanRateQuoteStarted</span>(<span onmouseout="hideTip(event, 'fs186', 1201)" onmouseover="showTip(event, 'fs186', 1201)" class="i">loanRateQuoteId</span>, <span onmouseout="hideTip(event, 'fs187', 1202)" onmouseover="showTip(event, 'fs187', 1202)" class="i">taxId</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs191', 1203)" onmouseover="showTip(event, 'fs191', 1203)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs192', 1204)" onmouseover="showTip(event, 'fs192', 1204)" class="i">bankLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs193', 1205)" onmouseover="showTip(event, 'fs193', 1205)" class="i">expectedLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs194', 1206)" onmouseover="showTip(event, 'fs194', 1206)" class="i">creditRatingScore</span>
        | <span class="i">EstablishCreditScoreForLoanRateQuote</span>(<span onmouseout="hideTip(event, 'fs186', 1207)" onmouseover="showTip(event, 'fs186', 1207)" class="i">loanRateQuoteId</span>, <span onmouseout="hideTip(event, 'fs187', 1208)" onmouseover="showTip(event, 'fs187', 1208)" class="i">taxId</span>, <span onmouseout="hideTip(event, 'fs194', 1209)" onmouseover="showTip(event, 'fs194', 1209)" class="i">creditRatingScore</span>) <span class="k">-&gt;</span> 
            <span class="k">if</span> <span class="i">quotableCreditScore</span> <span onmouseout="hideTip(event, 'fs194', 1210)" onmouseover="showTip(event, 'fs194', 1210)" class="i">creditRatingScore</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs190', 1211)" onmouseover="showTip(event, 'fs190', 1211)" class="i">loanBroker</span> <span class="o">&lt;!</span> <span class="i">CreditScoreForLoanRateQuoteEstablished</span>(<span onmouseout="hideTip(event, 'fs186', 1212)" onmouseover="showTip(event, 'fs186', 1212)" class="i">loanRateQuoteId</span>, <span onmouseout="hideTip(event, 'fs187', 1213)" onmouseover="showTip(event, 'fs187', 1213)" class="i">taxId</span>, <span onmouseout="hideTip(event, 'fs194', 1214)" onmouseover="showTip(event, 'fs194', 1214)" class="i">creditRatingScore</span>, <span onmouseout="hideTip(event, 'fs188', 1215)" onmouseover="showTip(event, 'fs188', 1215)" class="i">amount</span>, <span onmouseout="hideTip(event, 'fs189', 1216)" onmouseover="showTip(event, 'fs189', 1216)" class="i">termInMonths</span>)
            <span class="k">else</span> <span onmouseout="hideTip(event, 'fs190', 1217)" onmouseover="showTip(event, 'fs190', 1217)" class="i">loanBroker</span> <span class="o">&lt;!</span> <span class="i">CreditScoreForLoanRateQuoteDenied</span>(<span onmouseout="hideTip(event, 'fs186', 1218)" onmouseover="showTip(event, 'fs186', 1218)" class="i">loanRateQuoteId</span>, <span onmouseout="hideTip(event, 'fs187', 1219)" onmouseover="showTip(event, 'fs187', 1219)" class="i">taxId</span>, <span onmouseout="hideTip(event, 'fs188', 1220)" onmouseover="showTip(event, 'fs188', 1220)" class="i">amount</span>, <span onmouseout="hideTip(event, 'fs189', 1221)" onmouseover="showTip(event, 'fs189', 1221)" class="i">termInMonths</span>, <span onmouseout="hideTip(event, 'fs194', 1222)" onmouseover="showTip(event, 'fs194', 1222)" class="i">creditRatingScore</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs191', 1223)" onmouseover="showTip(event, 'fs191', 1223)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs192', 1224)" onmouseover="showTip(event, 'fs192', 1224)" class="i">bankLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs193', 1225)" onmouseover="showTip(event, 'fs193', 1225)" class="i">expectedLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs194', 1226)" onmouseover="showTip(event, 'fs194', 1226)" class="i">creditRatingScore</span>
        | <span class="i">RecordLoanRateQuote</span>(<span class="i">bankId</span>, <span class="i">bankLoanRateQuoteId</span>, <span class="i">interestRate</span>) <span class="k">-&gt;</span> 
            <span class="k">let</span> <span class="i">bankLoanRateQuote</span> <span class="o">=</span> { <span class="i">BankId</span> <span class="o">=</span> <span class="i">bankId</span>; <span class="i">BankLoanRateQuoteId</span> <span class="o">=</span> <span class="i">bankLoanRateQuoteId</span>; <span class="i">InterestRate</span> <span class="o">=</span> <span class="i">interestRate</span> }
            <span onmouseout="hideTip(event, 'fs190', 1227)" onmouseover="showTip(event, 'fs190', 1227)" class="i">loanBroker</span> <span class="o">&lt;!</span> <span class="i">LoanRateQuoteRecorded</span>(<span onmouseout="hideTip(event, 'fs186', 1228)" onmouseover="showTip(event, 'fs186', 1228)" class="i">loanRateQuoteId</span>, <span onmouseout="hideTip(event, 'fs187', 1229)" onmouseover="showTip(event, 'fs187', 1229)" class="i">taxId</span>, <span class="i">bankLoanRateQuote</span>)
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs192', 1230)" onmouseover="showTip(event, 'fs192', 1230)" class="i">bankLoanRateQuotes</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 1231)" onmouseover="showTip(event, 'fs59', 1231)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs196', 1232)" onmouseover="showTip(event, 'fs196', 1232)" class="i">length</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs193', 1233)" onmouseover="showTip(event, 'fs193', 1233)" class="i">expectedLoanRateQuotes</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs190', 1234)" onmouseover="showTip(event, 'fs190', 1234)" class="i">loanBroker</span> <span class="o">&lt;!</span> <span class="i">LoanRateBestQuoteFilled</span>(<span onmouseout="hideTip(event, 'fs186', 1235)" onmouseover="showTip(event, 'fs186', 1235)" class="i">loanRateQuoteId</span>, <span onmouseout="hideTip(event, 'fs187', 1236)" onmouseover="showTip(event, 'fs187', 1236)" class="i">taxId</span>, <span onmouseout="hideTip(event, 'fs188', 1237)" onmouseover="showTip(event, 'fs188', 1237)" class="i">amount</span>, <span onmouseout="hideTip(event, 'fs189', 1238)" onmouseover="showTip(event, 'fs189', 1238)" class="i">termInMonths</span>, <span onmouseout="hideTip(event, 'fs194', 1239)" onmouseover="showTip(event, 'fs194', 1239)" class="i">creditRatingScore</span>, <span class="i">bestBankLoanRateQuote</span> ())
            <span class="k">else</span> ()
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs191', 1240)" onmouseover="showTip(event, 'fs191', 1240)" class="i">loop</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs192', 1241)" onmouseover="showTip(event, 'fs192', 1241)" class="i">bankLoanRateQuotes</span> <span class="o">@</span> [<span class="i">bankLoanRateQuote</span>] <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs193', 1242)" onmouseover="showTip(event, 'fs193', 1242)" class="i">expectedLoanRateQuotes</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs194', 1243)" onmouseover="showTip(event, 'fs194', 1243)" class="i">creditRatingScore</span>
        | <span class="i">TerminateLoanRateQuote</span> <span class="k">-&gt;</span> 
            <span onmouseout="hideTip(event, 'fs190', 1244)" onmouseover="showTip(event, 'fs190', 1244)" class="i">loanBroker</span> <span class="o">&lt;!</span> <span class="i">LoanRateQuoteTerminated</span>(<span onmouseout="hideTip(event, 'fs186', 1245)" onmouseover="showTip(event, 'fs186', 1245)" class="i">loanRateQuoteId</span>, <span onmouseout="hideTip(event, 'fs187', 1246)" onmouseover="showTip(event, 'fs187', 1246)" class="i">taxId</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs191', 1247)" onmouseover="showTip(event, 'fs191', 1247)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs192', 1248)" onmouseover="showTip(event, 'fs192', 1248)" class="i">bankLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs193', 1249)" onmouseover="showTip(event, 'fs193', 1249)" class="i">expectedLoanRateQuotes</span> <span onmouseout="hideTip(event, 'fs194', 1250)" onmouseover="showTip(event, 'fs194', 1250)" class="i">creditRatingScore</span>
    }
    <span onmouseout="hideTip(event, 'fs191', 1251)" onmouseover="showTip(event, 'fs191', 1251)" class="f">loop</span> [] <span class="n">0</span> <span class="n">0</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs197', 1252)" onmouseover="showTip(event, 'fs197', 1252)" class="f">loanBroker</span> <span onmouseout="hideTip(event, 'fs198', 1253)" onmouseover="showTip(event, 'fs198', 1253)" class="i">creditBureau</span> <span onmouseout="hideTip(event, 'fs199', 1254)" onmouseover="showTip(event, 'fs199', 1254)" class="i">banks</span> (<span onmouseout="hideTip(event, 'fs2', 1255)" onmouseover="showTip(event, 'fs2', 1255)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs57', 1256)" onmouseover="showTip(event, 'fs57', 1256)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs200', 1257)" onmouseover="showTip(event, 'fs200', 1257)" class="i">processes</span> <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> <span class="i">message</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1258)" onmouseover="showTip(event, 'fs2', 1258)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">match</span> <span class="i">message</span> <span class="k">with</span>
        | <span class="i">BankLoanRateQuoted</span>(<span class="i">bankId</span>, <span class="i">bankLoanRateQuoteId</span>, <span class="i">loadQuoteReferenceId</span>, <span class="i">taxId</span>, <span class="i">interestRate</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1259)" onmouseover="showTip(event, 'fs4', 1259)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span onmouseout="hideTip(event, 'fs201', 1260)" onmouseover="showTip(event, 'fs201', 1260)" class="i">Process</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 1261)" onmouseover="showTip(event, 'fs179', 1261)" class="i">processOf</span> <span class="i">loadQuoteReferenceId</span> <span onmouseout="hideTip(event, 'fs200', 1262)" onmouseover="showTip(event, 'fs200', 1262)" class="i">processes</span> <span class="o">&lt;!</span> <span class="i">RecordLoanRateQuote</span>(<span class="i">bankId</span>, <span class="i">bankLoanRateQuoteId</span>, <span class="i">interestRate</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1263)" onmouseover="showTip(event, 'fs57', 1263)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs200', 1264)" onmouseover="showTip(event, 'fs200', 1264)" class="i">processes</span>
        | <span class="i">CreditChecked</span>(<span class="i">creditProcessingReferenceId</span>, <span class="i">taxId</span>, <span class="i">score</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1265)" onmouseover="showTip(event, 'fs4', 1265)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span onmouseout="hideTip(event, 'fs201', 1266)" onmouseover="showTip(event, 'fs201', 1266)" class="i">Process</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 1267)" onmouseover="showTip(event, 'fs179', 1267)" class="i">processOf</span> <span class="i">creditProcessingReferenceId</span> <span onmouseout="hideTip(event, 'fs200', 1268)" onmouseover="showTip(event, 'fs200', 1268)" class="i">processes</span> <span class="o">&lt;!</span> <span class="i">EstablishCreditScoreForLoanRateQuote</span>(<span class="i">creditProcessingReferenceId</span>, <span class="i">taxId</span>, <span class="i">score</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1269)" onmouseover="showTip(event, 'fs57', 1269)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs200', 1270)" onmouseover="showTip(event, 'fs200', 1270)" class="i">processes</span>
        | <span class="i">CreditScoreForLoanRateQuoteDenied</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>, <span class="i">score</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1271)" onmouseover="showTip(event, 'fs4', 1271)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span onmouseout="hideTip(event, 'fs201', 1272)" onmouseover="showTip(event, 'fs201', 1272)" class="i">Process</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 1273)" onmouseover="showTip(event, 'fs179', 1273)" class="i">processOf</span> <span class="i">loanRateQuoteId</span> <span onmouseout="hideTip(event, 'fs200', 1274)" onmouseover="showTip(event, 'fs200', 1274)" class="i">processes</span> <span class="o">&lt;!</span> <span class="i">TerminateLoanRateQuote</span>
            <span class="k">let</span> <span class="i">denied</span> <span class="o">=</span> <span class="i">BestLoanRateDenied</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>, <span class="i">score</span>)
            <span onmouseout="hideTip(event, 'fs4', 1275)" onmouseover="showTip(event, 'fs4', 1275)" class="i">printfn</span> <span class="s">&quot;Would be sent to original requester: %A&quot;</span> <span class="i">denied</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1276)" onmouseover="showTip(event, 'fs57', 1276)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs200', 1277)" onmouseover="showTip(event, 'fs200', 1277)" class="i">processes</span>
        | <span class="i">CreditScoreForLoanRateQuoteEstablished</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>, <span class="i">score</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1278)" onmouseover="showTip(event, 'fs4', 1278)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span onmouseout="hideTip(event, 'fs199', 1279)" onmouseover="showTip(event, 'fs199', 1279)" class="i">banks</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 1280)" onmouseover="showTip(event, 'fs59', 1280)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 1281)" onmouseover="showTip(event, 'fs63', 1281)" class="i">iter</span> (<span class="k">fun</span> <span class="i">bank</span> <span class="k">-&gt;</span> <span class="i">bank</span> <span class="o">&lt;!</span> <span class="i">QuoteLoanRate</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>, <span class="i">score</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>))
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1282)" onmouseover="showTip(event, 'fs57', 1282)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs200', 1283)" onmouseover="showTip(event, 'fs200', 1283)" class="i">processes</span>
        | <span class="i">LoanRateBestQuoteFilled</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>, <span class="i">creditScore</span>, <span class="i">bestBankLoanRateQuote</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1284)" onmouseover="showTip(event, 'fs4', 1284)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span class="k">let</span> <span class="i">best</span> <span class="o">=</span> <span class="i">BestLoanRateQuoted</span>(<span class="i">bestBankLoanRateQuote</span><span class="o">.</span><span class="i">BankId</span>, <span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>, <span class="i">creditScore</span>, <span class="i">bestBankLoanRateQuote</span><span class="o">.</span><span class="i">InterestRate</span>)
            <span onmouseout="hideTip(event, 'fs4', 1285)" onmouseover="showTip(event, 'fs4', 1285)" class="i">printfn</span> <span class="s">&quot;Would be sent to original requester: %A&quot;</span> <span class="i">best</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1286)" onmouseover="showTip(event, 'fs57', 1286)" class="i">loop</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs201', 1287)" onmouseover="showTip(event, 'fs201', 1287)" class="i">Process</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs184', 1288)" onmouseover="showTip(event, 'fs184', 1288)" class="i">stopProcess</span> <span class="i">loanRateQuoteId</span> <span onmouseout="hideTip(event, 'fs2', 1289)" onmouseover="showTip(event, 'fs2', 1289)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span> <span onmouseout="hideTip(event, 'fs200', 1290)" onmouseover="showTip(event, 'fs200', 1290)" class="i">processes</span> 
        | <span class="i">LoanRateQuoteRecorded</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>, <span class="i">bankLoanRateQuote</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1291)" onmouseover="showTip(event, 'fs4', 1291)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1292)" onmouseover="showTip(event, 'fs57', 1292)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs200', 1293)" onmouseover="showTip(event, 'fs200', 1293)" class="i">processes</span>
        | <span class="i">LoanRateQuoteStarted</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1294)" onmouseover="showTip(event, 'fs4', 1294)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span onmouseout="hideTip(event, 'fs198', 1295)" onmouseover="showTip(event, 'fs198', 1295)" class="i">creditBureau</span> <span class="o">&lt;!</span> <span class="i">CheckCredit</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1296)" onmouseover="showTip(event, 'fs57', 1296)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs200', 1297)" onmouseover="showTip(event, 'fs200', 1297)" class="i">processes</span>
        | <span class="i">LoanRateQuoteTerminated</span>(<span class="i">loanRateQuoteId</span>, <span class="i">taxId</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1298)" onmouseover="showTip(event, 'fs4', 1298)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1299)" onmouseover="showTip(event, 'fs57', 1299)" class="i">loop</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs201', 1300)" onmouseover="showTip(event, 'fs201', 1300)" class="i">Process</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs184', 1301)" onmouseover="showTip(event, 'fs184', 1301)" class="i">stopProcess</span> <span class="i">loanRateQuoteId</span> <span onmouseout="hideTip(event, 'fs2', 1302)" onmouseover="showTip(event, 'fs2', 1302)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span> <span onmouseout="hideTip(event, 'fs200', 1303)" onmouseover="showTip(event, 'fs200', 1303)" class="i">processes</span> 
        | <span class="i">ProcessStarted</span>(<span onmouseout="hideTip(event, 'fs169', 1304)" onmouseover="showTip(event, 'fs169', 1304)" class="i">processId</span>, <span class="i">``process``</span>) <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs4', 1305)" onmouseover="showTip(event, 'fs4', 1305)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
            <span class="i">``process``</span> <span class="o">&lt;!</span> <span class="i">StartLoanRateQuote</span>(<span onmouseout="hideTip(event, 'fs199', 1306)" onmouseover="showTip(event, 'fs199', 1306)" class="i">banks</span><span class="o">.</span><span class="i">Length</span>)
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1307)" onmouseover="showTip(event, 'fs57', 1307)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs200', 1308)" onmouseover="showTip(event, 'fs200', 1308)" class="i">processes</span>
        | <span class="i">ProcessStopped</span> (_,_) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 1309)" onmouseover="showTip(event, 'fs4', 1309)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span class="i">message</span>
        | <span class="i">QuoteBestLoanRate</span>(<span class="i">taxId</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>) <span class="k">-&gt;</span> 
            <span class="k">let</span> <span class="i">loanRateQuoteId</span> <span class="o">=</span> (<span class="i">Guid</span><span class="o">.</span><span class="i">NewGuid</span> ())<span class="o">.</span><span class="i">ToString</span> () <span class="c">// LoanRateQuote.id</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs185', 1310)" onmouseover="showTip(event, 'fs185', 1310)" class="i">loanRateQuote</span> <span class="o">=</span> <span class="i">spawn</span> <span onmouseout="hideTip(event, 'fs2', 1311)" onmouseover="showTip(event, 'fs2', 1311)" class="i">mailbox</span><span class="o">.</span><span class="i">Context</span> <span class="s">&quot;loanRateQuote&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs185', 1312)" onmouseover="showTip(event, 'fs185', 1312)" class="i">loanRateQuote</span> <span class="i">loanRateQuoteId</span> <span class="i">taxId</span> <span class="i">amount</span> <span class="i">termInMonths</span> <span onmouseout="hideTip(event, 'fs2', 1313)" onmouseover="showTip(event, 'fs2', 1313)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span>
            <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs57', 1314)" onmouseover="showTip(event, 'fs57', 1314)" class="i">loop</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs201', 1315)" onmouseover="showTip(event, 'fs201', 1315)" class="i">Process</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs182', 1316)" onmouseover="showTip(event, 'fs182', 1316)" class="i">startProcess</span> <span class="i">loanRateQuoteId</span> <span onmouseout="hideTip(event, 'fs185', 1317)" onmouseover="showTip(event, 'fs185', 1317)" class="i">loanRateQuote</span> <span onmouseout="hideTip(event, 'fs2', 1318)" onmouseover="showTip(event, 'fs2', 1318)" class="i">mailbox</span><span class="o">.</span><span class="i">Self</span> <span onmouseout="hideTip(event, 'fs200', 1319)" onmouseover="showTip(event, 'fs200', 1319)" class="i">processes</span>
    }
    <span onmouseout="hideTip(event, 'fs57', 1320)" onmouseover="showTip(event, 'fs57', 1320)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs14', 1321)" onmouseover="showTip(event, 'fs14', 1321)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 1322)" onmouseover="showTip(event, 'fs49', 1322)" class="i">empty</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs202', 1323)" onmouseover="showTip(event, 'fs202', 1323)" class="f">creditBureau</span> (<span onmouseout="hideTip(event, 'fs2', 1324)" onmouseover="showTip(event, 'fs2', 1324)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs203', 1325)" onmouseover="showTip(event, 'fs203', 1325)" class="i">creditRanges</span> <span class="o">=</span> [<span class="n">300</span>; <span class="n">400</span>; <span class="n">500</span>; <span class="n">600</span>; <span class="n">700</span>]
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs204', 1326)" onmouseover="showTip(event, 'fs204', 1326)" class="i">randomCreditRangeGenerator</span> <span class="o">=</span> <span class="i">Random</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs205', 1327)" onmouseover="showTip(event, 'fs205', 1327)" class="i">randomCreditScoreGenerator</span> <span class="o">=</span> <span class="i">Random</span>()
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 1328)" onmouseover="showTip(event, 'fs3', 1328)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> (<span class="i">CheckCredit</span>(<span class="i">creditProcessingReferenceId</span>, <span class="i">taxId</span>)) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1329)" onmouseover="showTip(event, 'fs2', 1329)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> <span class="i">range</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs203', 1330)" onmouseover="showTip(event, 'fs203', 1330)" class="i">creditRanges</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs59', 1331)" onmouseover="showTip(event, 'fs59', 1331)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs146', 1332)" onmouseover="showTip(event, 'fs146', 1332)" class="i">item</span> (<span onmouseout="hideTip(event, 'fs204', 1333)" onmouseover="showTip(event, 'fs204', 1333)" class="i">randomCreditRangeGenerator</span><span class="o">.</span><span class="i">Next</span> <span class="n">5</span>)
        <span class="k">let</span> <span class="i">score</span> <span class="o">=</span> <span class="i">range</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs205', 1334)" onmouseover="showTip(event, 'fs205', 1334)" class="i">randomCreditScoreGenerator</span><span class="o">.</span><span class="i">Next</span> <span class="n">20</span>
        <span onmouseout="hideTip(event, 'fs2', 1335)" onmouseover="showTip(event, 'fs2', 1335)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> <span class="i">CreditChecked</span>(<span class="i">creditProcessingReferenceId</span>, <span class="i">taxId</span>, <span class="i">score</span>)        
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 1336)" onmouseover="showTip(event, 'fs3', 1336)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 1337)" onmouseover="showTip(event, 'fs3', 1337)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs206', 1338)" onmouseover="showTip(event, 'fs206', 1338)" class="f">bank</span> <span onmouseout="hideTip(event, 'fs207', 1339)" onmouseover="showTip(event, 'fs207', 1339)" class="i">bankId</span> <span onmouseout="hideTip(event, 'fs208', 1340)" onmouseover="showTip(event, 'fs208', 1340)" class="i">primeRate</span> <span onmouseout="hideTip(event, 'fs209', 1341)" onmouseover="showTip(event, 'fs209', 1341)" class="i">ratePremium</span> (<span onmouseout="hideTip(event, 'fs2', 1342)" onmouseover="showTip(event, 'fs2', 1342)" class="i">mailbox</span><span class="o">:</span> <span class="i">Actor</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs210', 1343)" onmouseover="showTip(event, 'fs210', 1343)" class="i">randomDiscount</span> <span class="o">=</span> <span class="i">Random</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs211', 1344)" onmouseover="showTip(event, 'fs211', 1344)" class="i">randomQuoteId</span> <span class="o">=</span> <span class="i">Random</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs212', 1345)" onmouseover="showTip(event, 'fs212', 1345)" class="f">calculateInterestRate</span> <span onmouseout="hideTip(event, 'fs188', 1346)" onmouseover="showTip(event, 'fs188', 1346)" class="i">amount</span> <span onmouseout="hideTip(event, 'fs213', 1347)" onmouseover="showTip(event, 'fs213', 1347)" class="i">months</span> <span onmouseout="hideTip(event, 'fs214', 1348)" onmouseover="showTip(event, 'fs214', 1348)" class="i">creditScore</span> <span class="o">=</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs215', 1349)" onmouseover="showTip(event, 'fs215', 1349)" class="i">creditScoreDiscount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs214', 1350)" onmouseover="showTip(event, 'fs214', 1350)" class="i">creditScore</span> <span class="o">/</span> <span class="n">100.0m</span> <span class="o">/</span> <span class="n">10.0m</span> <span class="o">-</span> ((<span onmouseout="hideTip(event, 'fs210', 1351)" onmouseover="showTip(event, 'fs210', 1351)" class="i">randomDiscount</span><span class="o">.</span><span class="i">Next</span> <span class="n">5</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs216', 1352)" onmouseover="showTip(event, 'fs216', 1352)" class="f">decimal</span>) <span class="o">*</span> <span class="n">0.05m</span>)
        <span onmouseout="hideTip(event, 'fs208', 1353)" onmouseover="showTip(event, 'fs208', 1353)" class="i">primeRate</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs209', 1354)" onmouseover="showTip(event, 'fs209', 1354)" class="i">ratePremium</span> <span class="o">+</span> ((<span onmouseout="hideTip(event, 'fs213', 1355)" onmouseover="showTip(event, 'fs213', 1355)" class="i">months</span> <span class="o">/</span> <span class="n">12.0m</span>) <span class="o">/</span> <span class="n">10.0m</span>) <span class="o">-</span> <span onmouseout="hideTip(event, 'fs215', 1356)" onmouseover="showTip(event, 'fs215', 1356)" class="i">creditScoreDiscount</span>
    
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs3', 1357)" onmouseover="showTip(event, 'fs3', 1357)" class="f">loop</span> () <span class="o">=</span> <span class="i">actor</span> {
        <span class="k">let!</span> (<span class="i">QuoteLoanRate</span>(<span class="i">loadQuoteReferenceId</span>, <span class="i">taxId</span>, <span class="i">creditScore</span>, <span class="i">amount</span>, <span class="i">termInMonths</span>)) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 1358)" onmouseover="showTip(event, 'fs2', 1358)" class="i">mailbox</span><span class="o">.</span><span class="i">Receive</span> ()
        <span class="k">let</span> <span class="i">interestRate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs212', 1359)" onmouseover="showTip(event, 'fs212', 1359)" class="i">calculateInterestRate</span> <span class="i">amount</span> (<span onmouseout="hideTip(event, 'fs216', 1360)" onmouseover="showTip(event, 'fs216', 1360)" class="i">decimal</span> <span class="i">termInMonths</span>) (<span onmouseout="hideTip(event, 'fs216', 1361)" onmouseover="showTip(event, 'fs216', 1361)" class="i">decimal</span> <span class="i">creditScore</span>)
        <span onmouseout="hideTip(event, 'fs2', 1362)" onmouseover="showTip(event, 'fs2', 1362)" class="i">mailbox</span><span class="o">.</span><span class="i">Sender</span> () <span class="o">&lt;!</span> <span class="i">BankLoanRateQuoted</span>(<span onmouseout="hideTip(event, 'fs207', 1363)" onmouseover="showTip(event, 'fs207', 1363)" class="i">bankId</span>, (<span onmouseout="hideTip(event, 'fs211', 1364)" onmouseover="showTip(event, 'fs211', 1364)" class="i">randomQuoteId</span><span class="o">.</span><span class="i">Next</span> <span class="n">1000</span>)<span class="o">.</span><span class="i">ToString</span> (), <span class="i">loadQuoteReferenceId</span>, <span class="i">taxId</span>, <span class="i">interestRate</span>)
        <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs3', 1365)" onmouseover="showTip(event, 'fs3', 1365)" class="i">loop</span> ()
    }
    <span onmouseout="hideTip(event, 'fs3', 1366)" onmouseover="showTip(event, 'fs3', 1366)" class="f">loop</span> ()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs217', 1367)" onmouseover="showTip(event, 'fs217', 1367)" class="i">creditBureauRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;creditBureau&quot;</span> <span onmouseout="hideTip(event, 'fs202', 1368)" onmouseover="showTip(event, 'fs202', 1368)" class="i">creditBureau</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs218', 1369)" onmouseover="showTip(event, 'fs218', 1369)" class="i">bank1Ref</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;bank1&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs206', 1370)" onmouseover="showTip(event, 'fs206', 1370)" class="f">bank</span> <span class="s">&quot;bank1&quot;</span> <span class="n">2.75m</span> <span class="n">0.30m</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs219', 1371)" onmouseover="showTip(event, 'fs219', 1371)" class="i">bank2Ref</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;bank2&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs206', 1372)" onmouseover="showTip(event, 'fs206', 1372)" class="f">bank</span> <span class="s">&quot;bank2&quot;</span> <span class="n">2.73m</span> <span class="n">0.31m</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs220', 1373)" onmouseover="showTip(event, 'fs220', 1373)" class="i">bank3Ref</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;bank3&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs206', 1374)" onmouseover="showTip(event, 'fs206', 1374)" class="f">bank</span> <span class="s">&quot;bank3&quot;</span> <span class="n">2.80m</span> <span class="n">0.29m</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs221', 1375)" onmouseover="showTip(event, 'fs221', 1375)" class="i">loanBrokerRef</span> <span class="o">=</span> <span class="i">spawn</span> <span class="i">system</span> <span class="s">&quot;loanBroker&quot;</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs197', 1376)" onmouseover="showTip(event, 'fs197', 1376)" class="f">loanBroker</span> <span onmouseout="hideTip(event, 'fs217', 1377)" onmouseover="showTip(event, 'fs217', 1377)" class="i">creditBureauRef</span> [<span onmouseout="hideTip(event, 'fs218', 1378)" onmouseover="showTip(event, 'fs218', 1378)" class="i">bank1Ref</span>; <span onmouseout="hideTip(event, 'fs219', 1379)" onmouseover="showTip(event, 'fs219', 1379)" class="i">bank2Ref</span>; <span onmouseout="hideTip(event, 'fs220', 1380)" onmouseover="showTip(event, 'fs220', 1380)" class="i">bank3Ref</span>]

<span onmouseout="hideTip(event, 'fs221', 1381)" onmouseover="showTip(event, 'fs221', 1381)" class="i">loanBrokerRef</span> <span class="o">&lt;!</span> <span class="i">QuoteBestLoanRate</span>(<span class="s">&quot;111-11-1111&quot;</span>, <span class="n">100000</span>, <span class="n">84</span>)
</code></pre></td>
</tr>
</table>

<a href="https://github.com/jorgef/fsharpreactivepatterns/blob/master/MessageRouting/ProcessManager.fsx" target="_blank">Complete Code</a>

<p><a href="#Sections">Sections</a></p>

<h2><a name="Message-Broker" class="anchor" href="#Message-Broker">Message Broker</a></h2>

<p>This pattern decouples receivers from senders and controls the flow of messages.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// No code example</span>
</code></pre></td>
</tr>
</table>

<p><a href="#Sections">Sections</a></p>

<div class="tip" id="fs1">val inventorySystemA : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.inventorySystemA</div>
<div class="tip" id="fs2">val mailbox : &#39;a</div>
<div class="tip" id="fs3">val loop : (unit -&gt; &#39;a)</div>
<div class="tip" id="fs4">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs5">val inventorySystemX : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.inventorySystemX</div>
<div class="tip" id="fs6">val orderRouter : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.orderRouter</div>
<div class="tip" id="fs7">val inventorySystemA : obj</div>
<div class="tip" id="fs8">val inventorySystemX : obj</div>
<div class="tip" id="fs9">val orderRouterRef : obj<br /><br />Full name: messagerouting.orderRouterRef</div>
<div class="tip" id="fs10">val orderItem1 : obj<br /><br />Full name: messagerouting.orderItem1</div>
<div class="tip" id="fs11">val orderItem2 : obj<br /><br />Full name: messagerouting.orderItem2</div>
<div class="tip" id="fs12">val orderItem3 : obj<br /><br />Full name: messagerouting.orderItem3</div>
<div class="tip" id="fs13">val orderItemsOfTypeA : Map&lt;obj,obj&gt;<br /><br />Full name: messagerouting.orderItemsOfTypeA</div>
<div class="tip" id="fs14">Multiple items<br />module Map<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Map&lt;&#39;Key,&#39;Value (requires comparison)&gt; =<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface ICollection&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface IDictionary&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member Add : key:&#39;Key * value:&#39;Value -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member ContainsKey : key:&#39;Key -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member Remove : key:&#39;Key -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Map&lt;_,_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;</div>
<div class="tip" id="fs15">val ofList : elements:(&#39;Key * &#39;T) list -&gt; Map&lt;&#39;Key,&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.ofList</div>
<div class="tip" id="fs16">val orderItem4 : obj<br /><br />Full name: messagerouting.orderItem4</div>
<div class="tip" id="fs17">val orderItem5 : obj<br /><br />Full name: messagerouting.orderItem5</div>
<div class="tip" id="fs18">val orderItem6 : obj<br /><br />Full name: messagerouting.orderItem6</div>
<div class="tip" id="fs19">val orderItem7 : obj<br /><br />Full name: messagerouting.orderItem7</div>
<div class="tip" id="fs20">val orderItemsOfTypeX : Map&lt;obj,obj&gt;<br /><br />Full name: messagerouting.orderItemsOfTypeX</div>
<div class="tip" id="fs21">val inventorySystemXMessageFilter : actualInventorySystemX:&#39;a -&gt; mailbox:&#39;b -&gt; &#39;c<br /><br />Full name: messagerouting.inventorySystemXMessageFilter</div>
<div class="tip" id="fs22">val actualInventorySystemX : &#39;a</div>
<div class="tip" id="fs23">val inventorySystemARef : obj<br /><br />Full name: messagerouting.inventorySystemARef</div>
<div class="tip" id="fs24">val actualInventorySystemXRef : obj<br /><br />Full name: messagerouting.actualInventorySystemXRef</div>
<div class="tip" id="fs25">val inventorySystemXRef : obj<br /><br />Full name: messagerouting.inventorySystemXRef</div>
<div class="tip" id="fs26">val typeAInterested : interestRouter:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.typeAInterested</div>
<div class="tip" id="fs27">val interestRouter : obj</div>
<div class="tip" id="fs28">val typeof&lt;&#39;T&gt; : System.Type<br /><br />Full name: Microsoft.FSharp.Core.Operators.typeof</div>
<div class="tip" id="fs29">val typeBInterested : interestRouter:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.typeBInterested</div>
<div class="tip" id="fs30">val typeCInterested : interestRouter:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.typeCInterested</div>
<div class="tip" id="fs31">val typeCAlsoInterested : interestRouter:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.typeCAlsoInterested</div>
<div class="tip" id="fs32">val dunnoInterested : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.dunnoInterested</div>
<div class="tip" id="fs33">val typedMessageInterestRouter : dunnoInterested:&#39;a -&gt; mailbox:&#39;b -&gt; &#39;c<br /><br />Full name: messagerouting.typedMessageInterestRouter</div>
<div class="tip" id="fs34">val dunnoInterested : &#39;a</div>
<div class="tip" id="fs35">val loop : (&#39;a -&gt; &#39;b -&gt; &#39;c)</div>
<div class="tip" id="fs36">val interestRegistry : &#39;a</div>
<div class="tip" id="fs37">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs38">val secondaryInterestRegistry : &#39;a</div>
<div class="tip" id="fs39">val tryFind : key:&#39;Key -&gt; table:Map&lt;&#39;Key,&#39;T&gt; -&gt; &#39;T option (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.tryFind</div>
<div class="tip" id="fs40">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs41">val fold : folder:(&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state:&#39;State -&gt; option:&#39;T option -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Core.Option.fold</div>
<div class="tip" id="fs42">val add : key:&#39;Key -&gt; value:&#39;T -&gt; table:Map&lt;&#39;Key,&#39;T&gt; -&gt; Map&lt;&#39;Key,&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.add</div>
<div class="tip" id="fs43">val bind : binder:(&#39;T -&gt; &#39;U option) -&gt; option:&#39;T option -&gt; &#39;U option<br /><br />Full name: Microsoft.FSharp.Core.Option.bind</div>
<div class="tip" id="fs44">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs45">val remove : key:&#39;Key -&gt; table:Map&lt;&#39;Key,&#39;T&gt; -&gt; Map&lt;&#39;Key,&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.remove</div>
<div class="tip" id="fs46">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs47">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; option:&#39;T option -&gt; &#39;U option<br /><br />Full name: Microsoft.FSharp.Core.Option.map</div>
<div class="tip" id="fs48">val box : value:&#39;T -&gt; obj<br /><br />Full name: Microsoft.FSharp.Core.Operators.box</div>
<div class="tip" id="fs49">val empty&lt;&#39;Key,&#39;T (requires comparison)&gt; : Map&lt;&#39;Key,&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.empty</div>
<div class="tip" id="fs50">val dunnoInterestedRef : obj<br /><br />Full name: messagerouting.dunnoInterestedRef</div>
<div class="tip" id="fs51">val typedMessageInterestRouterRef : obj<br /><br />Full name: messagerouting.typedMessageInterestRouterRef</div>
<div class="tip" id="fs52">val typeAInterestedRef : obj<br /><br />Full name: messagerouting.typeAInterestedRef</div>
<div class="tip" id="fs53">val typeBInterestedRef : obj<br /><br />Full name: messagerouting.typeBInterestedRef</div>
<div class="tip" id="fs54">val typeCInterestedRef : obj<br /><br />Full name: messagerouting.typeCInterestedRef</div>
<div class="tip" id="fs55">val typeCAlsoInterestedRef : obj<br /><br />Full name: messagerouting.typeCAlsoInterestedRef</div>
<div class="tip" id="fs56">val mountaineeringSuppliesOrderProcessor : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.mountaineeringSuppliesOrderProcessor</div>
<div class="tip" id="fs57">val loop : (&#39;a -&gt; &#39;b)</div>
<div class="tip" id="fs58">val toList : table:Map&lt;&#39;Key,&#39;T&gt; -&gt; (&#39;Key * &#39;T) list (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.toList</div>
<div class="tip" id="fs59">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs60">val filter : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.filter</div>
<div class="tip" id="fs61">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs62">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs63">val iter : action:(&#39;T -&gt; unit) -&gt; list:&#39;T list -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.List.iter</div>
<div class="tip" id="fs64">val budgetHikersPriceQuotes : interestRegistrar:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.budgetHikersPriceQuotes</div>
<div class="tip" id="fs65">val interestRegistrar : obj</div>
<div class="tip" id="fs66">val discountPercentage : (decimal -&gt; decimal)</div>
<div class="tip" id="fs67">val orderTotalRetailPrice : decimal</div>
<div class="tip" id="fs68">val highSierraPriceQuotes : interestRegistrar:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.highSierraPriceQuotes</div>
<div class="tip" id="fs69">val mountainAscentPriceQuotes : interestRegistrar:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.mountainAscentPriceQuotes</div>
<div class="tip" id="fs70">val pinnacleGearPriceQuotes : interestRegistrar:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.pinnacleGearPriceQuotes</div>
<div class="tip" id="fs71">val rockBottomOuterwearPriceQuotes : interestRegistrar:obj -&gt; mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.rockBottomOuterwearPriceQuotes</div>
<div class="tip" id="fs72">val orderProcessorRef : obj<br /><br />Full name: messagerouting.orderProcessorRef</div>
<div class="tip" id="fs73">val budgetHikersRef : obj<br /><br />Full name: messagerouting.budgetHikersRef</div>
<div class="tip" id="fs74">val highSierraRef : obj<br /><br />Full name: messagerouting.highSierraRef</div>
<div class="tip" id="fs75">val mountainAscentRef : obj<br /><br />Full name: messagerouting.mountainAscentRef</div>
<div class="tip" id="fs76">val pinnacleGearRef : obj<br /><br />Full name: messagerouting.pinnacleGearRef</div>
<div class="tip" id="fs77">val rockBottomOuterwearRef : obj<br /><br />Full name: messagerouting.rockBottomOuterwearRef</div>
<div class="tip" id="fs78">val orderItemTypeAProcessor : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.orderItemTypeAProcessor</div>
<div class="tip" id="fs79">val orderItemTypeBProcessor : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.orderItemTypeBProcessor</div>
<div class="tip" id="fs80">val orderItemTypeCProcessor : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.orderItemTypeCProcessor</div>
<div class="tip" id="fs81">val orderItemTypeAProcessor : obj</div>
<div class="tip" id="fs82">val orderItemTypeBProcessor : obj</div>
<div class="tip" id="fs83">val orderItemTypeCProcessor : obj</div>
<div class="tip" id="fs84">val iter : action:(&#39;Key -&gt; &#39;T -&gt; unit) -&gt; table:Map&lt;&#39;Key,&#39;T&gt; -&gt; unit (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.iter</div>
<div class="tip" id="fs85">val splitter : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.splitter</div>
<div class="tip" id="fs86">val orderItems : Map&lt;obj,obj&gt;<br /><br />Full name: messagerouting.orderItems</div>
<div class="tip" id="fs87">val priceQuoteAggregator : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.priceQuoteAggregator</div>
<div class="tip" id="fs88">val fulfilledPriceQuotes : &#39;a</div>
<div class="tip" id="fs89">val find : key:&#39;Key -&gt; table:Map&lt;&#39;Key,&#39;T&gt; -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.find</div>
<div class="tip" id="fs90">val mountaineeringSuppliesOrderProcessor : priceQuoteAggregator:&#39;a -&gt; mailbox:&#39;b -&gt; &#39;c<br /><br />Full name: messagerouting.mountaineeringSuppliesOrderProcessor</div>
<div class="tip" id="fs91">val priceQuoteAggregator : &#39;a</div>
<div class="tip" id="fs92">val priceQuoteAggregatorRef : &#39;a<br /><br />Full name: messagerouting.priceQuoteAggregatorRef</div>
<div class="tip" id="fs93">val budgetHikersRef : &#39;a<br /><br />Full name: messagerouting.budgetHikersRef</div>
<div class="tip" id="fs94">val highSierraRef : &#39;a<br /><br />Full name: messagerouting.highSierraRef</div>
<div class="tip" id="fs95">val mountainAscentRef : &#39;a<br /><br />Full name: messagerouting.mountainAscentRef</div>
<div class="tip" id="fs96">val pinnacleGearRef : &#39;a<br /><br />Full name: messagerouting.pinnacleGearRef</div>
<div class="tip" id="fs97">val rockBottomOuterwearRef : &#39;a<br /><br />Full name: messagerouting.rockBottomOuterwearRef</div>
<div class="tip" id="fs98">Multiple items<br />union case SequencedMessage.SequencedMessage: correlationId: string * index: int * total: int -&gt; SequencedMessage<br /><br />--------------------<br />type SequencedMessage = | SequencedMessage of correlationId: string * index: int * total: int<br /><br />Full name: messagerouting.SequencedMessage</div>
<div class="tip" id="fs99">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs100">type ResequencedMessages =<br />&#160;&#160;{DispatchableIndex: int;<br />&#160;&#160;&#160;SequencedMessages: SequencedMessage [];}<br />&#160;&#160;member AdvancedTo : dispatchableIndex:int -&gt; ResequencedMessages<br /><br />Full name: messagerouting.ResequencedMessages</div>
<div class="tip" id="fs101">ResequencedMessages.DispatchableIndex: int</div>
<div class="tip" id="fs102">ResequencedMessages.SequencedMessages: SequencedMessage []</div>
<div class="tip" id="fs103">val this : ResequencedMessages</div>
<div class="tip" id="fs104">member ResequencedMessages.AdvancedTo : dispatchableIndex:int -&gt; ResequencedMessages<br /><br />Full name: messagerouting.ResequencedMessages.AdvancedTo</div>
<div class="tip" id="fs105">val dispatchableIndex : int</div>
<div class="tip" id="fs106">val chaosRouter : consumer:&#39;a -&gt; mailbox:&#39;b -&gt; &#39;c<br /><br />Full name: messagerouting.chaosRouter</div>
<div class="tip" id="fs107">val consumer : &#39;a</div>
<div class="tip" id="fs108">val random : &#39;a</div>
<div class="tip" id="fs109">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs110">namespace System</div>
<div class="tip" id="fs111">val resequencerConsumer : actualConsumer:&#39;a -&gt; mailbox:&#39;b -&gt; &#39;c<br /><br />Full name: messagerouting.resequencerConsumer</div>
<div class="tip" id="fs112">val actualConsumer : &#39;a</div>
<div class="tip" id="fs113">val resequenced : &#39;a</div>
<div class="tip" id="fs114">module Array<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs115">val filter : predicate:(&#39;T -&gt; bool) -&gt; array:&#39;T [] -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.filter</div>
<div class="tip" id="fs116">val fold : folder:(&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state:&#39;State -&gt; array:&#39;T [] -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Collections.Array.fold</div>
<div class="tip" id="fs117">val exists : predicate:(&#39;T -&gt; bool) -&gt; array:&#39;T [] -&gt; bool<br /><br />Full name: Microsoft.FSharp.Collections.Array.exists</div>
<div class="tip" id="fs118">val sequencedMessageConsumer : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.sequencedMessageConsumer</div>
<div class="tip" id="fs119">val sequencedMessageConsumerRef : &#39;a<br /><br />Full name: messagerouting.sequencedMessageConsumerRef</div>
<div class="tip" id="fs120">val resequencerConsumerRef : &#39;a<br /><br />Full name: messagerouting.resequencerConsumerRef</div>
<div class="tip" id="fs121">val chaosRouterRef : &#39;a (requires member ( &lt;! ))<br /><br />Full name: messagerouting.chaosRouterRef</div>
<div class="tip" id="fs122">val index : int</div>
<div class="tip" id="fs123">val groupBy : projection:(&#39;T -&gt; &#39;Key) -&gt; list:&#39;T list -&gt; (&#39;Key * &#39;T list) list (requires equality)<br /><br />Full name: Microsoft.FSharp.Collections.List.groupBy</div>
<div class="tip" id="fs124">val maxBy : projection:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.List.maxBy</div>
<div class="tip" id="fs125">val subscribers : &#39;a</div>
<div class="tip" id="fs126">val budgetHikersPriceQuotes : priceQuoteRequestPublisher:&#39;a -&gt; mailbox:&#39;p -&gt; &#39;q (requires member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ))<br /><br />Full name: messagerouting.budgetHikersPriceQuotes</div>
<div class="tip" id="fs127">val priceQuoteRequestPublisher : &#39;a (requires member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ))</div>
<div class="tip" id="fs128">val quoterId : &#39;a</div>
<div class="tip" id="fs129">val highSierraPriceQuotes : priceQuoteRequestPublisher:&#39;a -&gt; mailbox:&#39;p -&gt; &#39;q (requires member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ))<br /><br />Full name: messagerouting.highSierraPriceQuotes</div>
<div class="tip" id="fs130">val mountainAscentPriceQuotes : priceQuoteRequestPublisher:&#39;a -&gt; mailbox:&#39;p -&gt; &#39;q (requires member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ))<br /><br />Full name: messagerouting.mountainAscentPriceQuotes</div>
<div class="tip" id="fs131">val pinnacleGearPriceQuotes : priceQuoteRequestPublisher:&#39;a -&gt; mailbox:&#39;p -&gt; &#39;q (requires member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ))<br /><br />Full name: messagerouting.pinnacleGearPriceQuotes</div>
<div class="tip" id="fs132">val rockBottomOuterwearPriceQuotes : priceQuoteRequestPublisher:&#39;a -&gt; mailbox:&#39;p -&gt; &#39;q (requires member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ))<br /><br />Full name: messagerouting.rockBottomOuterwearPriceQuotes</div>
<div class="tip" id="fs133">val orderProcessorRef : &#39;a (requires member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ) and member ( &lt;! ))<br /><br />Full name: messagerouting.orderProcessorRef</div>
<div class="tip" id="fs134">type RegistrationProcess =<br />&#160;&#160;{ProcessId: string;<br />&#160;&#160;&#160;ProcessSteps: obj;<br />&#160;&#160;&#160;CurrentStep: int;}<br />&#160;&#160;member NextStep : unit -&gt; &#39;a0<br />&#160;&#160;member StepCompleted : unit -&gt; RegistrationProcess<br />&#160;&#160;member IsCompleted : bool<br />&#160;&#160;static member Create : processId:string * processSteps:&#39;a0 -&gt; RegistrationProcess<br /><br />Full name: messagerouting.RegistrationProcess</div>
<div class="tip" id="fs135">RegistrationProcess.ProcessId: string</div>
<div class="tip" id="fs136">RegistrationProcess.ProcessSteps: obj</div>
<div class="tip" id="fs137">RegistrationProcess.CurrentStep: int</div>
<div class="tip" id="fs138">static member RegistrationProcess.Create : processId:string * processSteps:&#39;a0 -&gt; RegistrationProcess<br /><br />Full name: messagerouting.RegistrationProcess.Create</div>
<div class="tip" id="fs139">val processId : string</div>
<div class="tip" id="fs140">val processSteps : &#39;a</div>
<div class="tip" id="fs141">val this : RegistrationProcess</div>
<div class="tip" id="fs142">member RegistrationProcess.IsCompleted : bool<br /><br />Full name: messagerouting.RegistrationProcess.IsCompleted</div>
<div class="tip" id="fs143">member RegistrationProcess.NextStep : unit -&gt; &#39;a0<br /><br />Full name: messagerouting.RegistrationProcess.NextStep</div>
<div class="tip" id="fs144">property RegistrationProcess.IsCompleted: bool</div>
<div class="tip" id="fs145">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs146">val item : index:int -&gt; list:&#39;T list -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.List.item</div>
<div class="tip" id="fs147">member RegistrationProcess.StepCompleted : unit -&gt; RegistrationProcess<br /><br />Full name: messagerouting.RegistrationProcess.StepCompleted</div>
<div class="tip" id="fs148">type RegisterCustomer =<br />&#160;&#160;{RegistrationData: obj;<br />&#160;&#160;&#160;RegistrationProcess: RegistrationProcess;}<br />&#160;&#160;member Advance : unit -&gt; unit<br /><br />Full name: messagerouting.RegisterCustomer</div>
<div class="tip" id="fs149">RegisterCustomer.RegistrationData: obj</div>
<div class="tip" id="fs150">Multiple items<br />RegisterCustomer.RegistrationProcess: RegistrationProcess<br /><br />--------------------<br />type RegistrationProcess =<br />&#160;&#160;{ProcessId: string;<br />&#160;&#160;&#160;ProcessSteps: obj;<br />&#160;&#160;&#160;CurrentStep: int;}<br />&#160;&#160;member NextStep : unit -&gt; &#39;a0<br />&#160;&#160;member StepCompleted : unit -&gt; RegistrationProcess<br />&#160;&#160;member IsCompleted : bool<br />&#160;&#160;static member Create : processId:string * processSteps:&#39;a0 -&gt; RegistrationProcess<br /><br />Full name: messagerouting.RegistrationProcess</div>
<div class="tip" id="fs151">val this : RegisterCustomer</div>
<div class="tip" id="fs152">member RegisterCustomer.Advance : unit -&gt; unit<br /><br />Full name: messagerouting.RegisterCustomer.Advance</div>
<div class="tip" id="fs153">val advancedProcess : RegistrationProcess</div>
<div class="tip" id="fs154">RegisterCustomer.RegistrationProcess: RegistrationProcess</div>
<div class="tip" id="fs155">member RegistrationProcess.StepCompleted : unit -&gt; RegistrationProcess</div>
<div class="tip" id="fs156">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs157">member RegistrationProcess.NextStep : unit -&gt; &#39;a0</div>
<div class="tip" id="fs158">val creditChecker : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.creditChecker</div>
<div class="tip" id="fs159">val contactKeeper : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.contactKeeper</div>
<div class="tip" id="fs160">val customerVault : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.customerVault</div>
<div class="tip" id="fs161">val servicePlanner : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.servicePlanner</div>
<div class="tip" id="fs162">val contactKeeper : system:&#39;a -&gt; id:string -&gt; &#39;b<br /><br />Full name: messagerouting.ServiceRegistry.contactKeeper</div>
<div class="tip" id="fs163">val system : &#39;a</div>
<div class="tip" id="fs164">val id : string</div>
<div class="tip" id="fs165">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs166">val creditChecker : system:&#39;a -&gt; id:string -&gt; &#39;b<br /><br />Full name: messagerouting.ServiceRegistry.creditChecker</div>
<div class="tip" id="fs167">val customerVault : system:&#39;a -&gt; id:string -&gt; &#39;b<br /><br />Full name: messagerouting.ServiceRegistry.customerVault</div>
<div class="tip" id="fs168">val servicePlanner : system:&#39;a -&gt; id:string -&gt; &#39;b<br /><br />Full name: messagerouting.ServiceRegistry.servicePlanner</div>
<div class="tip" id="fs169">val processId : string<br /><br />Full name: messagerouting.processId</div>
<div class="tip" id="fs170">val step1 : &#39;a<br /><br />Full name: messagerouting.step1</div>
<div class="tip" id="fs171">module ServiceRegistry<br /><br />from messagerouting</div>
<div class="tip" id="fs172">val step2 : &#39;a<br /><br />Full name: messagerouting.step2</div>
<div class="tip" id="fs173">val step3 : &#39;a<br /><br />Full name: messagerouting.step3</div>
<div class="tip" id="fs174">val step4 : &#39;a<br /><br />Full name: messagerouting.step4</div>
<div class="tip" id="fs175">val registrationProcess : RegistrationProcess<br /><br />Full name: messagerouting.registrationProcess</div>
<div class="tip" id="fs176">static member RegistrationProcess.Create : processId:string * processSteps:&#39;a0 -&gt; RegistrationProcess</div>
<div class="tip" id="fs177">val registrationData : &#39;a<br /><br />Full name: messagerouting.registrationData</div>
<div class="tip" id="fs178">val registerCustomer : RegisterCustomer<br /><br />Full name: messagerouting.registerCustomer</div>
<div class="tip" id="fs179">val processOf : processId:&#39;a -&gt; processes:Map&lt;&#39;a,&#39;b&gt; -&gt; &#39;b (requires comparison)<br /><br />Full name: messagerouting.Process.processOf</div>
<div class="tip" id="fs180">val processId : &#39;a (requires comparison)</div>
<div class="tip" id="fs181">val processes : Map&lt;&#39;a,&#39;b&gt; (requires comparison)</div>
<div class="tip" id="fs182">val startProcess : processId:&#39;a -&gt; process:&#39;b -&gt; self:&#39;c -&gt; processes:Map&lt;&#39;a,&#39;b&gt; -&gt; Map&lt;&#39;a,&#39;b&gt; (requires comparison and member ( &lt;! ))<br /><br />Full name: messagerouting.Process.startProcess</div>
<div class="tip" id="fs183">val self : &#39;a (requires member ( &lt;! ))</div>
<div class="tip" id="fs184">val stopProcess : processId:&#39;a -&gt; self:&#39;b -&gt; processes:Map&lt;&#39;a,&#39;d&gt; -&gt; Map&lt;&#39;a,&#39;d&gt; (requires comparison and member ( &lt;! ))<br /><br />Full name: messagerouting.Process.stopProcess</div>
<div class="tip" id="fs185">val loanRateQuote : loanRateQuoteId:&#39;a -&gt; taxId:&#39;b -&gt; amount:&#39;c -&gt; termInMonths:&#39;d -&gt; loanBroker:&#39;e -&gt; mailbox:&#39;f -&gt; &#39;g<br /><br />Full name: messagerouting.loanRateQuote</div>
<div class="tip" id="fs186">val loanRateQuoteId : &#39;a</div>
<div class="tip" id="fs187">val taxId : &#39;a</div>
<div class="tip" id="fs188">val amount : &#39;a</div>
<div class="tip" id="fs189">val termInMonths : &#39;a</div>
<div class="tip" id="fs190">val loanBroker : &#39;a</div>
<div class="tip" id="fs191">val loop : (&#39;a -&gt; &#39;b -&gt; &#39;c -&gt; &#39;d)</div>
<div class="tip" id="fs192">val bankLoanRateQuotes : &#39;a</div>
<div class="tip" id="fs193">val expectedLoanRateQuotes : &#39;a</div>
<div class="tip" id="fs194">val creditRatingScore : &#39;a</div>
<div class="tip" id="fs195">val minBy : projection:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.List.minBy</div>
<div class="tip" id="fs196">val length : list:&#39;T list -&gt; int<br /><br />Full name: Microsoft.FSharp.Collections.List.length</div>
<div class="tip" id="fs197">val loanBroker : creditBureau:&#39;a -&gt; banks:&#39;b -&gt; mailbox:&#39;c -&gt; &#39;d<br /><br />Full name: messagerouting.loanBroker</div>
<div class="tip" id="fs198">val creditBureau : &#39;a</div>
<div class="tip" id="fs199">val banks : &#39;a</div>
<div class="tip" id="fs200">val processes : &#39;a</div>
<div class="tip" id="fs201">module Process<br /><br />from messagerouting</div>
<div class="tip" id="fs202">val creditBureau : mailbox:&#39;a -&gt; &#39;b<br /><br />Full name: messagerouting.creditBureau</div>
<div class="tip" id="fs203">val creditRanges : int list</div>
<div class="tip" id="fs204">val randomCreditRangeGenerator : &#39;a</div>
<div class="tip" id="fs205">val randomCreditScoreGenerator : &#39;a</div>
<div class="tip" id="fs206">val bank : bankId:&#39;a -&gt; primeRate:decimal -&gt; ratePremium:decimal -&gt; mailbox:&#39;b -&gt; &#39;c<br /><br />Full name: messagerouting.bank</div>
<div class="tip" id="fs207">val bankId : &#39;a</div>
<div class="tip" id="fs208">val primeRate : decimal</div>
<div class="tip" id="fs209">val ratePremium : decimal</div>
<div class="tip" id="fs210">val randomDiscount : &#39;a</div>
<div class="tip" id="fs211">val randomQuoteId : &#39;a</div>
<div class="tip" id="fs212">val calculateInterestRate : (&#39;a -&gt; decimal -&gt; decimal -&gt; decimal)</div>
<div class="tip" id="fs213">val months : decimal</div>
<div class="tip" id="fs214">val creditScore : decimal</div>
<div class="tip" id="fs215">val creditScoreDiscount : decimal</div>
<div class="tip" id="fs216">Multiple items<br />val decimal : value:&#39;T -&gt; decimal (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.decimal<br /><br />--------------------<br />type decimal = System.Decimal<br /><br />Full name: Microsoft.FSharp.Core.decimal<br /><br />--------------------<br />type decimal&lt;&#39;Measure&gt; = decimal<br /><br />Full name: Microsoft.FSharp.Core.decimal&lt;_&gt;</div>
<div class="tip" id="fs217">val creditBureauRef : &#39;a<br /><br />Full name: messagerouting.creditBureauRef</div>
<div class="tip" id="fs218">val bank1Ref : &#39;a<br /><br />Full name: messagerouting.bank1Ref</div>
<div class="tip" id="fs219">val bank2Ref : &#39;a<br /><br />Full name: messagerouting.bank2Ref</div>
<div class="tip" id="fs220">val bank3Ref : &#39;a<br /><br />Full name: messagerouting.bank3Ref</div>
<div class="tip" id="fs221">val loanBrokerRef : &#39;a (requires member ( &lt;! ))<br /><br />Full name: messagerouting.loanBrokerRef</div>

        </div>
        <div class="span3">
          <img src="/fsharpreactivepatterns/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">Reactive Messaging Patterns with F# and Akka.NET</li>
            <li><a href="/fsharpreactivepatterns/index.html">Home page</a></li>
            <li class="divider"></li>
            
            <li><a href="http://github.com/jorgef/fsharpreactivepatterns">Source Code on GitHub</a></li>
            <li><a href="/fsharpreactivepatterns/license.html">License</a></li>
            
            
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/jorgef/fsharpreactivepatterns"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
